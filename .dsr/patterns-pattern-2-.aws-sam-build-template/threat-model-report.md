# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-08-22  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **10** security threats. The analysis reveals **0** critical, **2** high, **6** medium, and **2** low severity findings.

## Priority Actions

### 1. Ensure the ConfigurationDefaultS3Uri points to a properly secured S3 bucket with appropriate access controls, encryption, and logging. Audit the configuration files to ensure they don't contain sensitive credentials or information.

**Effort:** Medium  
**Related Threats:** PATTERN2-THREAT-009  
**Business Impact:** Exposure of internal system design, prompt engineering, or other sensitive configurations that could facilitate further attacks.

### 1. Implement robust input validation and sanitization, utilize Bedrock guardrails more broadly across all LLM interactions, and add content filtering before sending data to LLM models.

**Effort:** High  
**Related Threats:** PATTERN2-THREAT-010  
**Business Impact:** Potential for data leakage, system manipulation, or generation of misleading or harmful content through the LLM.

### 2. Implement AWS Signer and Code Signing for Lambda functions to ensure code integrity during deployment.

**Effort:** Medium  
**Related Threats:** PATTERN2-THREAT-002  
**Business Impact:** Execution of unauthorized code leading to potential data exfiltration, resource misuse, or further system compromise.

### 2. Restrict the 'bedrock:InvokeModel' permission to only the specific models required by each function, rather than using the wildcard pattern for all foundation models.

**Effort:** Low  
**Related Threats:** PATTERN2-THREAT-003  
**Business Impact:** Potential for cost escalation, unauthorized model use, and violation of least privilege principles.

### 2. While Textract does not support resource-level permissions for these actions, implement additional controls such as strict input validation and request origin verification within the Lambda function code.

**Effort:** Medium  
**Related Threats:** PATTERN2-THREAT-006  
**Business Impact:** Potential unauthorized access to document content from other sources, cost impact through excess API usage.

### 2. Set appropriate reserved and/or maximum concurrent execution limits for each Lambda function based on expected traffic patterns and criticality.

**Effort:** Low  
**Related Threats:** PATTERN2-THREAT-008  
**Business Impact:** Potential service disruption, resource exhaustion, or unexpected billing charges from uncontrolled scaling.

### 3. Enable environment variable encryption for Lambda functions using the KmsKeyArn property, referencing the existing CustomerManagedEncryptionKeyArn.

**Effort:** Low  
**Related Threats:** PATTERN2-THREAT-001  
**Business Impact:** Exposure of configuration details that could aid in further attacks or reveal implementation details.

### 3. Implement IAM permissions that restrict dashboard access to only authorized personnel and ensure log groups filter sensitive information before display in dashboards.

**Effort:** Low  
**Related Threats:** PATTERN2-THREAT-004  
**Business Impact:** Unauthorized visibility into system operations, error patterns, and potentially sensitive data included in logs or metrics.

### 3. While CloudWatch does not support resource-level permissions for PutMetricData, implement additional controls like strict metric namespace prefixing in code and monitoring for unexpected metric publications.

**Effort:** Medium  
**Related Threats:** PATTERN2-THREAT-007  
**Business Impact:** Potential for metric pollution, false alarms, or masking of actual issues by publishing misleading operational data.

### 4. Enhance logging by adding additional context metadata and ensuring cross-reference capabilities with CloudTrail and other logging sources.

**Effort:** Medium  
**Related Threats:** PATTERN2-THREAT-005  
**Business Impact:** Limited ability to perform forensic analysis in case of a security incident or to detect unusual patterns of behavior.



## Detailed Threat Analysis

## High Severity Threats

### PATTERN2-THREAT-009: Potential Sensitive Data Exposure in Configuration Default Values

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UpdateDefaultConfig` (AWS::CloudFormation::CustomResource)  
**CWE ID:** CWE-200

#### Issue
The UpdateDefaultConfig custom resource imports configuration from an S3 URI that could contain sensitive information such as prompts, API keys, or system configurations.

#### Attack Vector
An attacker with access to the configuration bucket could exfiltrate sensitive configuration data or modify it to influence system behavior.

#### Potential Impact
Exposure of internal system design, prompt engineering, or other sensitive configurations that could facilitate further attacks.

#### Remediation
Ensure the ConfigurationDefaultS3Uri points to a properly secured S3 bucket with appropriate access controls, encryption, and logging. Audit the configuration files to ensure they don't contain sensitive credentials or information.

**References:**
- https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html

---

### PATTERN2-THREAT-010: LLM Prompt Injection Risk in Model Interactions

**STRIDE Category:** Tampering  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-74

#### Issue
Functions that interact with Bedrock LLMs may be susceptible to prompt injection attacks if input validation is insufficient, as they process documents from potentially untrusted sources.

#### Attack Vector
An attacker could craft documents with content designed to manipulate the LLM prompts, potentially causing unexpected behavior, information leakage, or manipulated outputs.

#### Potential Impact
Potential for data leakage, system manipulation, or generation of misleading or harmful content through the LLM.

#### Remediation
Implement robust input validation and sanitization, utilize Bedrock guardrails more broadly across all LLM interactions, and add content filtering before sending data to LLM models.

**References:**
- https://owasp.org/www-project-top-10-for-large-language-model-applications/

---

## Medium Severity Threats

### PATTERN2-THREAT-002: Lambda Code Integrity Not Validated

**STRIDE Category:** Tampering  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Lambda::Function)  
**CWE ID:** CWE-494

#### Issue
Lambda functions do not implement code signing or deployment validation, allowing potential code tampering during deployment.

#### Attack Vector
An attacker with appropriate IAM permissions could replace Lambda function code with malicious versions.

#### Potential Impact
Execution of unauthorized code leading to potential data exfiltration, resource misuse, or further system compromise.

#### Remediation
Implement AWS Signer and Code Signing for Lambda functions to ensure code integrity during deployment.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-codesigning.html

---

### PATTERN2-THREAT-003: Overly Permissive Bedrock Model Invocation Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OCRFunction Policies, ExtractionFunction Policies, ClassificationFunction Policies` (AWS::IAM::Policy)  
**CWE ID:** CWE-272

#### Issue
Lambda functions have permissions to invoke any foundation model in Bedrock with 'bedrock:InvokeModel' on 'arn:aws:bedrock:*::foundation-model/*' which is broader than necessary.

#### Attack Vector
If a Lambda function is compromised, an attacker could leverage these broad permissions to access models they shouldn't, potentially causing unexpected costs or accessing sensitive capabilities.

#### Potential Impact
Potential for cost escalation, unauthorized model use, and violation of least privilege principles.

#### Remediation
Restrict the 'bedrock:InvokeModel' permission to only the specific models required by each function, rather than using the wildcard pattern for all foundation models.

**References:**
- https://docs.aws.amazon.com/bedrock/latest/userguide/security_iam_service-with-iam.html

---

### PATTERN2-THREAT-004: CloudWatch Dashboard Could Expose Sensitive Operational Data

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `Dashboard` (AWS::CloudWatch::Dashboard)  
**CWE ID:** CWE-200

#### Issue
The CloudWatch Dashboard may display operational metrics and logs that contain sensitive information without access controls explicitly defined.

#### Attack Vector
Users with CloudWatch dashboard access could view potentially sensitive operational data or error messages that might reveal implementation details.

#### Potential Impact
Unauthorized visibility into system operations, error patterns, and potentially sensitive data included in logs or metrics.

#### Remediation
Implement IAM permissions that restrict dashboard access to only authorized personnel and ensure log groups filter sensitive information before display in dashboards.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards_Permissions_Admin.html

---

### PATTERN2-THREAT-006: Overly Broad Textract API Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OCRFunction Policies` (AWS::IAM::Policy)  
**CWE ID:** CWE-272

#### Issue
The OCRFunction has permissions to call textract:DetectDocumentText and textract:AnalyzeDocument on all resources ('*') which violates least privilege principle.

#### Attack Vector
If the Lambda function is compromised, an attacker could use these permissions to analyze documents from any source within AWS Textract.

#### Potential Impact
Potential unauthorized access to document content from other sources, cost impact through excess API usage.

#### Remediation
While Textract does not support resource-level permissions for these actions, implement additional controls such as strict input validation and request origin verification within the Lambda function code.

**References:**
- https://docs.aws.amazon.com/textract/latest/dg/security_iam_service-with-iam.html

---

### PATTERN2-THREAT-007: CloudWatch PutMetricData Permission Without Resource Constraints

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `Multiple Lambda Function Policies` (AWS::IAM::Policy)  
**CWE ID:** CWE-272

#### Issue
Multiple Lambda functions have the ability to put metrics to any CloudWatch namespace with 'cloudwatch:PutMetricData' on resource '*'.

#### Attack Vector
If compromised, a Lambda function could be used to publish misleading metrics to any CloudWatch namespace, potentially triggering automated responses or confusing monitoring systems.

#### Potential Impact
Potential for metric pollution, false alarms, or masking of actual issues by publishing misleading operational data.

#### Remediation
While CloudWatch does not support resource-level permissions for PutMetricData, implement additional controls like strict metric namespace prefixing in code and monitoring for unexpected metric publications.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/iam-cw-condition-keys-namespace.html

---

### PATTERN2-THREAT-008: Missing Concurrent Execution Limits on Lambda Functions

**STRIDE Category:** Denial of Service  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-400

#### Issue
Lambda functions do not have reserved or maximum concurrent execution limits defined, which could lead to resource exhaustion or unexpected scaling behavior.

#### Attack Vector
A flood of requests, either malicious or legitimate, could cause functions to scale excessively, potentially impacting other systems or incurring unexpected costs.

#### Potential Impact
Potential service disruption, resource exhaustion, or unexpected billing charges from uncontrolled scaling.

#### Remediation
Set appropriate reserved and/or maximum concurrent execution limits for each Lambda function based on expected traffic patterns and criticality.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

## Low Severity Threats

### PATTERN2-THREAT-001: Lambda Function Environment Variables Not Encrypted

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Lambda::Function)  
**CWE ID:** CWE-256

#### Issue
Lambda function environment variables are not explicitly encrypted with AWS KMS, potentially exposing sensitive configuration information if function details are accessible.

#### Attack Vector
An attacker with permissions to view Lambda function configuration could view environment variables that might contain sensitive configuration data.

#### Potential Impact
Exposure of configuration details that could aid in further attacks or reveal implementation details.

#### Remediation
Enable environment variable encryption for Lambda functions using the KmsKeyArn property, referencing the existing CustomerManagedEncryptionKeyArn.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars.html#configuration-envvars-encryption

---

### PATTERN2-THREAT-005: State Machine Logging Could Be More Comprehensive

**STRIDE Category:** Repudiation  
**Affected Resource:** `DocumentProcessingStateMachine` (AWS::Serverless::StateMachine)  
**CWE ID:** CWE-778

#### Issue
While the state machine has logging enabled with 'Level: ALL', it may not be capturing full context for security auditing purposes.

#### Attack Vector
An attacker performing malicious actions might not be fully traceable through the current logging configuration.

#### Potential Impact
Limited ability to perform forensic analysis in case of a security incident or to detect unusual patterns of behavior.

#### Remediation
Enhance logging by adding additional context metadata and ensuring cross-reference capabilities with CloudTrail and other logging sources.

**References:**
- https://docs.aws.amazon.com/step-functions/latest/dg/cw-logs.html

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*