# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-07-53  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **10** security threats. The analysis reveals **0** critical, **1** high, **5** medium, and **4** low severity findings.

## Priority Actions

### 1. Implement least privilege by restricting S3 permissions to specific buckets and actions needed. Scope down the OpenSearch Serverless permissions to specific collections and actions required.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-003  
**Business Impact:** Potential data exfiltration, unauthorized access to S3 objects, or manipulation of OpenSearch collections and indices.

### 1. Restrict the bedrock:InvokeModel permission to only the specific embedding model ARNs required for the Knowledge Base functionality rather than allowing access to all foundation models.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-005  
**Business Impact:** Potential misuse of AI capabilities, unauthorized model access, and possible generation of harmful content through unrestricted model invocation.

### 2. Modify the OSSNetworkPolicy to restrict access using VPC endpoints or IP-based restrictions instead of allowing public access. If public access is required, ensure proper authentication and authorization are strictly enforced.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-001  
**Business Impact:** Potential unauthorized access to the vector database containing knowledge base data, which could lead to data exposure or information leakage.

### 2. Deploy Lambda functions within a VPC with appropriate subnet and security group configurations to restrict network access and enhance security posture.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-006  
**Business Impact:** Increased attack surface for sensitive functions that handle data transformations or have permissions to access other AWS resources.

### 2. Implement additional validation and filtering for web crawler content, such as content classifiers to identify and exclude sensitive information. Consider adding policies to respect robots.txt and implement ethical crawling practices.

**Effort:** High  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-010  
**Business Impact:** Potential leakage of sensitive information, copyright violations, or unauthorized data collection through the web crawler mechanism.

### 3. Modify the OSSEncryptionPolicy to use customer-managed KMS keys instead of AWS-owned keys by setting 'AWSOwnedKey' to false and specifying a KMS key.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-002  
**Business Impact:** Reduced control over encryption key management and potential challenges meeting strict compliance requirements that mandate customer control of encryption keys.

### 3. Configure explicit log retention periods for Lambda functions using AWS::Logs::LogGroup resources with appropriate RetentionInDays values. Consider encrypting logs with KMS for sensitive workloads.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-004  
**Business Impact:** Difficulty investigating security incidents, potential non-compliance with regulatory requirements for log retention, and challenges with non-repudiation.

### 3. Either modify the template to create a new bucket with proper security configurations or validate the security settings of the existing bucket. Consider adding conditional checks to ensure the bucket has appropriate security controls.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-008  
**Business Impact:** Potential data integrity issues, inability to recover from accidental or malicious changes, and lack of audit trails for bucket access.

### 4. Configure ReservedConcurrentExecutions for critical Lambda functions to ensure they have guaranteed capacity even during high-load situations.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-007  
**Business Impact:** Potential service disruptions, failures in index creation, or delays in processing Knowledge Base operations during peak usage periods.

### 4. Consider adding additional authentication mechanisms to the EventBridge Scheduler configuration if available, or implement tighter restrictions on the scheduler role's permissions.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-009  
**Business Impact:** If the scheduler role is compromised, an attacker could trigger unauthorized ingestion jobs, potentially causing resource consumption or service disruptions.



## Detailed Threat Analysis

## High Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-005: Broad Bedrock Model Invocation Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `KnowledgeBaseServiceRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The KnowledgeBaseServiceRole includes permission to invoke any foundation model in Bedrock (bedrock:InvokeModel on resource '*') rather than restricting to specific models needed.

#### Attack Vector
If the Knowledge Base service is compromised, an attacker could leverage this role to invoke any Bedrock model, potentially bypassing guardrails or restrictions on specific models.

#### Potential Impact
Potential misuse of AI capabilities, unauthorized model access, and possible generation of harmful content through unrestricted model invocation.

#### Remediation
Restrict the bedrock:InvokeModel permission to only the specific embedding model ARNs required for the Knowledge Base functionality rather than allowing access to all foundation models.

**References:**
- https://docs.aws.amazon.com/bedrock/latest/userguide/security_iam_service-with-iam.html

---

## Medium Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-001: Public Access to OpenSearch Serverless Collection

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `OSSNetworkPolicy` (AWS::OpenSearchServerless::SecurityPolicy)  
**CWE ID:** CWE-668

#### Issue
The OSSNetworkPolicy security policy allows public access to the OpenSearch Serverless collection dashboard and API endpoints with 'AllowFromPublic' set to true.

#### Attack Vector
An attacker could attempt to access the OpenSearch dashboard or API endpoints if authentication controls are misconfigured or compromised.

#### Potential Impact
Potential unauthorized access to the vector database containing knowledge base data, which could lead to data exposure or information leakage.

#### Remediation
Modify the OSSNetworkPolicy to restrict access using VPC endpoints or IP-based restrictions instead of allowing public access. If public access is required, ensure proper authentication and authorization are strictly enforced.

**References:**
- https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-network.html

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-002: Default AWS-Owned Key Used for OpenSearch Encryption

**STRIDE Category:** Tampering  
**Affected Resource:** `OSSEncryptionPolicy` (AWS::OpenSearchServerless::SecurityPolicy)  
**CWE ID:** CWE-320

#### Issue
The template uses AWS-owned encryption keys for the OpenSearch Serverless collection rather than customer-managed KMS keys.

#### Attack Vector
While AWS-owned keys provide encryption, they don't give customers full control over the key lifecycle or access management.

#### Potential Impact
Reduced control over encryption key management and potential challenges meeting strict compliance requirements that mandate customer control of encryption keys.

#### Remediation
Modify the OSSEncryptionPolicy to use customer-managed KMS keys instead of AWS-owned keys by setting 'AWSOwnedKey' to false and specifying a KMS key.

**References:**
- https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-encryption.html

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-003: Overly Permissive IAM Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OpenSearchLambdaExecutionRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The OpenSearchLambdaExecutionRole includes broad permissions like 's3:*Object*' on all S3 buckets and 'aoss:APIAccessAll' on all resources.

#### Attack Vector
If the Lambda function is compromised, an attacker could use these broad permissions to access data in any S3 bucket or perform unauthorized actions in OpenSearch Serverless.

#### Potential Impact
Potential data exfiltration, unauthorized access to S3 objects, or manipulation of OpenSearch collections and indices.

#### Remediation
Implement least privilege by restricting S3 permissions to specific buckets and actions needed. Scope down the OpenSearch Serverless permissions to specific collections and actions required.

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-006: Lambda Functions Without VPC Configuration

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `GetAdjustedStackNameFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-668

#### Issue
Lambda functions are deployed without VPC configurations, exposing them to the public internet rather than restricting them within a private network.

#### Attack Vector
While protected by IAM, Lambda functions could potentially be accessed from the public internet, increasing the attack surface.

#### Potential Impact
Increased attack surface for sensitive functions that handle data transformations or have permissions to access other AWS resources.

#### Remediation
Deploy Lambda functions within a VPC with appropriate subnet and security group configurations to restrict network access and enhance security posture.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-010: Web Crawler Data Source Security Risk

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `WebDataSource` (AWS::Bedrock::DataSource)  
**CWE ID:** CWE-212

#### Issue
The web crawler configuration can ingest content from public websites but doesn't include security controls to prevent crawling or ingestion of sensitive information.

#### Attack Vector
The web crawler could potentially scrape sensitive or restricted information from websites and store it in the Knowledge Base, where it could be exposed through queries.

#### Potential Impact
Potential leakage of sensitive information, copyright violations, or unauthorized data collection through the web crawler mechanism.

#### Remediation
Implement additional validation and filtering for web crawler content, such as content classifiers to identify and exclude sensitive information. Consider adding policies to respect robots.txt and implement ethical crawling practices.

**References:**
- https://docs.aws.amazon.com/bedrock/latest/userguide/knowledge-base-web.html

---

## Low Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-004: Missing CloudWatch Logs Configurations for Lambda Functions

**STRIDE Category:** Repudiation  
**Affected Resource:** `CreateOSSIndexLambdaFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-778

#### Issue
Lambda functions in the template don't explicitly define log retention periods or log access controls, which could lead to insufficient audit trails.

#### Attack Vector
In the event of a security incident, logs might be missing, inadequate, or might have been automatically deleted if the default retention period was too short.

#### Potential Impact
Difficulty investigating security incidents, potential non-compliance with regulatory requirements for log retention, and challenges with non-repudiation.

#### Remediation
Configure explicit log retention periods for Lambda functions using AWS::Logs::LogGroup resources with appropriate RetentionInDays values. Consider encrypting logs with KMS for sensitive workloads.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-007: Missing Lambda Concurrency Controls

**STRIDE Category:** Denial of Service  
**Affected Resource:** `CreateOSSIndexLambdaFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-400

#### Issue
Lambda functions don't have reserved concurrency configurations, which could lead to resource exhaustion during high traffic periods.

#### Attack Vector
In a multi-tenant environment, other applications could consume all available Lambda concurrency, causing throttling and denial of service for the Knowledge Base components.

#### Potential Impact
Potential service disruptions, failures in index creation, or delays in processing Knowledge Base operations during peak usage periods.

#### Remediation
Configure ReservedConcurrentExecutions for critical Lambda functions to ensure they have guaranteed capacity even during high-load situations.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-008: Missing S3 Bucket Security Configurations

**STRIDE Category:** Tampering  
**Affected Resource:** `pKnowledgeBaseBucketName` (AWS::S3::Bucket)  
**CWE ID:** CWE-693

#### Issue
The template references an existing S3 bucket but doesn't enforce security configurations like versioning, encryption, or access logging on that bucket.

#### Attack Vector
If the referenced bucket doesn't have proper security controls, documents stored in it could be vulnerable to unauthorized modifications or deletions.

#### Potential Impact
Potential data integrity issues, inability to recover from accidental or malicious changes, and lack of audit trails for bucket access.

#### Remediation
Either modify the template to create a new bucket with proper security configurations or validate the security settings of the existing bucket. Consider adding conditional checks to ensure the bucket has appropriate security controls.

**References:**
- https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html

---

### AWS-GENAI-IDP-ACCELERATOR-BEDROCK-KNOWLEDGE-BASE-SETUP-THREAT-009: Scheduler Without Request Authentication

**STRIDE Category:** Spoofing  
**Affected Resource:** `S3DataSourceScheduler` (AWS::Scheduler::Schedule)  
**CWE ID:** CWE-306

#### Issue
The EventBridge Scheduler configurations don't include authentication settings when invoking the Bedrock API.

#### Attack Vector
While protected by IAM, the lack of additional authentication mechanisms could potentially be exploited if the scheduler role is compromised.

#### Potential Impact
If the scheduler role is compromised, an attacker could trigger unauthorized ingestion jobs, potentially causing resource consumption or service disruptions.

#### Remediation
Consider adding additional authentication mechanisms to the EventBridge Scheduler configuration if available, or implement tighter restrictions on the scheduler role's permissions.

**References:**
- https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-security.html

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*