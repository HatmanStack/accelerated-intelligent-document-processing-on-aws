# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-08-10  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **10** security threats. The analysis reveals **0** critical, **2** high, **7** medium, and **1** low severity findings.

## Priority Actions

### 2. Restrict KMS permissions to only what's necessary for the function's operation. For example, if the function only needs to read encrypted data, limit to kms:Decrypt.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-001  
**Business Impact:** Potential unauthorized access to encrypted data or ability to manipulate encryption keys, leading to data confidentiality breaches.

### 2. Scope down the SSM Parameter permissions to specific parameter paths used by the application. Use a resource pattern like 'arn:aws:ssm:*:*:parameter/idp/*' to limit access to a specific path prefix.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-002  
**Business Impact:** Potential exposure of sensitive configuration data or credentials stored in Parameter Store across the entire AWS account.

### 2. Restrict Bedrock model access to only the specific models needed for the application. Replace the wildcard with specific model ARNs like 'arn:aws:bedrock:us-west-2::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0'.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-005  
**Business Impact:** Potential for unauthorized model access, cost escalation through usage of expensive models, or generation of harmful content through higher capability models.

### 3. Enhance the CloudWatch dashboard to include security-focused metrics and logs, including IAM access denied events, unusual API call patterns, and authentication failures.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-003  
**Business Impact:** Delayed detection of security incidents, potentially leading to longer exposure times during a breach or attack.

### 3. Implement CloudWatch alarms on the ApproximateNumberOfMessagesVisible metric for the DLQ with appropriate thresholds and notifications to alert when messages start accumulating.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-004  
**Business Impact:** Potential service degradation or processing failures without timely notification, leading to operational issues or incomplete document processing.

### 3. Configure AWS Backup or implement a scheduled backup solution for the DynamoDB table to ensure regular backups are taken in addition to Point-in-Time Recovery.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-006  
**Business Impact:** Risk of data loss or extended recovery times if the DynamoDB table data is corrupted or accidentally modified.

### 3. Implement centralized logging by configuring log exports to S3, setting up CloudWatch Logs Insights queries for security events, or integrating with a SIEM solution.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-007  
**Business Impact:** Reduced visibility into security events across the system, leading to longer investigation times and potential missed security signals.

### 3. Restrict the AppSync GraphQL access to only the specific mutations needed by the function by specifying the exact field names in the resource pattern rather than using a wildcard.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-008  
**Business Impact:** Unauthorized modification of data through the AppSync API, potentially affecting document processing status integrity.

### 3. Implement appropriate reserved concurrency limits on key Lambda functions to prevent excessive scaling and potential resource exhaustion.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-010  
**Business Impact:** Potential service disruption due to resource exhaustion or cost implications from unexpected Lambda scaling.

### 4. Set IncludeExecutionData to false and implement more granular logging that excludes sensitive document content while still providing necessary operational visibility.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-009  
**Business Impact:** Potential exposure of sensitive document information in CloudWatch Logs, accessible to anyone with logs access permissions.



## Detailed Threat Analysis

## High Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-001: Overly Permissive Lambda IAM Permissions for KMS

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `InvokeBDAFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-250

#### Issue
The Lambda function has been granted broad permissions on the KMS key including Encrypt, Decrypt, ReEncrypt*, GenerateDataKey*, and DescribeKey. This exceeds the principle of least privilege as the function may only need specific operations like Decrypt.

#### Attack Vector
If the Lambda function is compromised, an attacker could leverage these permissions to encrypt/decrypt data beyond what's needed for the function's intended purpose.

#### Potential Impact
Potential unauthorized access to encrypted data or ability to manipulate encryption keys, leading to data confidentiality breaches.

#### Remediation
Restrict KMS permissions to only what's necessary for the function's operation. For example, if the function only needs to read encrypted data, limit to kms:Decrypt.

**References:**
- https://docs.aws.amazon.com/kms/latest/developerguide/kms-api-permissions-reference.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-005: Overly Permissive Bedrock Model Access

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-272

#### Issue
The SummarizationFunction has broad permissions to invoke any foundation model in Amazon Bedrock with the resource pattern 'arn:aws:bedrock:*::foundation-model/*'.

#### Attack Vector
If compromised, an attacker could use the function to access any Bedrock model, potentially increasing costs dramatically or accessing more capable models to generate malicious content.

#### Potential Impact
Potential for unauthorized model access, cost escalation through usage of expensive models, or generation of harmful content through higher capability models.

#### Remediation
Restrict Bedrock model access to only the specific models needed for the application. Replace the wildcard with specific model ARNs like 'arn:aws:bedrock:us-west-2::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0'.

**References:**
- https://docs.aws.amazon.com/bedrock/latest/userguide/security-iam.html

---

## Medium Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-002: Excessive SSM Parameter Access

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `ProcessResultsFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-732

#### Issue
The ProcessResultsFunction has broad permissions to read and write any SSM parameter in the account (ssm:GetParameter, ssm:PutParameter, ssm:GetParametersByPath) with a resource pattern of '*'.

#### Attack Vector
A compromised function could access or modify sensitive parameters stored in Parameter Store that may contain credentials, API keys, or other sensitive configuration data unrelated to this application.

#### Potential Impact
Potential exposure of sensitive configuration data or credentials stored in Parameter Store across the entire AWS account.

#### Remediation
Scope down the SSM Parameter permissions to specific parameter paths used by the application. Use a resource pattern like 'arn:aws:ssm:*:*:parameter/idp/*' to limit access to a specific path prefix.

**References:**
- https://docs.aws.amazon.com/systems-manager/latest/userguide/security_iam_id-based-policy-examples.html#example-permissions-delegated-set

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-003: Insufficient Monitoring for Security Events

**STRIDE Category:** Repudiation  
**Affected Resource:** `Dashboard` (AWS::CloudWatch::Dashboard)  
**CWE ID:** CWE-778

#### Issue
While the solution includes comprehensive operational dashboards for performance and errors, it lacks specific monitoring for security-related events such as authentication failures, permission denied errors, or suspicious API calls.

#### Attack Vector
Security incidents or unauthorized access attempts might go undetected without specific monitoring for security events.

#### Potential Impact
Delayed detection of security incidents, potentially leading to longer exposure times during a breach or attack.

#### Remediation
Enhance the CloudWatch dashboard to include security-focused metrics and logs, including IAM access denied events, unusual API call patterns, and authentication failures.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards_Security_Monitoring.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-004: Missing DLQ Monitoring and Alerting

**STRIDE Category:** Denial of Service  
**Affected Resource:** `BDACompletionFunctionDLQ` (AWS::SQS::Queue)  
**CWE ID:** CWE-778

#### Issue
The BDACompletionFunctionDLQ is configured as a dead letter queue for failed Lambda invocations, but there's no monitoring or alerting configured to notify when messages are sent to this queue.

#### Attack Vector
Failed processing may go undetected if messages accumulate in the DLQ without alerts, potentially causing workflow disruptions or data processing failures.

#### Potential Impact
Potential service degradation or processing failures without timely notification, leading to operational issues or incomplete document processing.

#### Remediation
Implement CloudWatch alarms on the ApproximateNumberOfMessagesVisible metric for the DLQ with appropriate thresholds and notifications to alert when messages start accumulating.

**References:**
- https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queue.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-006: No DynamoDB Table Backup Configuration

**STRIDE Category:** Tampering  
**Affected Resource:** `BDAMetadataTable` (AWS::DynamoDB::Table)  
**CWE ID:** CWE-693

#### Issue
The BDAMetadataTable has Point-in-Time Recovery enabled, but no regular backup schedule is defined. This could lead to potential data loss if corruption occurs.

#### Attack Vector
In case of accidental or malicious data corruption, the recovery options may be limited without regular backups.

#### Potential Impact
Risk of data loss or extended recovery times if the DynamoDB table data is corrupted or accidentally modified.

#### Remediation
Configure AWS Backup or implement a scheduled backup solution for the DynamoDB table to ensure regular backups are taken in addition to Point-in-Time Recovery.

**References:**
- https://docs.aws.amazon.com/aws-backup/latest/devguide/dynamo-db-backup.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-007: Centralized Logging Configuration Missing

**STRIDE Category:** Repudiation  
**Affected Resource:** `Multiple Log Groups` (AWS::Logs::LogGroup)  
**CWE ID:** CWE-778

#### Issue
While CloudWatch Log Groups are defined for individual Lambda functions, there's no centralized logging solution configured (like CloudWatch Logs Insights queries, Log Groups exporting to S3, or integration with security monitoring tools).

#### Attack Vector
Distributed logs make security incident investigation more difficult, potentially allowing attackers' actions to go undetected across multiple components.

#### Potential Impact
Reduced visibility into security events across the system, leading to longer investigation times and potential missed security signals.

#### Remediation
Implement centralized logging by configuring log exports to S3, setting up CloudWatch Logs Insights queries for security events, or integrating with a SIEM solution.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-008: Unrestricted AppSync GraphQL API Access

**STRIDE Category:** Spoofing  
**Affected Resource:** `ProcessResultsFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-284

#### Issue
The ProcessResultsFunction has access to execute any mutation on the AppSync GraphQL API without specific operation restrictions.

#### Attack Vector
If compromised, the function could be used to execute unintended mutations on the GraphQL API, potentially manipulating document status data.

#### Potential Impact
Unauthorized modification of data through the AppSync API, potentially affecting document processing status integrity.

#### Remediation
Restrict the AppSync GraphQL access to only the specific mutations needed by the function by specifying the exact field names in the resource pattern rather than using a wildcard.

**References:**
- https://docs.aws.amazon.com/appsync/latest/devguide/security-authz.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-010: Missing Lambda Concurrency Limits

**STRIDE Category:** Denial of Service  
**Affected Resource:** `Multiple Lambda Functions` (AWS::Serverless::Function)  
**CWE ID:** CWE-770

#### Issue
None of the Lambda functions have concurrency limits defined, which could lead to resource exhaustion if there's an unexpected spike in invocations.

#### Attack Vector
An attacker could trigger excessive Lambda invocations that might impact other services or exceed Bedrock API limits.

#### Potential Impact
Potential service disruption due to resource exhaustion or cost implications from unexpected Lambda scaling.

#### Remediation
Implement appropriate reserved concurrency limits on key Lambda functions to prevent excessive scaling and potential resource exhaustion.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

## Low Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-009: Step Functions Execution Data Logging Enabled

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `DocumentProcessingStateMachine` (AWS::Serverless::StateMachine)  
**CWE ID:** CWE-532

#### Issue
The DocumentProcessingStateMachine has IncludeExecutionData set to true, which logs the entire content of state machine executions, potentially including sensitive document data.

#### Attack Vector
Anyone with access to CloudWatch Logs could view potentially sensitive information from documents being processed.

#### Potential Impact
Potential exposure of sensitive document information in CloudWatch Logs, accessible to anyone with logs access permissions.

#### Remediation
Set IncludeExecutionData to false and implement more granular logging that excludes sensitive document content while still providing necessary operational visibility.

**References:**
- https://docs.aws.amazon.com/step-functions/latest/dg/cloudwatch-logs.html

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*