# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-07-31  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **8** security threats. The analysis reveals **0** critical, **3** high, **5** medium, and **0** low severity findings.

## Priority Actions

### 1. Add KmsKeyId property to the EndpointConfig resource to enable encryption for the SageMaker endpoint. Note that there's a suppressed cfn_nag rule W1200 mentioning KMS key not being supported for NVMe instance storage - ensure your selected instance type supports volume encryption.

**Effort:** Low  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-001  
**Business Impact:** Unauthorized access to model data, prediction inputs/outputs, or other sensitive information processed by the endpoint.

### 1. Replace the AmazonSageMakerFullAccess managed policy with specific inline policies that grant only the permissions needed for the endpoint's operation (such as sagemaker:InvokeEndpoint and specific S3 access).

**Effort:** Medium  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-003  
**Business Impact:** Potential unauthorized access to other SageMaker resources, models, and data across the AWS account.

### 1. Use the full image URI with a digest hash (@sha256:...) instead of relying only on the tag to ensure image immutability and prevent tampering.

**Effort:** Low  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-005  
**Business Impact:** Execution of unauthorized code within the SageMaker container, potentially leading to model theft or data exfiltration.

### 2. Enable data capture for the endpoint by adding DataCaptureConfig to the EndpointConfig resource, specifying CaptureOptions for both 'Input' and 'Output' data with appropriate DestinationS3Uri and KmsKeyId for encryption.

**Effort:** Medium  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-002  
**Business Impact:** Inability to detect unauthorized access, verify compliance with regulations, or investigate security incidents related to model predictions.

### 2. Add the EnableNetworkIsolation property set to true on the AWS::SageMaker::Model resource to prevent the container from making external network calls.

**Effort:** Low  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-004  
**Business Impact:** Potential data leakage, model theft, or execution of unauthorized code within the SageMaker container.

### 2. Add CloudWatch Alarms for key metrics such as Invocations, InvocationsPerInstance, ModelLatency, and Errors. Configure appropriate thresholds and notification actions.

**Effort:** Medium  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-007  
**Business Impact:** Delayed response to security incidents, unauthorized access, or model performance issues.

### 2. Restrict S3 access to only the specific paths needed for model operation by limiting the resources in the IAM policy to specific prefixes rather than granting access to the entire bucket.

**Effort:** Low  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-008  
**Business Impact:** Unauthorized access to sensitive data stored in the same S3 bucket but unrelated to the SageMaker model's operation.

### 3. Review and adjust the auto-scaling parameters based on workload patterns. Consider reducing ScaleInCooldown, increasing ScaleOutCooldown for faster scaling, and setting appropriate TargetInvocationsPerInstance based on model performance characteristics.

**Effort:** Medium  
**Related Threats:** SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-006  
**Business Impact:** Service degradation or outage for legitimate users during traffic spikes or targeted DoS attacks.



## Detailed Threat Analysis

## High Severity Threats

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-001: Missing Encryption for SageMaker Endpoint Storage

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UDOPEndpointConfig` (AWS::SageMaker::EndpointConfig)  
**CWE ID:** CWE-311

#### Issue
The SageMaker endpoint configuration doesn't enforce encryption of data stored on instance volumes. This may expose sensitive model data and temporary processing data at rest.

#### Attack Vector
An attacker with access to the underlying storage infrastructure could potentially extract sensitive information from unencrypted instance volumes.

#### Potential Impact
Unauthorized access to model data, prediction inputs/outputs, or other sensitive information processed by the endpoint.

#### Remediation
Add KmsKeyId property to the EndpointConfig resource to enable encryption for the SageMaker endpoint. Note that there's a suppressed cfn_nag rule W1200 mentioning KMS key not being supported for NVMe instance storage - ensure your selected instance type supports volume encryption.

**References:**
- https://docs.aws.amazon.com/sagemaker/latest/dg/API_CreateEndpointConfig.html

---

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-003: Overly Permissive IAM Role

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `UDOPExecutionRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The execution role has the AmazonSageMakerFullAccess managed policy attached, which grants excessive permissions beyond what's needed for model inference.

#### Attack Vector
If the SageMaker endpoint is compromised, an attacker could leverage the overly permissive role to access or manipulate other SageMaker resources in the account.

#### Potential Impact
Potential unauthorized access to other SageMaker resources, models, and data across the AWS account.

#### Remediation
Replace the AmazonSageMakerFullAccess managed policy with specific inline policies that grant only the permissions needed for the endpoint's operation (such as sagemaker:InvokeEndpoint and specific S3 access).

**References:**
- https://docs.aws.amazon.com/sagemaker/latest/dg/sagemaker-roles.html

---

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-005: No Image Digest Pinning for Container Image

**STRIDE Category:** Tampering  
**Affected Resource:** `UDOPModel` (AWS::SageMaker::Model)  
**CWE ID:** CWE-345

#### Issue
The container image for the model is specified without a digest hash, using only a tag (2.1.0-gpu-py310), which could allow for image tampering.

#### Attack Vector
If an attacker gains access to the ECR repository or can manipulate DNS, they could potentially serve a malicious container image with the same tag.

#### Potential Impact
Execution of unauthorized code within the SageMaker container, potentially leading to model theft or data exfiltration.

#### Remediation
Use the full image URI with a digest hash (@sha256:...) instead of relying only on the tag to ensure image immutability and prevent tampering.

**References:**
- https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-digests.html

---

## Medium Severity Threats

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-002: Missing Data Capture and Logging Configuration

**STRIDE Category:** Repudiation  
**Affected Resource:** `UDOPEndpoint` (AWS::SageMaker::Endpoint)  
**CWE ID:** CWE-778

#### Issue
The SageMaker endpoint lacks data capture configuration for inputs and outputs. Without logging prediction requests and responses, there's no audit trail for model usage and predictions.

#### Attack Vector
Without proper logging, malicious use of the endpoint cannot be traced, and there's no way to audit compliance or investigate incidents.

#### Potential Impact
Inability to detect unauthorized access, verify compliance with regulations, or investigate security incidents related to model predictions.

#### Remediation
Enable data capture for the endpoint by adding DataCaptureConfig to the EndpointConfig resource, specifying CaptureOptions for both 'Input' and 'Output' data with appropriate DestinationS3Uri and KmsKeyId for encryption.

**References:**
- https://docs.aws.amazon.com/sagemaker/latest/dg/model-monitor-data-capture.html

---

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-004: Missing Network Isolation for SageMaker Model

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UDOPModel` (AWS::SageMaker::Model)  
**CWE ID:** CWE-668

#### Issue
The SageMaker model does not enable network isolation, which means the container can make external network calls during inference.

#### Attack Vector
A compromised container could exfiltrate sensitive data to external endpoints or download unauthorized code during inference.

#### Potential Impact
Potential data leakage, model theft, or execution of unauthorized code within the SageMaker container.

#### Remediation
Add the EnableNetworkIsolation property set to true on the AWS::SageMaker::Model resource to prevent the container from making external network calls.

**References:**
- https://docs.aws.amazon.com/sagemaker/latest/dg/model-isolated.html

---

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-006: Suboptimal Auto-scaling Configuration

**STRIDE Category:** Denial of Service  
**Affected Resource:** `ScalingPolicy` (AWS::ApplicationAutoScaling::ScalingPolicy)  
**CWE ID:** CWE-400

#### Issue
The auto-scaling configuration may not be optimal to handle burst traffic scenarios with a relatively high ScaleInCooldown (300s) and potentially low TargetInvocationsPerInstance default value.

#### Attack Vector
An attacker could perform a denial of service by overwhelming the endpoint with requests before it can scale out sufficiently.

#### Potential Impact
Service degradation or outage for legitimate users during traffic spikes or targeted DoS attacks.

#### Remediation
Review and adjust the auto-scaling parameters based on workload patterns. Consider reducing ScaleInCooldown, increasing ScaleOutCooldown for faster scaling, and setting appropriate TargetInvocationsPerInstance based on model performance characteristics.

**References:**
- https://docs.aws.amazon.com/sagemaker/latest/dg/endpoint-auto-scaling.html

---

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-007: Missing Monitoring and Alerting Configuration

**STRIDE Category:** Repudiation  
**Affected Resource:** `Stack` (AWS::CloudFormation::Stack)  
**CWE ID:** CWE-778

#### Issue
The template does not define CloudWatch alarms or monitoring for the SageMaker endpoint, making it difficult to detect and respond to suspicious activity or performance issues.

#### Attack Vector
Security incidents or performance degradation may go unnoticed without proper monitoring and alerting.

#### Potential Impact
Delayed response to security incidents, unauthorized access, or model performance issues.

#### Remediation
Add CloudWatch Alarms for key metrics such as Invocations, InvocationsPerInstance, ModelLatency, and Errors. Configure appropriate thresholds and notification actions.

**References:**
- https://docs.aws.amazon.com/sagemaker/latest/dg/monitoring-cloudwatch.html

---

### SAGEMAKER-INFERENCE-ENDPOINT-UDOP-THREAT-008: Over-permissive S3 Access

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UDOPExecutionRole` (AWS::IAM::Role)  
**CWE ID:** CWE-732

#### Issue
The IAM role policy for S3 access grants read permissions to the entire S3 bucket specified in the S3Bucket parameter, rather than restricting access to only the necessary paths.

#### Attack Vector
If the SageMaker endpoint is compromised, an attacker could access any object in the specified S3 bucket, potentially accessing sensitive data unrelated to the model.

#### Potential Impact
Unauthorized access to sensitive data stored in the same S3 bucket but unrelated to the SageMaker model's operation.

#### Remediation
Restrict S3 access to only the specific paths needed for model operation by limiting the resources in the IAM policy to specific prefixes rather than granting access to the entire bucket.

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*