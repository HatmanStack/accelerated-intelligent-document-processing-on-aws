# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-07-59  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **10** security threats. The analysis reveals **0** critical, **2** high, **7** medium, and **1** low severity findings.

## Priority Actions

### 1. Implement content filtering to remove sensitive information before sending to Bedrock models. Restrict Bedrock model access to specific approved models only. Consider implementing PII detection and redaction before summarization.

**Effort:** High  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-006  
**Business Impact:** Exposure of confidential business information, PII, or regulated data to external AI services, potentially violating compliance requirements and data privacy regulations.

### 1. Apply the principle of least privilege by restricting permissions to only those operations needed (likely Get, Query, Scan, and potentially PutItem). Remove unnecessary DeleteItem, DeleteTable permissions.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-007  
**Business Impact:** Potential data loss, workflow disruption, and inability to process documents properly if DynamoDB records are deleted.

### 2. Configure log export to S3 or other centralized log storage solution for all log groups. Consider using CloudWatch Logs Subscription Filters to send logs to a central account or SIEM solution.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-001  
**Business Impact:** Limited ability to perform post-incident forensic analysis and potential compliance violations for log retention requirements.

### 2. Implement more restrictive IAM policies following the principle of least privilege. Limit S3 permissions to specific prefixes and operations needed, and restrict DynamoDB actions to only those required for function operation.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-003  
**Business Impact:** Potential unauthorized access to data in S3 buckets and DynamoDB tables, allowing data theft or tampering.

### 2. Implement integrity checks like checksums or digital signatures at each processing stage to verify documents haven't been modified. Store these checksums in a secured DynamoDB table.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-004  
**Business Impact:** Compromised data integrity leading to incorrect document processing results and potentially biased or malicious output.

### 3. Implement a mechanism to export and archive state machine execution histories to a long-term storage solution like S3 with appropriate lifecycle policies.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-002  
**Business Impact:** Limited ability to audit historical state machine executions for security incidents beyond the default retention period.

### 3. Configure reserved concurrency limits for critical Lambda functions to ensure they have dedicated resources. Implement throttling or rate limiting at the API level.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-005  
**Business Impact:** Service disruption affecting document processing capabilities and potentially other Lambda functions in the same AWS account.

### 3. Add additional event pattern matching criteria to verify the source identity, such as account-specific fields or additional detail attributes that would be difficult to spoof.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-008  
**Business Impact:** Processing of fraudulent events, potentially leading to incorrect document processing or HITL workflow manipulation.

### 3. Enable CloudWatch Contributor Insights for the DynamoDB table to track access patterns. Consider implementing advanced features like DynamoDB streams with Lambda to log changes to a secure audit log.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-010  
**Business Impact:** Reduced ability to perform forensic analysis and detect unusual access patterns, potentially allowing malicious activity to go undetected.

### 4. Implement an SQS access policy that restricts who can receive, delete, or purge messages from the queue. Consider implementing notification on message arrival to alert operations teams.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-009  
**Business Impact:** Loss of failed execution data that could be important for troubleshooting or security analysis.



## Detailed Threat Analysis

## High Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-006: Potential Sensitive Data Exposure via Bedrock Models

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-200

#### Issue
The SummarizationFunction has permissions to invoke any Bedrock foundation model and might send sensitive document contents to external AI models without proper data filtering.

#### Attack Vector
Sensitive or confidential information in processed documents could be sent to foundation models, potentially leading to data leakage or exposure.

#### Potential Impact
Exposure of confidential business information, PII, or regulated data to external AI services, potentially violating compliance requirements and data privacy regulations.

#### Remediation
Implement content filtering to remove sensitive information before sending to Bedrock models. Restrict Bedrock model access to specific approved models only. Consider implementing PII detection and redaction before summarization.

**References:**
- https://docs.aws.amazon.com/bedrock/latest/userguide/security-data.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-007: Overly Permissive DynamoDB Access

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `HITLProcessLambdaRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The HITLProcessLambdaRole has broad permissions on DynamoDB tables, including Delete operations that may not be necessary for its function.

#### Attack Vector
If compromised, an attacker could delete records from the DynamoDB tables, causing data loss or disrupting the document processing workflow.

#### Potential Impact
Potential data loss, workflow disruption, and inability to process documents properly if DynamoDB records are deleted.

#### Remediation
Apply the principle of least privilege by restricting permissions to only those operations needed (likely Get, Query, Scan, and potentially PutItem). Remove unnecessary DeleteItem, DeleteTable permissions.

**References:**
- https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/specifying-conditions.html

---

## Medium Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-001: Log Groups Not Configured with Log Export

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `All LogGroups` (AWS::Logs::LogGroup)  
**CWE ID:** CWE-778

#### Issue
Log groups are properly encrypted but not configured to export logs to a centralized location for long-term retention and security analysis.

#### Attack Vector
After a security incident, logs may not be available for forensic analysis if they remain only in CloudWatch and not exported to a durable location.

#### Potential Impact
Limited ability to perform post-incident forensic analysis and potential compliance violations for log retention requirements.

#### Remediation
Configure log export to S3 or other centralized log storage solution for all log groups. Consider using CloudWatch Logs Subscription Filters to send logs to a central account or SIEM solution.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/S3Export.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-002: Limited State Machine Execution History

**STRIDE Category:** Repudiation  
**Affected Resource:** `DocumentProcessingStateMachine` (AWS::StepFunctions::StateMachine)  
**CWE ID:** CWE-223

#### Issue
While the state machine has logging configured, there's no configuration for extended retention of execution history beyond the default period.

#### Attack Vector
Attackers could perform malicious actions and, after the default retention period, evidence of these actions would be purged.

#### Potential Impact
Limited ability to audit historical state machine executions for security incidents beyond the default retention period.

#### Remediation
Implement a mechanism to export and archive state machine execution histories to a long-term storage solution like S3 with appropriate lifecycle policies.

**References:**
- https://docs.aws.amazon.com/step-functions/latest/dg/cw-logs.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-003: Lambda Functions with Broad Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `InvokeBDAFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-272

#### Issue
Several Lambda functions have broad permissions for S3 buckets (S3CrudPolicy) and DynamoDB tables, which could allow for privilege escalation if the function is compromised.

#### Attack Vector
If a function is compromised (e.g., through dependency injection or code execution), an attacker could leverage the broad permissions to access or modify data they shouldn't have access to.

#### Potential Impact
Potential unauthorized access to data in S3 buckets and DynamoDB tables, allowing data theft or tampering.

#### Remediation
Implement more restrictive IAM policies following the principle of least privilege. Limit S3 permissions to specific prefixes and operations needed, and restrict DynamoDB actions to only those required for function operation.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-004: Potential Data Integrity Risk in Document Processing Workflow

**STRIDE Category:** Tampering  
**Affected Resource:** `DocumentProcessingStateMachine` (AWS::Serverless::StateMachine)  
**CWE ID:** CWE-345

#### Issue
The state machine handles document processing but lacks integrity verification steps to ensure documents haven't been tampered with between processing stages.

#### Attack Vector
An attacker with access to the S3 bucket could modify documents between processing steps, potentially affecting analysis results.

#### Potential Impact
Compromised data integrity leading to incorrect document processing results and potentially biased or malicious output.

#### Remediation
Implement integrity checks like checksums or digital signatures at each processing stage to verify documents haven't been modified. Store these checksums in a secured DynamoDB table.

**References:**
- https://docs.aws.amazon.com/AmazonS3/latest/userguide/checking-object-integrity.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-005: No Reserved Concurrency for Lambda Functions

**STRIDE Category:** Denial of Service  
**Affected Resource:** `All Lambda Functions` (AWS::Serverless::Function)  
**CWE ID:** CWE-400

#### Issue
Lambda functions don't have reserved concurrency configured, which could lead to resource exhaustion during high demand or potential DoS scenarios.

#### Attack Vector
An attacker could trigger numerous simultaneous requests, potentially exhausting the account's Lambda concurrency limit and affecting other systems.

#### Potential Impact
Service disruption affecting document processing capabilities and potentially other Lambda functions in the same AWS account.

#### Remediation
Configure reserved concurrency limits for critical Lambda functions to ensure they have dedicated resources. Implement throttling or rate limiting at the API level.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-008: Missing Source Identity Verification for EventBridge Rules

**STRIDE Category:** Spoofing  
**Affected Resource:** `HITLEventRule, BDAEventRule` (AWS::Events::Rule)  
**CWE ID:** CWE-290

#### Issue
EventBridge rules for HITL and BDA events don't verify the source identity beyond the source field, which could allow spoofed events.

#### Attack Vector
An attacker with appropriate permissions could potentially spoof events that match the pattern to trigger Lambda functions with false information.

#### Potential Impact
Processing of fraudulent events, potentially leading to incorrect document processing or HITL workflow manipulation.

#### Remediation
Add additional event pattern matching criteria to verify the source identity, such as account-specific fields or additional detail attributes that would be difficult to spoof.

**References:**
- https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-event-patterns.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-010: Missing DynamoDB Contributor Insights

**STRIDE Category:** Repudiation  
**Affected Resource:** `BDAMetadataTable` (AWS::DynamoDB::Table)  
**CWE ID:** CWE-778

#### Issue
The BDAMetadataTable doesn't have CloudWatch Contributor Insights enabled, making it difficult to track who made what changes to data.

#### Attack Vector
An attacker could modify data in the table, and it would be difficult to trace back to specific principals or identify unusual access patterns.

#### Potential Impact
Reduced ability to perform forensic analysis and detect unusual access patterns, potentially allowing malicious activity to go undetected.

#### Remediation
Enable CloudWatch Contributor Insights for the DynamoDB table to track access patterns. Consider implementing advanced features like DynamoDB streams with Lambda to log changes to a secure audit log.

**References:**
- https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/contributorinsights.html

---

## Low Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-009: Dead Letter Queue Without Access Policy

**STRIDE Category:** Tampering  
**Affected Resource:** `BDACompletionFunctionDLQ` (AWS::SQS::Queue)  
**CWE ID:** CWE-284

#### Issue
The BDACompletionFunctionDLQ has encryption but no explicit access policy to restrict who can receive or delete messages from the queue.

#### Attack Vector
An attacker with appropriate IAM permissions could purge or consume messages from the DLQ, potentially hiding failed execution evidence.

#### Potential Impact
Loss of failed execution data that could be important for troubleshooting or security analysis.

#### Remediation
Implement an SQS access policy that restricts who can receive, delete, or purge messages from the queue. Consider implementing notification on message arrival to alert operations teams.

**References:**
- https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-authentication-and-access-control.html

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*