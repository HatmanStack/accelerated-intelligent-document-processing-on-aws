# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-07-38  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **10** security threats. The analysis reveals **0** critical, **4** high, **4** medium, and **2** low severity findings.

## Priority Actions

### 1. Scope S3 permissions to only the specific buckets required for function operation. Replace 'arn:aws:s3:::*' with specific bucket ARNs needed by the Lambda function

**Effort:** Low  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-001  
**Business Impact:** Unauthorized access to sensitive data across all S3 buckets in the account, potential data exfiltration or corruption

### 1. Set 'AllowFromPublic: false' and implement more restrictive access controls such as VPC endpoints, IP-based restrictions, or IAM-based access

**Effort:** Medium  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-004  
**Business Impact:** Potential unauthorized access to sensitive data, increased attack surface, and violation of security best practices for internal analytics services

### 2. Review and restrict the X-Ray permissions to only what is necessary for the function's operation. While X-Ray actions often require wildcard resources, ensure the policy follows least privilege principles

**Effort:** Low  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-002  
**Business Impact:** Potential for privilege escalation and exploitation of compromised credentials across AWS services

### 2. Scope down OpenSearch Serverless permissions to only the specific collections needed and only the specific actions required by the function

**Effort:** Medium  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-003  
**Business Impact:** Unauthorized access to sensitive data in OpenSearch collections, potential for data exfiltration or tampering

### 3. Enhance logging by implementing structured logging with AWS Lambda Powertools or similar frameworks, ensure all administrative actions are logged, and consider implementing centralized log management

**Effort:** Medium  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-005  
**Business Impact:** Inability to effectively investigate security incidents, potential compliance violations regarding audit trails

### 3. Use customer-managed KMS keys (CMK) for encryption by setting AWSOwnedKey to false and providing a KMS key ARN

**Effort:** Medium  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-006  
**Business Impact:** Reduced security control over encryption keys, inability to immediately revoke key access in case of compromise, and potential compliance issues for sensitive data

### 3. Configure a Dead Letter Queue (SQS or SNS) for each Lambda function to capture failed executions and implement proper error handling and recovery mechanisms

**Effort:** Low  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-007  
**Business Impact:** Potential service disruptions, loss of operations data, and inability to diagnose and recover from failures

### 3. Restrict bedrock:InvokeModel permissions to only the specific models needed by specifying exact model ARNs rather than using wildcards

**Effort:** Low  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-008  
**Business Impact:** Potential abuse of foundation model access, increased costs, and possible regulatory or compliance issues depending on model outputs

### 4. Set Lambda function timeout to the minimum required duration for its operation, typically starting with 30 seconds and increasing only if needed based on observed execution times

**Effort:** Low  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-009  
**Business Impact:** Increased resource consumption, higher AWS costs, and extended time window for potential exploitation

### 4. Implement mechanisms to ensure only one ingestion job runs at a time, such as using DynamoDB for distributed locking or implementing state checks before starting new jobs

**Effort:** Medium  
**Related Threats:** BEDROCK-KNOWLEDGE-BASE-THREAT-010  
**Business Impact:** Potential service disruption, increased API rate limiting, and higher costs due to concurrent resource usage



## Detailed Threat Analysis

## High Severity Threats

### BEDROCK-KNOWLEDGE-BASE-THREAT-001: Overly Permissive IAM Role Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OpenSearchLambdaExecutionRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The OpenSearchLambdaExecutionRole has overly broad S3 permissions (s3:PutObject*, s3:GetObject*, s3:DeleteObject*) on all S3 buckets (arn:aws:s3:::*)

#### Attack Vector
An attacker who compromises the Lambda function could access or modify data in any S3 bucket in the account, beyond what's needed for the function's operation

#### Potential Impact
Unauthorized access to sensitive data across all S3 buckets in the account, potential data exfiltration or corruption

#### Remediation
Scope S3 permissions to only the specific buckets required for function operation. Replace 'arn:aws:s3:::*' with specific bucket ARNs needed by the Lambda function

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-002: Wildcard Resource Permissions for AWS X-Ray

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OpenSearchLambdaExecutionRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The X-Ray permissions in the OpenSearchLambdaExecutionRole policy use a wildcard resource ('*') which grants excessive permissions

#### Attack Vector
If the Lambda function is compromised, an attacker could leverage these permissions to gain broader access to AWS resources or perform reconnaissance activities

#### Potential Impact
Potential for privilege escalation and exploitation of compromised credentials across AWS services

#### Remediation
Review and restrict the X-Ray permissions to only what is necessary for the function's operation. While X-Ray actions often require wildcard resources, ensure the policy follows least privilege principles

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-003: Excessive OpenSearch Serverless Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OpenSearchLambdaExecutionRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The OpenSearchLambdaExecutionRole has broad permissions on OpenSearch Serverless APIs with wildcard resources, exceeding what's likely needed for index management

#### Attack Vector
An attacker who compromises the Lambda function could manipulate or access any OpenSearch Serverless collection in the account

#### Potential Impact
Unauthorized access to sensitive data in OpenSearch collections, potential for data exfiltration or tampering

#### Remediation
Scope down OpenSearch Serverless permissions to only the specific collections needed and only the specific actions required by the function

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-004: OpenSearch Serverless Dashboard Publicly Accessible

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `OSSNetworkPolicy` (AWS::OpenSearchServerless::SecurityPolicy)  
**CWE ID:** CWE-284

#### Issue
The OpenSearch Serverless network policy is configured with 'AllowFromPublic: true', making the dashboard publicly accessible from the internet

#### Attack Vector
Anyone on the internet can access the OpenSearch dashboard, which could expose sensitive data or administrative interfaces if authentication is compromised

#### Potential Impact
Potential unauthorized access to sensitive data, increased attack surface, and violation of security best practices for internal analytics services

#### Remediation
Set 'AllowFromPublic: false' and implement more restrictive access controls such as VPC endpoints, IP-based restrictions, or IAM-based access

**References:**
- https://docs.aws.amazon.com/opensearch-service/latest/developerguide/security-iam-serverless.html

---

## Medium Severity Threats

### BEDROCK-KNOWLEDGE-BASE-THREAT-005: Insufficient Logging Configuration

**STRIDE Category:** Repudiation  
**Affected Resource:** `GetAdjustedStackNameFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-778

#### Issue
Lambda functions have minimal logging configuration and don't implement comprehensive audit trails for actions performed by the functions

#### Attack Vector
If a security incident occurs, there may be insufficient logs to identify the source, nature, and impact of the incident

#### Potential Impact
Inability to effectively investigate security incidents, potential compliance violations regarding audit trails

#### Remediation
Enhance logging by implementing structured logging with AWS Lambda Powertools or similar frameworks, ensure all administrative actions are logged, and consider implementing centralized log management

**References:**
- https://docs.aws.amazon.com/prescriptive-guidance/latest/lambda-powertools/introduction.html

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-006: Default AWS Owned Encryption Key for OpenSearch Collection

**STRIDE Category:** Tampering  
**Affected Resource:** `OSSCollection` (AWS::OpenSearchServerless::Collection)  
**CWE ID:** CWE-311

#### Issue
The OpenSearch Serverless collection uses AWS-owned keys (AWSOwnedKey: true) rather than customer-managed keys for encryption

#### Attack Vector
If AWS account credentials are compromised, the attacker would have access to both the data and the encryption keys

#### Potential Impact
Reduced security control over encryption keys, inability to immediately revoke key access in case of compromise, and potential compliance issues for sensitive data

#### Remediation
Use customer-managed KMS keys (CMK) for encryption by setting AWSOwnedKey to false and providing a KMS key ARN

**References:**
- https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-007: Missing Dead Letter Queue for Lambda Functions

**STRIDE Category:** Denial of Service  
**Affected Resource:** `CreateOSSIndexLambdaFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-755

#### Issue
Lambda functions lack Dead Letter Queue (DLQ) configuration for handling failed function executions

#### Attack Vector
In case of function failures, especially during critical operations like index creation, there is no mechanism to capture and recover from these failures

#### Potential Impact
Potential service disruptions, loss of operations data, and inability to diagnose and recover from failures

#### Remediation
Configure a Dead Letter Queue (SQS or SNS) for each Lambda function to capture failed executions and implement proper error handling and recovery mechanisms

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html#dlq

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-008: Broad BedrockInvokeModel Permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `KnowledgeBaseServiceRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The KnowledgeBaseServiceRole has permissions to invoke any foundation model in Bedrock (bedrock:InvokeModel on arn:aws:bedrock:${AWS::Region}::foundation-model/*)

#### Attack Vector
If compromised, an attacker could potentially use any Bedrock model, including those with more capabilities or higher costs than required for the application

#### Potential Impact
Potential abuse of foundation model access, increased costs, and possible regulatory or compliance issues depending on model outputs

#### Remediation
Restrict bedrock:InvokeModel permissions to only the specific models needed by specifying exact model ARNs rather than using wildcards

**References:**
- https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonbedrock.html

---

## Low Severity Threats

### BEDROCK-KNOWLEDGE-BASE-THREAT-009: Excessive Lambda Function Timeout

**STRIDE Category:** Tampering  
**Affected Resource:** `StartIngestionJobFunction` (AWS::Lambda::Function)  
**CWE ID:** CWE-770

#### Issue
The StartIngestionJobFunction has a timeout of 600 seconds (10 minutes), which is significantly higher than likely needed for its task

#### Attack Vector
A compromised function could run for an extended period, potentially allowing an attacker more time to execute malicious activities or cause denial of service by consuming resources

#### Potential Impact
Increased resource consumption, higher AWS costs, and extended time window for potential exploitation

#### Remediation
Set Lambda function timeout to the minimum required duration for its operation, typically starting with 30 seconds and increasing only if needed based on observed execution times

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html

---

### BEDROCK-KNOWLEDGE-BASE-THREAT-010: Missing Concurrency Controls for Scheduled Jobs

**STRIDE Category:** Denial of Service  
**Affected Resource:** `S3DataSourceScheduler` (AWS::Scheduler::Schedule)  
**CWE ID:** CWE-770

#### Issue
The EventBridge schedulers for data sources lack concurrency controls, which could lead to multiple concurrent ingestion jobs being triggered

#### Attack Vector
If multiple ingestion jobs run concurrently, they could consume excessive resources, leading to throttling, increased costs, or service degradation

#### Potential Impact
Potential service disruption, increased API rate limiting, and higher costs due to concurrent resource usage

#### Remediation
Implement mechanisms to ensure only one ingestion job runs at a time, such as using DynamoDB for distributed locking or implementing state checks before starting new jobs

**References:**
- https://docs.aws.amazon.com/scheduler/latest/UserGuide/schedule-types.html#rate-based

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*