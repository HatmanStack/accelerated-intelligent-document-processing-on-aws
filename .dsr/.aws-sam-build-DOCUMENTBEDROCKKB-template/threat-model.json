[
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-001",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Elevation of Privilege",
    "severity": "Medium",
    "resource_type": "AWS::IAM::Role",
    "resource_name": "OpenSearchLambdaExecutionRole",
    "title": "Overly Permissive IAM Policies",
    "issue": "The OpenSearchLambdaExecutionRole has multiple policies with broad permissions including 'Resource: *' wildcards in several statements, particularly for S3 operations and OpenSearch Serverless API actions.",
    "attack_vector": "If the Lambda function is compromised, an attacker could leverage these broad permissions to access unintended S3 buckets or perform unauthorized actions on OpenSearch Serverless resources.",
    "impact": "Potential unauthorized access to S3 data outside the intended scope and ability to manipulate OpenSearch Serverless collections beyond what's necessary for the function's operation.",
    "remediation": "Scope down IAM permissions by restricting S3 access to specific buckets and objects relevant to the function's operation. Limit OpenSearch Serverless API actions to specific collections using ARNs where possible instead of using '*' resource specifiers.",
    "priority": 2,
    "estimated_effort": "Medium",
    "cwe_id": "CWE-272",
    "compliance_violations": ["CIS AWS Foundations Benchmark 1.16"],
    "references": ["https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-002",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Information Disclosure",
    "resource_type": "AWS::OpenSearchServerless::SecurityPolicy",
    "resource_name": "OSSNetworkPolicy",
    "severity": "High",
    "title": "Public Access to OpenSearch Serverless Collections",
    "issue": "The OSSNetworkPolicy allows public access to OpenSearch Serverless collections and dashboards by setting 'AllowFromPublic: true'",
    "attack_vector": "Unauthorized users may attempt to access the OpenSearch Serverless dashboard or collection endpoints from the public internet, potentially leading to unauthorized data access if authentication is misconfigured.",
    "impact": "Potential exposure of sensitive data indexed in the OpenSearch Serverless collection or unauthorized access to search capabilities.",
    "remediation": "Restrict access to OpenSearch Serverless resources to specific VPC endpoints or IP ranges instead of allowing public access. Implement strong authentication mechanisms for all OpenSearch Serverless access.",
    "priority": 1,
    "estimated_effort": "Medium",
    "cwe_id": "CWE-668",
    "compliance_violations": ["CIS AWS Foundations Benchmark 2.2.1", "GDPR Article 32"],
    "references": ["https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-security.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-003",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Tampering",
    "severity": "Medium",
    "resource_type": "AWS::OpenSearchServerless::SecurityPolicy",
    "resource_name": "OSSEncryptionPolicy",
    "title": "Default AWS-Owned Encryption Key Used",
    "issue": "The OpenSearch Serverless collection is configured to use AWS-owned encryption keys ('AWSOwnedKey': true) rather than customer-managed keys, potentially reducing control over data encryption.",
    "attack_vector": "In case of a compromise of AWS-managed keys or if regulatory requirements demand customer control of encryption keys, this configuration could expose data to unauthorized access.",
    "impact": "Reduced control over encryption key lifecycle and potential compliance issues with regulations requiring customer-managed encryption.",
    "remediation": "Consider using a customer-managed KMS key for OpenSearch Serverless encryption, especially for sensitive or regulated data. Modify the OSSEncryptionPolicy to use customer-managed keys by specifying a KMS key ARN.",
    "priority": 3,
    "estimated_effort": "Low",
    "cwe_id": "CWE-311",
    "compliance_violations": ["HIPAA", "PCI DSS 3.4"],
    "references": ["https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-encryption.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-004",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Repudiation",
    "severity": "Medium",
    "resource_type": "AWS::Bedrock::KnowledgeBase",
    "resource_name": "KnowledgeBase",
    "title": "Missing Monitoring and Logging Configuration",
    "issue": "The template does not define CloudWatch logging or monitoring for Bedrock Knowledge Base operations, making it difficult to track access, usage, and potential misuse.",
    "attack_vector": "Without proper logging, attackers could abuse the Bedrock Knowledge Base and associated resources without leaving an audit trail, making incident investigation difficult.",
    "impact": "Limited visibility into resource usage, potential security incidents, and compliance violations. Difficulty in forensic analysis if a breach occurs.",
    "remediation": "Implement CloudWatch logging for Bedrock resources. Consider enabling AWS CloudTrail with appropriate log retention for API activity. Set up alarms for suspicious activity patterns.",
    "priority": 2,
    "estimated_effort": "Medium",
    "cwe_id": "CWE-778",
    "compliance_violations": ["CIS AWS Foundations Benchmark 3.1", "SOC 2"],
    "references": ["https://docs.aws.amazon.com/bedrock/latest/userguide/monitoring.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-005",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Elevation of Privilege",
    "severity": "High",
    "resource_type": "AWS::IAM::Role",
    "resource_name": "KnowledgeBaseServiceRole",
    "title": "Overly Permissive bedrock:InvokeModel Permission",
    "issue": "The KnowledgeBaseServiceRole has permission to invoke any Bedrock foundation model with the wildcard resource 'arn:aws:bedrock:${AWS::Region}::foundation-model/*'",
    "attack_vector": "If the role is compromised, an attacker could invoke any Bedrock model, potentially using expensive models or extracting sensitive information through crafted prompts.",
    "impact": "Potential for cost escalation through unauthorized model usage, data exfiltration through model responses, or abuse of AI capabilities.",
    "remediation": "Restrict the bedrock:InvokeModel permission to only the specific embedding model required by the Knowledge Base by specifying the exact model ARN instead of using wildcards.",
    "priority": 1,
    "estimated_effort": "Low",
    "cwe_id": "CWE-272",
    "compliance_violations": ["CIS AWS Foundations Benchmark 1.16"],
    "references": ["https://docs.aws.amazon.com/bedrock/latest/userguide/security_iam_service-with-iam.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-006",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Tampering",
    "severity": "Medium",
    "resource_type": "AWS::Serverless::Function",
    "resource_name": "GetAdjustedStackNameFunction, GetSeedUrlsFunction",
    "title": "Lambda Functions Without Input Validation",
    "issue": "The inline Lambda functions for GetAdjustedStackName and GetSeedUrls do not implement proper input validation for the data they process, potentially allowing injection attacks or unexpected behavior.",
    "attack_vector": "Malicious input could potentially cause unexpected behavior if the Lambda functions process untrusted data without proper validation.",
    "impact": "Potential for function misuse, unexpected errors, or resource manipulation if custom resources are exploited.",
    "remediation": "Implement input validation in Lambda function code to ensure parameters meet expected formats and ranges. Consider adding error handling to gracefully handle invalid inputs.",
    "priority": 3,
    "estimated_effort": "Low",
    "cwe_id": "CWE-20",
    "compliance_violations": ["OWASP Top 10 A1:2021-Broken Access Control"],
    "references": ["https://docs.aws.amazon.com/lambda/latest/dg/lambda-security.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-007",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Denial of Service",
    "severity": "Low",
    "resource_type": "AWS::Bedrock::DataSource",
    "resource_name": "WebDataSource",
    "title": "Web Crawler Rate Limits Could Be Exploited",
    "issue": "The WebDataSource crawler is configured with a relatively high rate limit of 300, which could potentially be used for DoS attacks against target websites if misconfigured.",
    "attack_vector": "A misconfigured crawler with high rate limits could overwhelm target websites or trigger anti-scraping measures, disrupting service for legitimate users.",
    "impact": "Potential for inadvertent DoS against crawled websites, damaged business relationships, or IP address blocking by target sites.",
    "remediation": "Consider setting a more conservative rate limit for the web crawler. Implement progressive crawling patterns and respect robots.txt files. Monitor crawler behavior to ensure it doesn't cause disruption.",
    "priority": 4,
    "estimated_effort": "Low",
    "cwe_id": "CWE-400",
    "compliance_violations": [],
    "references": ["https://docs.aws.amazon.com/bedrock/latest/userguide/knowledge-base-crawlers.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-008",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Information Disclosure",
    "severity": "Medium",
    "resource_type": "AWS::Lambda::Function",
    "resource_name": "StartIngestionJobFunction",
    "title": "Lambda Code from External S3 Bucket",
    "issue": "The StartIngestionJobFunction code is sourced from an S3 bucket ('bobs-artifacts-us-west-2') which may present supply chain risks if the bucket is compromised or the code is altered without verification.",
    "attack_vector": "If the source S3 bucket is compromised, malicious code could be injected into the Lambda function, potentially allowing attackers to execute arbitrary code within the AWS environment.",
    "impact": "Potential execution of unauthorized code within the AWS account, which could lead to data exfiltration, credential theft, or further privilege escalation.",
    "remediation": "Consider packaging Lambda code directly within the CloudFormation template or use a secure CI/CD pipeline with code signing. Ensure the S3 bucket has appropriate access controls and versioning enabled. Implement integrity checks for Lambda code.",
    "priority": 2,
    "estimated_effort": "Medium",
    "cwe_id": "CWE-494",
    "compliance_violations": ["NIST 800-53 CM-5"],
    "references": ["https://docs.aws.amazon.com/lambda/latest/dg/lambda-security.html"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-009",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Elevation of Privilege",
    "severity": "Medium",
    "resource_type": "AWS::IAM::Role",
    "resource_name": "DataSourceSchedulerRole",
    "title": "Limited Scope in Scheduler Role Permissions",
    "issue": "The DataSourceSchedulerRole has permissions to start ingestion jobs on any knowledge base within the account, not just the specific knowledge base created by this template.",
    "attack_vector": "If the scheduler role is compromised, an attacker could potentially trigger ingestion jobs for other knowledge bases in the account.",
    "impact": "Potential disruption of other knowledge bases in the account, possible data contamination or resource exhaustion.",
    "remediation": "Scope down the bedrock:StartIngestionJob permission to specifically reference the knowledge base created in this template by using the specific ARN rather than a wildcard in the resource element.",
    "priority": 3,
    "estimated_effort": "Low",
    "cwe_id": "CWE-272",
    "compliance_violations": ["CIS AWS Foundations Benchmark 1.16"],
    "references": ["https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege"],
    "status": "Open"
  },
  {
    "id": "AWS_GENAI_IDP_ACCELERATOR_BEDROCK_KNOWLEDGE_BASE_SETUP-THREAT-010",
    "stack": "AWS GenAI IDP Accelerator - Bedrock Knowledge Base setup",
    "stride_category": "Spoofing",
    "severity": "Low",
    "resource_type": "AWS::Scheduler::Schedule",
    "resource_name": "S3DataSourceScheduler, WebDataSourceScheduler",
    "title": "Missing Authentication for Scheduled Job Triggers",
    "issue": "The scheduled jobs for S3 and Web data source synchronization do not have additional authentication mechanisms beyond the IAM role, potentially allowing anyone who can assume the role to trigger ingestion jobs.",
    "attack_vector": "If the scheduler role credentials are obtained, an attacker could trigger ingestion jobs at will, potentially causing resource consumption or service disruption.",
    "impact": "Potential for unauthorized triggering of resource-intensive operations leading to increased costs or service disruption.",
    "remediation": "Consider implementing additional authentication mechanisms for critical scheduled operations. Monitor for unusual patterns in scheduled job execution. Implement alerting for job failures or unexpected execution patterns.",
    "priority": 4,
    "estimated_effort": "Medium",
    "cwe_id": "CWE-306",
    "compliance_violations": [],
    "references": ["https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-security.html"],
    "status": "Open"
  }
]