{"check_type": "cloudformation", "results": {"failed_checks": [{"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[956, "  OCRFunction:\n"], [957, "    Type: AWS::Serverless::Function\n"], [958, "    Metadata:\n"], [959, "      SamResourceId: OCRFunction\n"], [960, "      cfn_nag:\n"], [961, "        rules_to_suppress:\n"], [962, "        - id: W89\n"], [963, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [964, "            with AWS services via AWS APIs\n"], [965, "        - id: W92\n"], [966, "          reason: Function does not require concurrent execution limits as it is designed\n"], [967, "            to scale based on demand\n"], [968, "        - id: W11\n"], [969, "          reason: Textract DetectDocumentText API and Cloudwatch APIs do not support\n"], [970, "            resource-level permissions\n"], [971, "    Properties:\n"], [972, "      PermissionsBoundary:\n"], [973, "        Fn::If:\n"], [974, "        - HasPermissionsBoundary\n"], [975, "        - Ref: PermissionsBoundaryArn\n"], [976, "        - Ref: AWS::NoValue\n"], [977, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/44b18ef4c86ab5d8710036ebd4c5e1e9\n"], [978, "      Handler: index.handler\n"], [979, "      Runtime: python3.12\n"], [980, "      Timeout: 900\n"], [981, "      MemorySize: 4096\n"], [982, "      Environment:\n"], [983, "        Variables:\n"], [984, "          METRIC_NAMESPACE:\n"], [985, "            Ref: StackName\n"], [986, "          MAX_WORKERS: 20\n"], [987, "          CONFIGURATION_TABLE_NAME:\n"], [988, "            Ref: ConfigurationTable\n"], [989, "          LOG_LEVEL:\n"], [990, "            Ref: LogLevel\n"], [991, "          APPSYNC_API_URL:\n"], [992, "            Ref: AppSyncApiUrl\n"], [993, "          WORKING_BUCKET:\n"], [994, "            Ref: WorkingBucket\n"], [995, "      LoggingConfig:\n"], [996, "        LogGroup:\n"], [997, "          Ref: OCRFunctionLogGroup\n"], [998, "      Policies:\n"], [999, "      - AWSLambdaBasicExecutionRole\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: OutputBucket\n"], [1003, "      - S3CrudPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: WorkingBucket\n"], [1006, "      - S3ReadPolicy:\n"], [1007, "          BucketName:\n"], [1008, "            Ref: InputBucket\n"], [1009, "      - DynamoDBCrudPolicy:\n"], [1010, "          TableName:\n"], [1011, "            Ref: ConfigurationTable\n"], [1012, "      - Statement:\n"], [1013, "        - Effect: Allow\n"], [1014, "          Action: cloudwatch:PutMetricData\n"], [1015, "          Resource: '*'\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action:\n"], [1018, "          - kms:Encrypt\n"], [1019, "          - kms:Decrypt\n"], [1020, "          - kms:ReEncrypt*\n"], [1021, "          - kms:GenerateDataKey*\n"], [1022, "          - kms:DescribeKey\n"], [1023, "          Resource:\n"], [1024, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1025, "        - Effect: Allow\n"], [1026, "          Action:\n"], [1027, "          - textract:DetectDocumentText\n"], [1028, "          - textract:AnalyzeDocument\n"], [1029, "          Resource: '*'\n"], [1030, "        - Effect: Allow\n"], [1031, "          Action: bedrock:InvokeModel\n"], [1032, "          Resource:\n"], [1033, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1034, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1035, "        - Effect: Allow\n"], [1036, "          Action:\n"], [1037, "          - appsync:GraphQL\n"], [1038, "          Resource:\n"], [1039, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [956, 1039], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[956, "  OCRFunction:\n"], [957, "    Type: AWS::Serverless::Function\n"], [958, "    Metadata:\n"], [959, "      SamResourceId: OCRFunction\n"], [960, "      cfn_nag:\n"], [961, "        rules_to_suppress:\n"], [962, "        - id: W89\n"], [963, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [964, "            with AWS services via AWS APIs\n"], [965, "        - id: W92\n"], [966, "          reason: Function does not require concurrent execution limits as it is designed\n"], [967, "            to scale based on demand\n"], [968, "        - id: W11\n"], [969, "          reason: Textract DetectDocumentText API and Cloudwatch APIs do not support\n"], [970, "            resource-level permissions\n"], [971, "    Properties:\n"], [972, "      PermissionsBoundary:\n"], [973, "        Fn::If:\n"], [974, "        - HasPermissionsBoundary\n"], [975, "        - Ref: PermissionsBoundaryArn\n"], [976, "        - Ref: AWS::NoValue\n"], [977, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/44b18ef4c86ab5d8710036ebd4c5e1e9\n"], [978, "      Handler: index.handler\n"], [979, "      Runtime: python3.12\n"], [980, "      Timeout: 900\n"], [981, "      MemorySize: 4096\n"], [982, "      Environment:\n"], [983, "        Variables:\n"], [984, "          METRIC_NAMESPACE:\n"], [985, "            Ref: StackName\n"], [986, "          MAX_WORKERS: 20\n"], [987, "          CONFIGURATION_TABLE_NAME:\n"], [988, "            Ref: ConfigurationTable\n"], [989, "          LOG_LEVEL:\n"], [990, "            Ref: LogLevel\n"], [991, "          APPSYNC_API_URL:\n"], [992, "            Ref: AppSyncApiUrl\n"], [993, "          WORKING_BUCKET:\n"], [994, "            Ref: WorkingBucket\n"], [995, "      LoggingConfig:\n"], [996, "        LogGroup:\n"], [997, "          Ref: OCRFunctionLogGroup\n"], [998, "      Policies:\n"], [999, "      - AWSLambdaBasicExecutionRole\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: OutputBucket\n"], [1003, "      - S3CrudPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: WorkingBucket\n"], [1006, "      - S3ReadPolicy:\n"], [1007, "          BucketName:\n"], [1008, "            Ref: InputBucket\n"], [1009, "      - DynamoDBCrudPolicy:\n"], [1010, "          TableName:\n"], [1011, "            Ref: ConfigurationTable\n"], [1012, "      - Statement:\n"], [1013, "        - Effect: Allow\n"], [1014, "          Action: cloudwatch:PutMetricData\n"], [1015, "          Resource: '*'\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action:\n"], [1018, "          - kms:Encrypt\n"], [1019, "          - kms:Decrypt\n"], [1020, "          - kms:ReEncrypt*\n"], [1021, "          - kms:GenerateDataKey*\n"], [1022, "          - kms:DescribeKey\n"], [1023, "          Resource:\n"], [1024, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1025, "        - Effect: Allow\n"], [1026, "          Action:\n"], [1027, "          - textract:DetectDocumentText\n"], [1028, "          - textract:AnalyzeDocument\n"], [1029, "          Resource: '*'\n"], [1030, "        - Effect: Allow\n"], [1031, "          Action: bedrock:InvokeModel\n"], [1032, "          Resource:\n"], [1033, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1034, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1035, "        - Effect: Allow\n"], [1036, "          Action:\n"], [1037, "          - appsync:GraphQL\n"], [1038, "          Resource:\n"], [1039, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [956, 1039], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[956, "  OCRFunction:\n"], [957, "    Type: AWS::Serverless::Function\n"], [958, "    Metadata:\n"], [959, "      SamResourceId: OCRFunction\n"], [960, "      cfn_nag:\n"], [961, "        rules_to_suppress:\n"], [962, "        - id: W89\n"], [963, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [964, "            with AWS services via AWS APIs\n"], [965, "        - id: W92\n"], [966, "          reason: Function does not require concurrent execution limits as it is designed\n"], [967, "            to scale based on demand\n"], [968, "        - id: W11\n"], [969, "          reason: Textract DetectDocumentText API and Cloudwatch APIs do not support\n"], [970, "            resource-level permissions\n"], [971, "    Properties:\n"], [972, "      PermissionsBoundary:\n"], [973, "        Fn::If:\n"], [974, "        - HasPermissionsBoundary\n"], [975, "        - Ref: PermissionsBoundaryArn\n"], [976, "        - Ref: AWS::NoValue\n"], [977, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/44b18ef4c86ab5d8710036ebd4c5e1e9\n"], [978, "      Handler: index.handler\n"], [979, "      Runtime: python3.12\n"], [980, "      Timeout: 900\n"], [981, "      MemorySize: 4096\n"], [982, "      Environment:\n"], [983, "        Variables:\n"], [984, "          METRIC_NAMESPACE:\n"], [985, "            Ref: StackName\n"], [986, "          MAX_WORKERS: 20\n"], [987, "          CONFIGURATION_TABLE_NAME:\n"], [988, "            Ref: ConfigurationTable\n"], [989, "          LOG_LEVEL:\n"], [990, "            Ref: LogLevel\n"], [991, "          APPSYNC_API_URL:\n"], [992, "            Ref: AppSyncApiUrl\n"], [993, "          WORKING_BUCKET:\n"], [994, "            Ref: WorkingBucket\n"], [995, "      LoggingConfig:\n"], [996, "        LogGroup:\n"], [997, "          Ref: OCRFunctionLogGroup\n"], [998, "      Policies:\n"], [999, "      - AWSLambdaBasicExecutionRole\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: OutputBucket\n"], [1003, "      - S3CrudPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: WorkingBucket\n"], [1006, "      - S3ReadPolicy:\n"], [1007, "          BucketName:\n"], [1008, "            Ref: InputBucket\n"], [1009, "      - DynamoDBCrudPolicy:\n"], [1010, "          TableName:\n"], [1011, "            Ref: ConfigurationTable\n"], [1012, "      - Statement:\n"], [1013, "        - Effect: Allow\n"], [1014, "          Action: cloudwatch:PutMetricData\n"], [1015, "          Resource: '*'\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action:\n"], [1018, "          - kms:Encrypt\n"], [1019, "          - kms:Decrypt\n"], [1020, "          - kms:ReEncrypt*\n"], [1021, "          - kms:GenerateDataKey*\n"], [1022, "          - kms:DescribeKey\n"], [1023, "          Resource:\n"], [1024, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1025, "        - Effect: Allow\n"], [1026, "          Action:\n"], [1027, "          - textract:DetectDocumentText\n"], [1028, "          - textract:AnalyzeDocument\n"], [1029, "          Resource: '*'\n"], [1030, "        - Effect: Allow\n"], [1031, "          Action: bedrock:InvokeModel\n"], [1032, "          Resource:\n"], [1033, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1034, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1035, "        - Effect: Allow\n"], [1036, "          Action:\n"], [1037, "          - appsync:GraphQL\n"], [1038, "          Resource:\n"], [1039, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [956, 1039], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[956, "  OCRFunction:\n"], [957, "    Type: AWS::Serverless::Function\n"], [958, "    Metadata:\n"], [959, "      SamResourceId: OCRFunction\n"], [960, "      cfn_nag:\n"], [961, "        rules_to_suppress:\n"], [962, "        - id: W89\n"], [963, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [964, "            with AWS services via AWS APIs\n"], [965, "        - id: W92\n"], [966, "          reason: Function does not require concurrent execution limits as it is designed\n"], [967, "            to scale based on demand\n"], [968, "        - id: W11\n"], [969, "          reason: Textract DetectDocumentText API and Cloudwatch APIs do not support\n"], [970, "            resource-level permissions\n"], [971, "    Properties:\n"], [972, "      PermissionsBoundary:\n"], [973, "        Fn::If:\n"], [974, "        - HasPermissionsBoundary\n"], [975, "        - Ref: PermissionsBoundaryArn\n"], [976, "        - Ref: AWS::NoValue\n"], [977, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/44b18ef4c86ab5d8710036ebd4c5e1e9\n"], [978, "      Handler: index.handler\n"], [979, "      Runtime: python3.12\n"], [980, "      Timeout: 900\n"], [981, "      MemorySize: 4096\n"], [982, "      Environment:\n"], [983, "        Variables:\n"], [984, "          METRIC_NAMESPACE:\n"], [985, "            Ref: StackName\n"], [986, "          MAX_WORKERS: 20\n"], [987, "          CONFIGURATION_TABLE_NAME:\n"], [988, "            Ref: ConfigurationTable\n"], [989, "          LOG_LEVEL:\n"], [990, "            Ref: LogLevel\n"], [991, "          APPSYNC_API_URL:\n"], [992, "            Ref: AppSyncApiUrl\n"], [993, "          WORKING_BUCKET:\n"], [994, "            Ref: WorkingBucket\n"], [995, "      LoggingConfig:\n"], [996, "        LogGroup:\n"], [997, "          Ref: OCRFunctionLogGroup\n"], [998, "      Policies:\n"], [999, "      - AWSLambdaBasicExecutionRole\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: OutputBucket\n"], [1003, "      - S3CrudPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: WorkingBucket\n"], [1006, "      - S3ReadPolicy:\n"], [1007, "          BucketName:\n"], [1008, "            Ref: InputBucket\n"], [1009, "      - DynamoDBCrudPolicy:\n"], [1010, "          TableName:\n"], [1011, "            Ref: ConfigurationTable\n"], [1012, "      - Statement:\n"], [1013, "        - Effect: Allow\n"], [1014, "          Action: cloudwatch:PutMetricData\n"], [1015, "          Resource: '*'\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action:\n"], [1018, "          - kms:Encrypt\n"], [1019, "          - kms:Decrypt\n"], [1020, "          - kms:ReEncrypt*\n"], [1021, "          - kms:GenerateDataKey*\n"], [1022, "          - kms:DescribeKey\n"], [1023, "          Resource:\n"], [1024, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1025, "        - Effect: Allow\n"], [1026, "          Action:\n"], [1027, "          - textract:DetectDocumentText\n"], [1028, "          - textract:AnalyzeDocument\n"], [1029, "          Resource: '*'\n"], [1030, "        - Effect: Allow\n"], [1031, "          Action: bedrock:InvokeModel\n"], [1032, "          Resource:\n"], [1033, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1034, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1035, "        - Effect: Allow\n"], [1036, "          Action:\n"], [1037, "          - appsync:GraphQL\n"], [1038, "          Resource:\n"], [1039, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [956, 1039], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1051, "  ClassificationFunction:\n"], [1052, "    Type: AWS::Serverless::Function\n"], [1053, "    Metadata:\n"], [1054, "      SamResourceId: ClassificationFunction\n"], [1055, "      cfn_nag:\n"], [1056, "        rules_to_suppress:\n"], [1057, "        - id: W11\n"], [1058, "          reason: Cloudwatch does not support resource-level permissions\n"], [1059, "        - id: W89\n"], [1060, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1061, "            with AWS services via AWS APIs\n"], [1062, "        - id: W92\n"], [1063, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1064, "            to scale based on demand\n"], [1065, "    Properties:\n"], [1066, "      PermissionsBoundary:\n"], [1067, "        Fn::If:\n"], [1068, "        - HasPermissionsBoundary\n"], [1069, "        - Ref: PermissionsBoundaryArn\n"], [1070, "        - Ref: AWS::NoValue\n"], [1071, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/eba7338b4a8d975f9a54bcaa17d88cb9\n"], [1072, "      Handler: index.handler\n"], [1073, "      Runtime: python3.12\n"], [1074, "      Timeout: 900\n"], [1075, "      MemorySize: 4096\n"], [1076, "      Environment:\n"], [1077, "        Variables:\n"], [1078, "          METRIC_NAMESPACE:\n"], [1079, "            Ref: StackName\n"], [1080, "          MAX_WORKERS: 20\n"], [1081, "          TRACKING_TABLE:\n"], [1082, "            Ref: TrackingTable\n"], [1083, "          CONFIGURATION_BUCKET:\n"], [1084, "            Ref: ConfigurationBucket\n"], [1085, "          CONFIGURATION_TABLE_NAME:\n"], [1086, "            Ref: ConfigurationTable\n"], [1087, "          LOG_LEVEL:\n"], [1088, "            Ref: LogLevel\n"], [1089, "          APPSYNC_API_URL:\n"], [1090, "            Ref: AppSyncApiUrl\n"], [1091, "          WORKING_BUCKET:\n"], [1092, "            Ref: WorkingBucket\n"], [1093, "      LoggingConfig:\n"], [1094, "        LogGroup:\n"], [1095, "          Ref: ClassificationFunctionLogGroup\n"], [1096, "      Policies:\n"], [1097, "      - AWSLambdaBasicExecutionRole\n"], [1098, "      - S3CrudPolicy:\n"], [1099, "          BucketName:\n"], [1100, "            Ref: OutputBucket\n"], [1101, "      - S3CrudPolicy:\n"], [1102, "          BucketName:\n"], [1103, "            Ref: WorkingBucket\n"], [1104, "      - S3ReadPolicy:\n"], [1105, "          BucketName:\n"], [1106, "            Ref: InputBucket\n"], [1107, "      - DynamoDBCrudPolicy:\n"], [1108, "          TableName:\n"], [1109, "            Ref: TrackingTable\n"], [1110, "      - S3ReadPolicy:\n"], [1111, "          BucketName:\n"], [1112, "            Ref: ConfigurationBucket\n"], [1113, "      - DynamoDBCrudPolicy:\n"], [1114, "          TableName:\n"], [1115, "            Ref: ConfigurationTable\n"], [1116, "      - Statement:\n"], [1117, "        - Effect: Allow\n"], [1118, "          Action: cloudwatch:PutMetricData\n"], [1119, "          Resource: '*'\n"], [1120, "        - Effect: Allow\n"], [1121, "          Action:\n"], [1122, "          - kms:Encrypt\n"], [1123, "          - kms:Decrypt\n"], [1124, "          - kms:ReEncrypt*\n"], [1125, "          - kms:GenerateDataKey*\n"], [1126, "          - kms:DescribeKey\n"], [1127, "          Resource:\n"], [1128, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1129, "        - Effect: Allow\n"], [1130, "          Action:\n"], [1131, "          - appsync:GraphQL\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1134, "        - Effect: Allow\n"], [1135, "          Action: bedrock:InvokeModel\n"], [1136, "          Resource:\n"], [1137, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1138, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1139, "          - Fn::If:\n"], [1140, "            - HasCustomClassificationModelARN\n"], [1141, "            - Ref: CustomClassificationModelARN\n"], [1142, "            - Ref: AWS::NoValue\n"], [1143, "        - Fn::If:\n"], [1144, "          - HasGuardrailConfig\n"], [1145, "          - Effect: Allow\n"], [1146, "            Action: bedrock:ApplyGuardrail\n"], [1147, "            Resource:\n"], [1148, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1149, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1051, 1149], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1051, "  ClassificationFunction:\n"], [1052, "    Type: AWS::Serverless::Function\n"], [1053, "    Metadata:\n"], [1054, "      SamResourceId: ClassificationFunction\n"], [1055, "      cfn_nag:\n"], [1056, "        rules_to_suppress:\n"], [1057, "        - id: W11\n"], [1058, "          reason: Cloudwatch does not support resource-level permissions\n"], [1059, "        - id: W89\n"], [1060, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1061, "            with AWS services via AWS APIs\n"], [1062, "        - id: W92\n"], [1063, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1064, "            to scale based on demand\n"], [1065, "    Properties:\n"], [1066, "      PermissionsBoundary:\n"], [1067, "        Fn::If:\n"], [1068, "        - HasPermissionsBoundary\n"], [1069, "        - Ref: PermissionsBoundaryArn\n"], [1070, "        - Ref: AWS::NoValue\n"], [1071, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/eba7338b4a8d975f9a54bcaa17d88cb9\n"], [1072, "      Handler: index.handler\n"], [1073, "      Runtime: python3.12\n"], [1074, "      Timeout: 900\n"], [1075, "      MemorySize: 4096\n"], [1076, "      Environment:\n"], [1077, "        Variables:\n"], [1078, "          METRIC_NAMESPACE:\n"], [1079, "            Ref: StackName\n"], [1080, "          MAX_WORKERS: 20\n"], [1081, "          TRACKING_TABLE:\n"], [1082, "            Ref: TrackingTable\n"], [1083, "          CONFIGURATION_BUCKET:\n"], [1084, "            Ref: ConfigurationBucket\n"], [1085, "          CONFIGURATION_TABLE_NAME:\n"], [1086, "            Ref: ConfigurationTable\n"], [1087, "          LOG_LEVEL:\n"], [1088, "            Ref: LogLevel\n"], [1089, "          APPSYNC_API_URL:\n"], [1090, "            Ref: AppSyncApiUrl\n"], [1091, "          WORKING_BUCKET:\n"], [1092, "            Ref: WorkingBucket\n"], [1093, "      LoggingConfig:\n"], [1094, "        LogGroup:\n"], [1095, "          Ref: ClassificationFunctionLogGroup\n"], [1096, "      Policies:\n"], [1097, "      - AWSLambdaBasicExecutionRole\n"], [1098, "      - S3CrudPolicy:\n"], [1099, "          BucketName:\n"], [1100, "            Ref: OutputBucket\n"], [1101, "      - S3CrudPolicy:\n"], [1102, "          BucketName:\n"], [1103, "            Ref: WorkingBucket\n"], [1104, "      - S3ReadPolicy:\n"], [1105, "          BucketName:\n"], [1106, "            Ref: InputBucket\n"], [1107, "      - DynamoDBCrudPolicy:\n"], [1108, "          TableName:\n"], [1109, "            Ref: TrackingTable\n"], [1110, "      - S3ReadPolicy:\n"], [1111, "          BucketName:\n"], [1112, "            Ref: ConfigurationBucket\n"], [1113, "      - DynamoDBCrudPolicy:\n"], [1114, "          TableName:\n"], [1115, "            Ref: ConfigurationTable\n"], [1116, "      - Statement:\n"], [1117, "        - Effect: Allow\n"], [1118, "          Action: cloudwatch:PutMetricData\n"], [1119, "          Resource: '*'\n"], [1120, "        - Effect: Allow\n"], [1121, "          Action:\n"], [1122, "          - kms:Encrypt\n"], [1123, "          - kms:Decrypt\n"], [1124, "          - kms:ReEncrypt*\n"], [1125, "          - kms:GenerateDataKey*\n"], [1126, "          - kms:DescribeKey\n"], [1127, "          Resource:\n"], [1128, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1129, "        - Effect: Allow\n"], [1130, "          Action:\n"], [1131, "          - appsync:GraphQL\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1134, "        - Effect: Allow\n"], [1135, "          Action: bedrock:InvokeModel\n"], [1136, "          Resource:\n"], [1137, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1138, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1139, "          - Fn::If:\n"], [1140, "            - HasCustomClassificationModelARN\n"], [1141, "            - Ref: CustomClassificationModelARN\n"], [1142, "            - Ref: AWS::NoValue\n"], [1143, "        - Fn::If:\n"], [1144, "          - HasGuardrailConfig\n"], [1145, "          - Effect: Allow\n"], [1146, "            Action: bedrock:ApplyGuardrail\n"], [1147, "            Resource:\n"], [1148, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1149, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1051, 1149], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1051, "  ClassificationFunction:\n"], [1052, "    Type: AWS::Serverless::Function\n"], [1053, "    Metadata:\n"], [1054, "      SamResourceId: ClassificationFunction\n"], [1055, "      cfn_nag:\n"], [1056, "        rules_to_suppress:\n"], [1057, "        - id: W11\n"], [1058, "          reason: Cloudwatch does not support resource-level permissions\n"], [1059, "        - id: W89\n"], [1060, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1061, "            with AWS services via AWS APIs\n"], [1062, "        - id: W92\n"], [1063, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1064, "            to scale based on demand\n"], [1065, "    Properties:\n"], [1066, "      PermissionsBoundary:\n"], [1067, "        Fn::If:\n"], [1068, "        - HasPermissionsBoundary\n"], [1069, "        - Ref: PermissionsBoundaryArn\n"], [1070, "        - Ref: AWS::NoValue\n"], [1071, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/eba7338b4a8d975f9a54bcaa17d88cb9\n"], [1072, "      Handler: index.handler\n"], [1073, "      Runtime: python3.12\n"], [1074, "      Timeout: 900\n"], [1075, "      MemorySize: 4096\n"], [1076, "      Environment:\n"], [1077, "        Variables:\n"], [1078, "          METRIC_NAMESPACE:\n"], [1079, "            Ref: StackName\n"], [1080, "          MAX_WORKERS: 20\n"], [1081, "          TRACKING_TABLE:\n"], [1082, "            Ref: TrackingTable\n"], [1083, "          CONFIGURATION_BUCKET:\n"], [1084, "            Ref: ConfigurationBucket\n"], [1085, "          CONFIGURATION_TABLE_NAME:\n"], [1086, "            Ref: ConfigurationTable\n"], [1087, "          LOG_LEVEL:\n"], [1088, "            Ref: LogLevel\n"], [1089, "          APPSYNC_API_URL:\n"], [1090, "            Ref: AppSyncApiUrl\n"], [1091, "          WORKING_BUCKET:\n"], [1092, "            Ref: WorkingBucket\n"], [1093, "      LoggingConfig:\n"], [1094, "        LogGroup:\n"], [1095, "          Ref: ClassificationFunctionLogGroup\n"], [1096, "      Policies:\n"], [1097, "      - AWSLambdaBasicExecutionRole\n"], [1098, "      - S3CrudPolicy:\n"], [1099, "          BucketName:\n"], [1100, "            Ref: OutputBucket\n"], [1101, "      - S3CrudPolicy:\n"], [1102, "          BucketName:\n"], [1103, "            Ref: WorkingBucket\n"], [1104, "      - S3ReadPolicy:\n"], [1105, "          BucketName:\n"], [1106, "            Ref: InputBucket\n"], [1107, "      - DynamoDBCrudPolicy:\n"], [1108, "          TableName:\n"], [1109, "            Ref: TrackingTable\n"], [1110, "      - S3ReadPolicy:\n"], [1111, "          BucketName:\n"], [1112, "            Ref: ConfigurationBucket\n"], [1113, "      - DynamoDBCrudPolicy:\n"], [1114, "          TableName:\n"], [1115, "            Ref: ConfigurationTable\n"], [1116, "      - Statement:\n"], [1117, "        - Effect: Allow\n"], [1118, "          Action: cloudwatch:PutMetricData\n"], [1119, "          Resource: '*'\n"], [1120, "        - Effect: Allow\n"], [1121, "          Action:\n"], [1122, "          - kms:Encrypt\n"], [1123, "          - kms:Decrypt\n"], [1124, "          - kms:ReEncrypt*\n"], [1125, "          - kms:GenerateDataKey*\n"], [1126, "          - kms:DescribeKey\n"], [1127, "          Resource:\n"], [1128, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1129, "        - Effect: Allow\n"], [1130, "          Action:\n"], [1131, "          - appsync:GraphQL\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1134, "        - Effect: Allow\n"], [1135, "          Action: bedrock:InvokeModel\n"], [1136, "          Resource:\n"], [1137, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1138, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1139, "          - Fn::If:\n"], [1140, "            - HasCustomClassificationModelARN\n"], [1141, "            - Ref: CustomClassificationModelARN\n"], [1142, "            - Ref: AWS::NoValue\n"], [1143, "        - Fn::If:\n"], [1144, "          - HasGuardrailConfig\n"], [1145, "          - Effect: Allow\n"], [1146, "            Action: bedrock:ApplyGuardrail\n"], [1147, "            Resource:\n"], [1148, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1149, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1051, 1149], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1051, "  ClassificationFunction:\n"], [1052, "    Type: AWS::Serverless::Function\n"], [1053, "    Metadata:\n"], [1054, "      SamResourceId: ClassificationFunction\n"], [1055, "      cfn_nag:\n"], [1056, "        rules_to_suppress:\n"], [1057, "        - id: W11\n"], [1058, "          reason: Cloudwatch does not support resource-level permissions\n"], [1059, "        - id: W89\n"], [1060, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1061, "            with AWS services via AWS APIs\n"], [1062, "        - id: W92\n"], [1063, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1064, "            to scale based on demand\n"], [1065, "    Properties:\n"], [1066, "      PermissionsBoundary:\n"], [1067, "        Fn::If:\n"], [1068, "        - HasPermissionsBoundary\n"], [1069, "        - Ref: PermissionsBoundaryArn\n"], [1070, "        - Ref: AWS::NoValue\n"], [1071, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/eba7338b4a8d975f9a54bcaa17d88cb9\n"], [1072, "      Handler: index.handler\n"], [1073, "      Runtime: python3.12\n"], [1074, "      Timeout: 900\n"], [1075, "      MemorySize: 4096\n"], [1076, "      Environment:\n"], [1077, "        Variables:\n"], [1078, "          METRIC_NAMESPACE:\n"], [1079, "            Ref: StackName\n"], [1080, "          MAX_WORKERS: 20\n"], [1081, "          TRACKING_TABLE:\n"], [1082, "            Ref: TrackingTable\n"], [1083, "          CONFIGURATION_BUCKET:\n"], [1084, "            Ref: ConfigurationBucket\n"], [1085, "          CONFIGURATION_TABLE_NAME:\n"], [1086, "            Ref: ConfigurationTable\n"], [1087, "          LOG_LEVEL:\n"], [1088, "            Ref: LogLevel\n"], [1089, "          APPSYNC_API_URL:\n"], [1090, "            Ref: AppSyncApiUrl\n"], [1091, "          WORKING_BUCKET:\n"], [1092, "            Ref: WorkingBucket\n"], [1093, "      LoggingConfig:\n"], [1094, "        LogGroup:\n"], [1095, "          Ref: ClassificationFunctionLogGroup\n"], [1096, "      Policies:\n"], [1097, "      - AWSLambdaBasicExecutionRole\n"], [1098, "      - S3CrudPolicy:\n"], [1099, "          BucketName:\n"], [1100, "            Ref: OutputBucket\n"], [1101, "      - S3CrudPolicy:\n"], [1102, "          BucketName:\n"], [1103, "            Ref: WorkingBucket\n"], [1104, "      - S3ReadPolicy:\n"], [1105, "          BucketName:\n"], [1106, "            Ref: InputBucket\n"], [1107, "      - DynamoDBCrudPolicy:\n"], [1108, "          TableName:\n"], [1109, "            Ref: TrackingTable\n"], [1110, "      - S3ReadPolicy:\n"], [1111, "          BucketName:\n"], [1112, "            Ref: ConfigurationBucket\n"], [1113, "      - DynamoDBCrudPolicy:\n"], [1114, "          TableName:\n"], [1115, "            Ref: ConfigurationTable\n"], [1116, "      - Statement:\n"], [1117, "        - Effect: Allow\n"], [1118, "          Action: cloudwatch:PutMetricData\n"], [1119, "          Resource: '*'\n"], [1120, "        - Effect: Allow\n"], [1121, "          Action:\n"], [1122, "          - kms:Encrypt\n"], [1123, "          - kms:Decrypt\n"], [1124, "          - kms:ReEncrypt*\n"], [1125, "          - kms:GenerateDataKey*\n"], [1126, "          - kms:DescribeKey\n"], [1127, "          Resource:\n"], [1128, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1129, "        - Effect: Allow\n"], [1130, "          Action:\n"], [1131, "          - appsync:GraphQL\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1134, "        - Effect: Allow\n"], [1135, "          Action: bedrock:InvokeModel\n"], [1136, "          Resource:\n"], [1137, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1138, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1139, "          - Fn::If:\n"], [1140, "            - HasCustomClassificationModelARN\n"], [1141, "            - Ref: CustomClassificationModelARN\n"], [1142, "            - Ref: AWS::NoValue\n"], [1143, "        - Fn::If:\n"], [1144, "          - HasGuardrailConfig\n"], [1145, "          - Effect: Allow\n"], [1146, "            Action: bedrock:ApplyGuardrail\n"], [1147, "            Resource:\n"], [1148, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1149, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1051, 1149], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1161, "  ExtractionFunction:\n"], [1162, "    Type: AWS::Serverless::Function\n"], [1163, "    Metadata:\n"], [1164, "      SamResourceId: ExtractionFunction\n"], [1165, "      cfn_nag:\n"], [1166, "        rules_to_suppress:\n"], [1167, "        - id: W89\n"], [1168, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1169, "            with AWS services via AWS APIs\n"], [1170, "        - id: W92\n"], [1171, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1172, "            to scale based on demand\n"], [1173, "        - id: W11\n"], [1174, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1175, "            should support any enabled Bedrock model_id or inference profile\n"], [1176, "    Properties:\n"], [1177, "      PermissionsBoundary:\n"], [1178, "        Fn::If:\n"], [1179, "        - HasPermissionsBoundary\n"], [1180, "        - Ref: PermissionsBoundaryArn\n"], [1181, "        - Ref: AWS::NoValue\n"], [1182, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/c4d828e2eaa186015189bb0f0a7b6bc7\n"], [1183, "      Handler: index.handler\n"], [1184, "      Runtime: python3.12\n"], [1185, "      Timeout: 900\n"], [1186, "      MemorySize: 512\n"], [1187, "      Environment:\n"], [1188, "        Variables:\n"], [1189, "          METRIC_NAMESPACE:\n"], [1190, "            Ref: StackName\n"], [1191, "          CONFIGURATION_BUCKET:\n"], [1192, "            Ref: ConfigurationBucket\n"], [1193, "          CONFIGURATION_TABLE_NAME:\n"], [1194, "            Ref: ConfigurationTable\n"], [1195, "          GUARDRAIL_ID_AND_VERSION:\n"], [1196, "            Fn::If:\n"], [1197, "            - HasGuardrailConfig\n"], [1198, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1199, "            - ''\n"], [1200, "          LOG_LEVEL:\n"], [1201, "            Ref: LogLevel\n"], [1202, "          APPSYNC_API_URL:\n"], [1203, "            Ref: AppSyncApiUrl\n"], [1204, "          WORKING_BUCKET:\n"], [1205, "            Ref: WorkingBucket\n"], [1206, "      LoggingConfig:\n"], [1207, "        LogGroup:\n"], [1208, "          Ref: ExtractionFunctionLogGroup\n"], [1209, "      Policies:\n"], [1210, "      - AWSLambdaBasicExecutionRole\n"], [1211, "      - S3CrudPolicy:\n"], [1212, "          BucketName:\n"], [1213, "            Ref: OutputBucket\n"], [1214, "      - S3CrudPolicy:\n"], [1215, "          BucketName:\n"], [1216, "            Ref: WorkingBucket\n"], [1217, "      - S3ReadPolicy:\n"], [1218, "          BucketName:\n"], [1219, "            Ref: InputBucket\n"], [1220, "      - S3ReadPolicy:\n"], [1221, "          BucketName:\n"], [1222, "            Ref: ConfigurationBucket\n"], [1223, "      - DynamoDBCrudPolicy:\n"], [1224, "          TableName:\n"], [1225, "            Ref: ConfigurationTable\n"], [1226, "      - Statement:\n"], [1227, "        - Effect: Allow\n"], [1228, "          Action: cloudwatch:PutMetricData\n"], [1229, "          Resource: '*'\n"], [1230, "        - Effect: Allow\n"], [1231, "          Action:\n"], [1232, "          - kms:Encrypt\n"], [1233, "          - kms:Decrypt\n"], [1234, "          - kms:ReEncrypt*\n"], [1235, "          - kms:GenerateDataKey*\n"], [1236, "          - kms:DescribeKey\n"], [1237, "          Resource:\n"], [1238, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1239, "        - Effect: Allow\n"], [1240, "          Action:\n"], [1241, "          - appsync:GraphQL\n"], [1242, "          Resource:\n"], [1243, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1244, "        - Effect: Allow\n"], [1245, "          Action: bedrock:InvokeModel\n"], [1246, "          Resource:\n"], [1247, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1248, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1249, "          - Fn::If:\n"], [1250, "            - HasCustomExtractionModelARN\n"], [1251, "            - Ref: CustomExtractionModelARN\n"], [1252, "            - Ref: AWS::NoValue\n"], [1253, "        - Fn::If:\n"], [1254, "          - HasGuardrailConfig\n"], [1255, "          - Effect: Allow\n"], [1256, "            Action: bedrock:ApplyGuardrail\n"], [1257, "            Resource:\n"], [1258, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1259, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1161, 1259], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1161, "  ExtractionFunction:\n"], [1162, "    Type: AWS::Serverless::Function\n"], [1163, "    Metadata:\n"], [1164, "      SamResourceId: ExtractionFunction\n"], [1165, "      cfn_nag:\n"], [1166, "        rules_to_suppress:\n"], [1167, "        - id: W89\n"], [1168, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1169, "            with AWS services via AWS APIs\n"], [1170, "        - id: W92\n"], [1171, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1172, "            to scale based on demand\n"], [1173, "        - id: W11\n"], [1174, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1175, "            should support any enabled Bedrock model_id or inference profile\n"], [1176, "    Properties:\n"], [1177, "      PermissionsBoundary:\n"], [1178, "        Fn::If:\n"], [1179, "        - HasPermissionsBoundary\n"], [1180, "        - Ref: PermissionsBoundaryArn\n"], [1181, "        - Ref: AWS::NoValue\n"], [1182, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/c4d828e2eaa186015189bb0f0a7b6bc7\n"], [1183, "      Handler: index.handler\n"], [1184, "      Runtime: python3.12\n"], [1185, "      Timeout: 900\n"], [1186, "      MemorySize: 512\n"], [1187, "      Environment:\n"], [1188, "        Variables:\n"], [1189, "          METRIC_NAMESPACE:\n"], [1190, "            Ref: StackName\n"], [1191, "          CONFIGURATION_BUCKET:\n"], [1192, "            Ref: ConfigurationBucket\n"], [1193, "          CONFIGURATION_TABLE_NAME:\n"], [1194, "            Ref: ConfigurationTable\n"], [1195, "          GUARDRAIL_ID_AND_VERSION:\n"], [1196, "            Fn::If:\n"], [1197, "            - HasGuardrailConfig\n"], [1198, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1199, "            - ''\n"], [1200, "          LOG_LEVEL:\n"], [1201, "            Ref: LogLevel\n"], [1202, "          APPSYNC_API_URL:\n"], [1203, "            Ref: AppSyncApiUrl\n"], [1204, "          WORKING_BUCKET:\n"], [1205, "            Ref: WorkingBucket\n"], [1206, "      LoggingConfig:\n"], [1207, "        LogGroup:\n"], [1208, "          Ref: ExtractionFunctionLogGroup\n"], [1209, "      Policies:\n"], [1210, "      - AWSLambdaBasicExecutionRole\n"], [1211, "      - S3CrudPolicy:\n"], [1212, "          BucketName:\n"], [1213, "            Ref: OutputBucket\n"], [1214, "      - S3CrudPolicy:\n"], [1215, "          BucketName:\n"], [1216, "            Ref: WorkingBucket\n"], [1217, "      - S3ReadPolicy:\n"], [1218, "          BucketName:\n"], [1219, "            Ref: InputBucket\n"], [1220, "      - S3ReadPolicy:\n"], [1221, "          BucketName:\n"], [1222, "            Ref: ConfigurationBucket\n"], [1223, "      - DynamoDBCrudPolicy:\n"], [1224, "          TableName:\n"], [1225, "            Ref: ConfigurationTable\n"], [1226, "      - Statement:\n"], [1227, "        - Effect: Allow\n"], [1228, "          Action: cloudwatch:PutMetricData\n"], [1229, "          Resource: '*'\n"], [1230, "        - Effect: Allow\n"], [1231, "          Action:\n"], [1232, "          - kms:Encrypt\n"], [1233, "          - kms:Decrypt\n"], [1234, "          - kms:ReEncrypt*\n"], [1235, "          - kms:GenerateDataKey*\n"], [1236, "          - kms:DescribeKey\n"], [1237, "          Resource:\n"], [1238, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1239, "        - Effect: Allow\n"], [1240, "          Action:\n"], [1241, "          - appsync:GraphQL\n"], [1242, "          Resource:\n"], [1243, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1244, "        - Effect: Allow\n"], [1245, "          Action: bedrock:InvokeModel\n"], [1246, "          Resource:\n"], [1247, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1248, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1249, "          - Fn::If:\n"], [1250, "            - HasCustomExtractionModelARN\n"], [1251, "            - Ref: CustomExtractionModelARN\n"], [1252, "            - Ref: AWS::NoValue\n"], [1253, "        - Fn::If:\n"], [1254, "          - HasGuardrailConfig\n"], [1255, "          - Effect: Allow\n"], [1256, "            Action: bedrock:ApplyGuardrail\n"], [1257, "            Resource:\n"], [1258, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1259, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1161, 1259], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1161, "  ExtractionFunction:\n"], [1162, "    Type: AWS::Serverless::Function\n"], [1163, "    Metadata:\n"], [1164, "      SamResourceId: ExtractionFunction\n"], [1165, "      cfn_nag:\n"], [1166, "        rules_to_suppress:\n"], [1167, "        - id: W89\n"], [1168, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1169, "            with AWS services via AWS APIs\n"], [1170, "        - id: W92\n"], [1171, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1172, "            to scale based on demand\n"], [1173, "        - id: W11\n"], [1174, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1175, "            should support any enabled Bedrock model_id or inference profile\n"], [1176, "    Properties:\n"], [1177, "      PermissionsBoundary:\n"], [1178, "        Fn::If:\n"], [1179, "        - HasPermissionsBoundary\n"], [1180, "        - Ref: PermissionsBoundaryArn\n"], [1181, "        - Ref: AWS::NoValue\n"], [1182, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/c4d828e2eaa186015189bb0f0a7b6bc7\n"], [1183, "      Handler: index.handler\n"], [1184, "      Runtime: python3.12\n"], [1185, "      Timeout: 900\n"], [1186, "      MemorySize: 512\n"], [1187, "      Environment:\n"], [1188, "        Variables:\n"], [1189, "          METRIC_NAMESPACE:\n"], [1190, "            Ref: StackName\n"], [1191, "          CONFIGURATION_BUCKET:\n"], [1192, "            Ref: ConfigurationBucket\n"], [1193, "          CONFIGURATION_TABLE_NAME:\n"], [1194, "            Ref: ConfigurationTable\n"], [1195, "          GUARDRAIL_ID_AND_VERSION:\n"], [1196, "            Fn::If:\n"], [1197, "            - HasGuardrailConfig\n"], [1198, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1199, "            - ''\n"], [1200, "          LOG_LEVEL:\n"], [1201, "            Ref: LogLevel\n"], [1202, "          APPSYNC_API_URL:\n"], [1203, "            Ref: AppSyncApiUrl\n"], [1204, "          WORKING_BUCKET:\n"], [1205, "            Ref: WorkingBucket\n"], [1206, "      LoggingConfig:\n"], [1207, "        LogGroup:\n"], [1208, "          Ref: ExtractionFunctionLogGroup\n"], [1209, "      Policies:\n"], [1210, "      - AWSLambdaBasicExecutionRole\n"], [1211, "      - S3CrudPolicy:\n"], [1212, "          BucketName:\n"], [1213, "            Ref: OutputBucket\n"], [1214, "      - S3CrudPolicy:\n"], [1215, "          BucketName:\n"], [1216, "            Ref: WorkingBucket\n"], [1217, "      - S3ReadPolicy:\n"], [1218, "          BucketName:\n"], [1219, "            Ref: InputBucket\n"], [1220, "      - S3ReadPolicy:\n"], [1221, "          BucketName:\n"], [1222, "            Ref: ConfigurationBucket\n"], [1223, "      - DynamoDBCrudPolicy:\n"], [1224, "          TableName:\n"], [1225, "            Ref: ConfigurationTable\n"], [1226, "      - Statement:\n"], [1227, "        - Effect: Allow\n"], [1228, "          Action: cloudwatch:PutMetricData\n"], [1229, "          Resource: '*'\n"], [1230, "        - Effect: Allow\n"], [1231, "          Action:\n"], [1232, "          - kms:Encrypt\n"], [1233, "          - kms:Decrypt\n"], [1234, "          - kms:ReEncrypt*\n"], [1235, "          - kms:GenerateDataKey*\n"], [1236, "          - kms:DescribeKey\n"], [1237, "          Resource:\n"], [1238, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1239, "        - Effect: Allow\n"], [1240, "          Action:\n"], [1241, "          - appsync:GraphQL\n"], [1242, "          Resource:\n"], [1243, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1244, "        - Effect: Allow\n"], [1245, "          Action: bedrock:InvokeModel\n"], [1246, "          Resource:\n"], [1247, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1248, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1249, "          - Fn::If:\n"], [1250, "            - HasCustomExtractionModelARN\n"], [1251, "            - Ref: CustomExtractionModelARN\n"], [1252, "            - Ref: AWS::NoValue\n"], [1253, "        - Fn::If:\n"], [1254, "          - HasGuardrailConfig\n"], [1255, "          - Effect: Allow\n"], [1256, "            Action: bedrock:ApplyGuardrail\n"], [1257, "            Resource:\n"], [1258, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1259, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1161, 1259], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1161, "  ExtractionFunction:\n"], [1162, "    Type: AWS::Serverless::Function\n"], [1163, "    Metadata:\n"], [1164, "      SamResourceId: ExtractionFunction\n"], [1165, "      cfn_nag:\n"], [1166, "        rules_to_suppress:\n"], [1167, "        - id: W89\n"], [1168, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1169, "            with AWS services via AWS APIs\n"], [1170, "        - id: W92\n"], [1171, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1172, "            to scale based on demand\n"], [1173, "        - id: W11\n"], [1174, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1175, "            should support any enabled Bedrock model_id or inference profile\n"], [1176, "    Properties:\n"], [1177, "      PermissionsBoundary:\n"], [1178, "        Fn::If:\n"], [1179, "        - HasPermissionsBoundary\n"], [1180, "        - Ref: PermissionsBoundaryArn\n"], [1181, "        - Ref: AWS::NoValue\n"], [1182, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/c4d828e2eaa186015189bb0f0a7b6bc7\n"], [1183, "      Handler: index.handler\n"], [1184, "      Runtime: python3.12\n"], [1185, "      Timeout: 900\n"], [1186, "      MemorySize: 512\n"], [1187, "      Environment:\n"], [1188, "        Variables:\n"], [1189, "          METRIC_NAMESPACE:\n"], [1190, "            Ref: StackName\n"], [1191, "          CONFIGURATION_BUCKET:\n"], [1192, "            Ref: ConfigurationBucket\n"], [1193, "          CONFIGURATION_TABLE_NAME:\n"], [1194, "            Ref: ConfigurationTable\n"], [1195, "          GUARDRAIL_ID_AND_VERSION:\n"], [1196, "            Fn::If:\n"], [1197, "            - HasGuardrailConfig\n"], [1198, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1199, "            - ''\n"], [1200, "          LOG_LEVEL:\n"], [1201, "            Ref: LogLevel\n"], [1202, "          APPSYNC_API_URL:\n"], [1203, "            Ref: AppSyncApiUrl\n"], [1204, "          WORKING_BUCKET:\n"], [1205, "            Ref: WorkingBucket\n"], [1206, "      LoggingConfig:\n"], [1207, "        LogGroup:\n"], [1208, "          Ref: ExtractionFunctionLogGroup\n"], [1209, "      Policies:\n"], [1210, "      - AWSLambdaBasicExecutionRole\n"], [1211, "      - S3CrudPolicy:\n"], [1212, "          BucketName:\n"], [1213, "            Ref: OutputBucket\n"], [1214, "      - S3CrudPolicy:\n"], [1215, "          BucketName:\n"], [1216, "            Ref: WorkingBucket\n"], [1217, "      - S3ReadPolicy:\n"], [1218, "          BucketName:\n"], [1219, "            Ref: InputBucket\n"], [1220, "      - S3ReadPolicy:\n"], [1221, "          BucketName:\n"], [1222, "            Ref: ConfigurationBucket\n"], [1223, "      - DynamoDBCrudPolicy:\n"], [1224, "          TableName:\n"], [1225, "            Ref: ConfigurationTable\n"], [1226, "      - Statement:\n"], [1227, "        - Effect: Allow\n"], [1228, "          Action: cloudwatch:PutMetricData\n"], [1229, "          Resource: '*'\n"], [1230, "        - Effect: Allow\n"], [1231, "          Action:\n"], [1232, "          - kms:Encrypt\n"], [1233, "          - kms:Decrypt\n"], [1234, "          - kms:ReEncrypt*\n"], [1235, "          - kms:GenerateDataKey*\n"], [1236, "          - kms:DescribeKey\n"], [1237, "          Resource:\n"], [1238, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1239, "        - Effect: Allow\n"], [1240, "          Action:\n"], [1241, "          - appsync:GraphQL\n"], [1242, "          Resource:\n"], [1243, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1244, "        - Effect: Allow\n"], [1245, "          Action: bedrock:InvokeModel\n"], [1246, "          Resource:\n"], [1247, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1248, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1249, "          - Fn::If:\n"], [1250, "            - HasCustomExtractionModelARN\n"], [1251, "            - Ref: CustomExtractionModelARN\n"], [1252, "            - Ref: AWS::NoValue\n"], [1253, "        - Fn::If:\n"], [1254, "          - HasGuardrailConfig\n"], [1255, "          - Effect: Allow\n"], [1256, "            Action: bedrock:ApplyGuardrail\n"], [1257, "            Resource:\n"], [1258, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1259, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1161, 1259], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1271, "  AssessmentFunction:\n"], [1272, "    Type: AWS::Serverless::Function\n"], [1273, "    Metadata:\n"], [1274, "      SamResourceId: AssessmentFunction\n"], [1275, "      cfn_nag:\n"], [1276, "        rules_to_suppress:\n"], [1277, "        - id: W89\n"], [1278, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1279, "            with AWS services via AWS APIs\n"], [1280, "        - id: W92\n"], [1281, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1282, "            to scale based on demand\n"], [1283, "        - id: W11\n"], [1284, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1285, "            should support any enabled Bedrock model_id or inference profile\n"], [1286, "    Properties:\n"], [1287, "      PermissionsBoundary:\n"], [1288, "        Fn::If:\n"], [1289, "        - HasPermissionsBoundary\n"], [1290, "        - Ref: PermissionsBoundaryArn\n"], [1291, "        - Ref: AWS::NoValue\n"], [1292, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/6457e9aea45759c5ae43f2063496e957\n"], [1293, "      Handler: index.handler\n"], [1294, "      Runtime: python3.12\n"], [1295, "      Timeout: 900\n"], [1296, "      MemorySize: 512\n"], [1297, "      Environment:\n"], [1298, "        Variables:\n"], [1299, "          METRIC_NAMESPACE:\n"], [1300, "            Ref: StackName\n"], [1301, "          CONFIGURATION_BUCKET:\n"], [1302, "            Ref: ConfigurationBucket\n"], [1303, "          CONFIGURATION_TABLE_NAME:\n"], [1304, "            Ref: ConfigurationTable\n"], [1305, "          LOG_LEVEL:\n"], [1306, "            Ref: LogLevel\n"], [1307, "          APPSYNC_API_URL:\n"], [1308, "            Ref: AppSyncApiUrl\n"], [1309, "          WORKING_BUCKET:\n"], [1310, "            Ref: WorkingBucket\n"], [1311, "      LoggingConfig:\n"], [1312, "        LogGroup:\n"], [1313, "          Ref: AssessmentFunctionLogGroup\n"], [1314, "      Policies:\n"], [1315, "      - AWSLambdaBasicExecutionRole\n"], [1316, "      - S3CrudPolicy:\n"], [1317, "          BucketName:\n"], [1318, "            Ref: OutputBucket\n"], [1319, "      - S3CrudPolicy:\n"], [1320, "          BucketName:\n"], [1321, "            Ref: WorkingBucket\n"], [1322, "      - S3ReadPolicy:\n"], [1323, "          BucketName:\n"], [1324, "            Ref: InputBucket\n"], [1325, "      - S3ReadPolicy:\n"], [1326, "          BucketName:\n"], [1327, "            Ref: ConfigurationBucket\n"], [1328, "      - DynamoDBCrudPolicy:\n"], [1329, "          TableName:\n"], [1330, "            Ref: ConfigurationTable\n"], [1331, "      - Statement:\n"], [1332, "        - Effect: Allow\n"], [1333, "          Action: cloudwatch:PutMetricData\n"], [1334, "          Resource: '*'\n"], [1335, "        - Effect: Allow\n"], [1336, "          Action:\n"], [1337, "          - kms:Encrypt\n"], [1338, "          - kms:Decrypt\n"], [1339, "          - kms:ReEncrypt*\n"], [1340, "          - kms:GenerateDataKey*\n"], [1341, "          - kms:DescribeKey\n"], [1342, "          Resource:\n"], [1343, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1344, "        - Effect: Allow\n"], [1345, "          Action:\n"], [1346, "          - appsync:GraphQL\n"], [1347, "          Resource:\n"], [1348, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1349, "        - Effect: Allow\n"], [1350, "          Action: bedrock:InvokeModel\n"], [1351, "          Resource:\n"], [1352, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1353, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1354, "        - Fn::If:\n"], [1355, "          - HasGuardrailConfig\n"], [1356, "          - Effect: Allow\n"], [1357, "            Action: bedrock:ApplyGuardrail\n"], [1358, "            Resource:\n"], [1359, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1360, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1271, 1360], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1271, "  AssessmentFunction:\n"], [1272, "    Type: AWS::Serverless::Function\n"], [1273, "    Metadata:\n"], [1274, "      SamResourceId: AssessmentFunction\n"], [1275, "      cfn_nag:\n"], [1276, "        rules_to_suppress:\n"], [1277, "        - id: W89\n"], [1278, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1279, "            with AWS services via AWS APIs\n"], [1280, "        - id: W92\n"], [1281, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1282, "            to scale based on demand\n"], [1283, "        - id: W11\n"], [1284, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1285, "            should support any enabled Bedrock model_id or inference profile\n"], [1286, "    Properties:\n"], [1287, "      PermissionsBoundary:\n"], [1288, "        Fn::If:\n"], [1289, "        - HasPermissionsBoundary\n"], [1290, "        - Ref: PermissionsBoundaryArn\n"], [1291, "        - Ref: AWS::NoValue\n"], [1292, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/6457e9aea45759c5ae43f2063496e957\n"], [1293, "      Handler: index.handler\n"], [1294, "      Runtime: python3.12\n"], [1295, "      Timeout: 900\n"], [1296, "      MemorySize: 512\n"], [1297, "      Environment:\n"], [1298, "        Variables:\n"], [1299, "          METRIC_NAMESPACE:\n"], [1300, "            Ref: StackName\n"], [1301, "          CONFIGURATION_BUCKET:\n"], [1302, "            Ref: ConfigurationBucket\n"], [1303, "          CONFIGURATION_TABLE_NAME:\n"], [1304, "            Ref: ConfigurationTable\n"], [1305, "          LOG_LEVEL:\n"], [1306, "            Ref: LogLevel\n"], [1307, "          APPSYNC_API_URL:\n"], [1308, "            Ref: AppSyncApiUrl\n"], [1309, "          WORKING_BUCKET:\n"], [1310, "            Ref: WorkingBucket\n"], [1311, "      LoggingConfig:\n"], [1312, "        LogGroup:\n"], [1313, "          Ref: AssessmentFunctionLogGroup\n"], [1314, "      Policies:\n"], [1315, "      - AWSLambdaBasicExecutionRole\n"], [1316, "      - S3CrudPolicy:\n"], [1317, "          BucketName:\n"], [1318, "            Ref: OutputBucket\n"], [1319, "      - S3CrudPolicy:\n"], [1320, "          BucketName:\n"], [1321, "            Ref: WorkingBucket\n"], [1322, "      - S3ReadPolicy:\n"], [1323, "          BucketName:\n"], [1324, "            Ref: InputBucket\n"], [1325, "      - S3ReadPolicy:\n"], [1326, "          BucketName:\n"], [1327, "            Ref: ConfigurationBucket\n"], [1328, "      - DynamoDBCrudPolicy:\n"], [1329, "          TableName:\n"], [1330, "            Ref: ConfigurationTable\n"], [1331, "      - Statement:\n"], [1332, "        - Effect: Allow\n"], [1333, "          Action: cloudwatch:PutMetricData\n"], [1334, "          Resource: '*'\n"], [1335, "        - Effect: Allow\n"], [1336, "          Action:\n"], [1337, "          - kms:Encrypt\n"], [1338, "          - kms:Decrypt\n"], [1339, "          - kms:ReEncrypt*\n"], [1340, "          - kms:GenerateDataKey*\n"], [1341, "          - kms:DescribeKey\n"], [1342, "          Resource:\n"], [1343, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1344, "        - Effect: Allow\n"], [1345, "          Action:\n"], [1346, "          - appsync:GraphQL\n"], [1347, "          Resource:\n"], [1348, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1349, "        - Effect: Allow\n"], [1350, "          Action: bedrock:InvokeModel\n"], [1351, "          Resource:\n"], [1352, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1353, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1354, "        - Fn::If:\n"], [1355, "          - HasGuardrailConfig\n"], [1356, "          - Effect: Allow\n"], [1357, "            Action: bedrock:ApplyGuardrail\n"], [1358, "            Resource:\n"], [1359, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1360, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1271, 1360], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1271, "  AssessmentFunction:\n"], [1272, "    Type: AWS::Serverless::Function\n"], [1273, "    Metadata:\n"], [1274, "      SamResourceId: AssessmentFunction\n"], [1275, "      cfn_nag:\n"], [1276, "        rules_to_suppress:\n"], [1277, "        - id: W89\n"], [1278, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1279, "            with AWS services via AWS APIs\n"], [1280, "        - id: W92\n"], [1281, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1282, "            to scale based on demand\n"], [1283, "        - id: W11\n"], [1284, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1285, "            should support any enabled Bedrock model_id or inference profile\n"], [1286, "    Properties:\n"], [1287, "      PermissionsBoundary:\n"], [1288, "        Fn::If:\n"], [1289, "        - HasPermissionsBoundary\n"], [1290, "        - Ref: PermissionsBoundaryArn\n"], [1291, "        - Ref: AWS::NoValue\n"], [1292, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/6457e9aea45759c5ae43f2063496e957\n"], [1293, "      Handler: index.handler\n"], [1294, "      Runtime: python3.12\n"], [1295, "      Timeout: 900\n"], [1296, "      MemorySize: 512\n"], [1297, "      Environment:\n"], [1298, "        Variables:\n"], [1299, "          METRIC_NAMESPACE:\n"], [1300, "            Ref: StackName\n"], [1301, "          CONFIGURATION_BUCKET:\n"], [1302, "            Ref: ConfigurationBucket\n"], [1303, "          CONFIGURATION_TABLE_NAME:\n"], [1304, "            Ref: ConfigurationTable\n"], [1305, "          LOG_LEVEL:\n"], [1306, "            Ref: LogLevel\n"], [1307, "          APPSYNC_API_URL:\n"], [1308, "            Ref: AppSyncApiUrl\n"], [1309, "          WORKING_BUCKET:\n"], [1310, "            Ref: WorkingBucket\n"], [1311, "      LoggingConfig:\n"], [1312, "        LogGroup:\n"], [1313, "          Ref: AssessmentFunctionLogGroup\n"], [1314, "      Policies:\n"], [1315, "      - AWSLambdaBasicExecutionRole\n"], [1316, "      - S3CrudPolicy:\n"], [1317, "          BucketName:\n"], [1318, "            Ref: OutputBucket\n"], [1319, "      - S3CrudPolicy:\n"], [1320, "          BucketName:\n"], [1321, "            Ref: WorkingBucket\n"], [1322, "      - S3ReadPolicy:\n"], [1323, "          BucketName:\n"], [1324, "            Ref: InputBucket\n"], [1325, "      - S3ReadPolicy:\n"], [1326, "          BucketName:\n"], [1327, "            Ref: ConfigurationBucket\n"], [1328, "      - DynamoDBCrudPolicy:\n"], [1329, "          TableName:\n"], [1330, "            Ref: ConfigurationTable\n"], [1331, "      - Statement:\n"], [1332, "        - Effect: Allow\n"], [1333, "          Action: cloudwatch:PutMetricData\n"], [1334, "          Resource: '*'\n"], [1335, "        - Effect: Allow\n"], [1336, "          Action:\n"], [1337, "          - kms:Encrypt\n"], [1338, "          - kms:Decrypt\n"], [1339, "          - kms:ReEncrypt*\n"], [1340, "          - kms:GenerateDataKey*\n"], [1341, "          - kms:DescribeKey\n"], [1342, "          Resource:\n"], [1343, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1344, "        - Effect: Allow\n"], [1345, "          Action:\n"], [1346, "          - appsync:GraphQL\n"], [1347, "          Resource:\n"], [1348, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1349, "        - Effect: Allow\n"], [1350, "          Action: bedrock:InvokeModel\n"], [1351, "          Resource:\n"], [1352, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1353, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1354, "        - Fn::If:\n"], [1355, "          - HasGuardrailConfig\n"], [1356, "          - Effect: Allow\n"], [1357, "            Action: bedrock:ApplyGuardrail\n"], [1358, "            Resource:\n"], [1359, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1360, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1271, 1360], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1271, "  AssessmentFunction:\n"], [1272, "    Type: AWS::Serverless::Function\n"], [1273, "    Metadata:\n"], [1274, "      SamResourceId: AssessmentFunction\n"], [1275, "      cfn_nag:\n"], [1276, "        rules_to_suppress:\n"], [1277, "        - id: W89\n"], [1278, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1279, "            with AWS services via AWS APIs\n"], [1280, "        - id: W92\n"], [1281, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1282, "            to scale based on demand\n"], [1283, "        - id: W11\n"], [1284, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1285, "            should support any enabled Bedrock model_id or inference profile\n"], [1286, "    Properties:\n"], [1287, "      PermissionsBoundary:\n"], [1288, "        Fn::If:\n"], [1289, "        - HasPermissionsBoundary\n"], [1290, "        - Ref: PermissionsBoundaryArn\n"], [1291, "        - Ref: AWS::NoValue\n"], [1292, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/6457e9aea45759c5ae43f2063496e957\n"], [1293, "      Handler: index.handler\n"], [1294, "      Runtime: python3.12\n"], [1295, "      Timeout: 900\n"], [1296, "      MemorySize: 512\n"], [1297, "      Environment:\n"], [1298, "        Variables:\n"], [1299, "          METRIC_NAMESPACE:\n"], [1300, "            Ref: StackName\n"], [1301, "          CONFIGURATION_BUCKET:\n"], [1302, "            Ref: ConfigurationBucket\n"], [1303, "          CONFIGURATION_TABLE_NAME:\n"], [1304, "            Ref: ConfigurationTable\n"], [1305, "          LOG_LEVEL:\n"], [1306, "            Ref: LogLevel\n"], [1307, "          APPSYNC_API_URL:\n"], [1308, "            Ref: AppSyncApiUrl\n"], [1309, "          WORKING_BUCKET:\n"], [1310, "            Ref: WorkingBucket\n"], [1311, "      LoggingConfig:\n"], [1312, "        LogGroup:\n"], [1313, "          Ref: AssessmentFunctionLogGroup\n"], [1314, "      Policies:\n"], [1315, "      - AWSLambdaBasicExecutionRole\n"], [1316, "      - S3CrudPolicy:\n"], [1317, "          BucketName:\n"], [1318, "            Ref: OutputBucket\n"], [1319, "      - S3CrudPolicy:\n"], [1320, "          BucketName:\n"], [1321, "            Ref: WorkingBucket\n"], [1322, "      - S3ReadPolicy:\n"], [1323, "          BucketName:\n"], [1324, "            Ref: InputBucket\n"], [1325, "      - S3ReadPolicy:\n"], [1326, "          BucketName:\n"], [1327, "            Ref: ConfigurationBucket\n"], [1328, "      - DynamoDBCrudPolicy:\n"], [1329, "          TableName:\n"], [1330, "            Ref: ConfigurationTable\n"], [1331, "      - Statement:\n"], [1332, "        - Effect: Allow\n"], [1333, "          Action: cloudwatch:PutMetricData\n"], [1334, "          Resource: '*'\n"], [1335, "        - Effect: Allow\n"], [1336, "          Action:\n"], [1337, "          - kms:Encrypt\n"], [1338, "          - kms:Decrypt\n"], [1339, "          - kms:ReEncrypt*\n"], [1340, "          - kms:GenerateDataKey*\n"], [1341, "          - kms:DescribeKey\n"], [1342, "          Resource:\n"], [1343, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1344, "        - Effect: Allow\n"], [1345, "          Action:\n"], [1346, "          - appsync:GraphQL\n"], [1347, "          Resource:\n"], [1348, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1349, "        - Effect: Allow\n"], [1350, "          Action: bedrock:InvokeModel\n"], [1351, "          Resource:\n"], [1352, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1353, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1354, "        - Fn::If:\n"], [1355, "          - HasGuardrailConfig\n"], [1356, "          - Effect: Allow\n"], [1357, "            Action: bedrock:ApplyGuardrail\n"], [1358, "            Resource:\n"], [1359, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1360, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1271, 1360], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1372, "  ProcessResultsFunction:\n"], [1373, "    Type: AWS::Serverless::Function\n"], [1374, "    Metadata:\n"], [1375, "      SamResourceId: ProcessResultsFunction\n"], [1376, "      cfn_nag:\n"], [1377, "        rules_to_suppress:\n"], [1378, "        - id: W11\n"], [1379, "          reason: Cloudwatch does not support resource-level permissions\n"], [1380, "        - id: W89\n"], [1381, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1382, "            with AWS services via AWS APIs\n"], [1383, "        - id: W92\n"], [1384, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1385, "            to scale based on demand\n"], [1386, "    Properties:\n"], [1387, "      PermissionsBoundary:\n"], [1388, "        Fn::If:\n"], [1389, "        - HasPermissionsBoundary\n"], [1390, "        - Ref: PermissionsBoundaryArn\n"], [1391, "        - Ref: AWS::NoValue\n"], [1392, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/e9539c47c95c711353a09b757b9b8dc7\n"], [1393, "      Handler: index.handler\n"], [1394, "      Runtime: python3.12\n"], [1395, "      Timeout: 900\n"], [1396, "      MemorySize: 4096\n"], [1397, "      Environment:\n"], [1398, "        Variables:\n"], [1399, "          METRIC_NAMESPACE:\n"], [1400, "            Ref: StackName\n"], [1401, "          LOG_LEVEL:\n"], [1402, "            Ref: LogLevel\n"], [1403, "          APPSYNC_API_URL:\n"], [1404, "            Ref: AppSyncApiUrl\n"], [1405, "          WORKING_BUCKET:\n"], [1406, "            Ref: WorkingBucket\n"], [1407, "      LoggingConfig:\n"], [1408, "        LogGroup:\n"], [1409, "          Ref: ProcessResultsFunctionLogGroup\n"], [1410, "      Policies:\n"], [1411, "      - AWSLambdaBasicExecutionRole\n"], [1412, "      - S3ReadPolicy:\n"], [1413, "          BucketName:\n"], [1414, "            Ref: InputBucket\n"], [1415, "      - S3CrudPolicy:\n"], [1416, "          BucketName:\n"], [1417, "            Ref: OutputBucket\n"], [1418, "      - S3CrudPolicy:\n"], [1419, "          BucketName:\n"], [1420, "            Ref: WorkingBucket\n"], [1421, "      - Statement:\n"], [1422, "        - Effect: Allow\n"], [1423, "          Action: cloudwatch:PutMetricData\n"], [1424, "          Resource: '*'\n"], [1425, "        - Effect: Allow\n"], [1426, "          Action:\n"], [1427, "          - kms:Encrypt\n"], [1428, "          - kms:Decrypt\n"], [1429, "          - kms:ReEncrypt*\n"], [1430, "          - kms:GenerateDataKey*\n"], [1431, "          - kms:DescribeKey\n"], [1432, "          Resource:\n"], [1433, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1434, "        - Effect: Allow\n"], [1435, "          Action:\n"], [1436, "          - appsync:GraphQL\n"], [1437, "          Resource:\n"], [1438, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1372, 1438], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1372, "  ProcessResultsFunction:\n"], [1373, "    Type: AWS::Serverless::Function\n"], [1374, "    Metadata:\n"], [1375, "      SamResourceId: ProcessResultsFunction\n"], [1376, "      cfn_nag:\n"], [1377, "        rules_to_suppress:\n"], [1378, "        - id: W11\n"], [1379, "          reason: Cloudwatch does not support resource-level permissions\n"], [1380, "        - id: W89\n"], [1381, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1382, "            with AWS services via AWS APIs\n"], [1383, "        - id: W92\n"], [1384, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1385, "            to scale based on demand\n"], [1386, "    Properties:\n"], [1387, "      PermissionsBoundary:\n"], [1388, "        Fn::If:\n"], [1389, "        - HasPermissionsBoundary\n"], [1390, "        - Ref: PermissionsBoundaryArn\n"], [1391, "        - Ref: AWS::NoValue\n"], [1392, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/e9539c47c95c711353a09b757b9b8dc7\n"], [1393, "      Handler: index.handler\n"], [1394, "      Runtime: python3.12\n"], [1395, "      Timeout: 900\n"], [1396, "      MemorySize: 4096\n"], [1397, "      Environment:\n"], [1398, "        Variables:\n"], [1399, "          METRIC_NAMESPACE:\n"], [1400, "            Ref: StackName\n"], [1401, "          LOG_LEVEL:\n"], [1402, "            Ref: LogLevel\n"], [1403, "          APPSYNC_API_URL:\n"], [1404, "            Ref: AppSyncApiUrl\n"], [1405, "          WORKING_BUCKET:\n"], [1406, "            Ref: WorkingBucket\n"], [1407, "      LoggingConfig:\n"], [1408, "        LogGroup:\n"], [1409, "          Ref: ProcessResultsFunctionLogGroup\n"], [1410, "      Policies:\n"], [1411, "      - AWSLambdaBasicExecutionRole\n"], [1412, "      - S3ReadPolicy:\n"], [1413, "          BucketName:\n"], [1414, "            Ref: InputBucket\n"], [1415, "      - S3CrudPolicy:\n"], [1416, "          BucketName:\n"], [1417, "            Ref: OutputBucket\n"], [1418, "      - S3CrudPolicy:\n"], [1419, "          BucketName:\n"], [1420, "            Ref: WorkingBucket\n"], [1421, "      - Statement:\n"], [1422, "        - Effect: Allow\n"], [1423, "          Action: cloudwatch:PutMetricData\n"], [1424, "          Resource: '*'\n"], [1425, "        - Effect: Allow\n"], [1426, "          Action:\n"], [1427, "          - kms:Encrypt\n"], [1428, "          - kms:Decrypt\n"], [1429, "          - kms:ReEncrypt*\n"], [1430, "          - kms:GenerateDataKey*\n"], [1431, "          - kms:DescribeKey\n"], [1432, "          Resource:\n"], [1433, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1434, "        - Effect: Allow\n"], [1435, "          Action:\n"], [1436, "          - appsync:GraphQL\n"], [1437, "          Resource:\n"], [1438, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1372, 1438], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1372, "  ProcessResultsFunction:\n"], [1373, "    Type: AWS::Serverless::Function\n"], [1374, "    Metadata:\n"], [1375, "      SamResourceId: ProcessResultsFunction\n"], [1376, "      cfn_nag:\n"], [1377, "        rules_to_suppress:\n"], [1378, "        - id: W11\n"], [1379, "          reason: Cloudwatch does not support resource-level permissions\n"], [1380, "        - id: W89\n"], [1381, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1382, "            with AWS services via AWS APIs\n"], [1383, "        - id: W92\n"], [1384, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1385, "            to scale based on demand\n"], [1386, "    Properties:\n"], [1387, "      PermissionsBoundary:\n"], [1388, "        Fn::If:\n"], [1389, "        - HasPermissionsBoundary\n"], [1390, "        - Ref: PermissionsBoundaryArn\n"], [1391, "        - Ref: AWS::NoValue\n"], [1392, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/e9539c47c95c711353a09b757b9b8dc7\n"], [1393, "      Handler: index.handler\n"], [1394, "      Runtime: python3.12\n"], [1395, "      Timeout: 900\n"], [1396, "      MemorySize: 4096\n"], [1397, "      Environment:\n"], [1398, "        Variables:\n"], [1399, "          METRIC_NAMESPACE:\n"], [1400, "            Ref: StackName\n"], [1401, "          LOG_LEVEL:\n"], [1402, "            Ref: LogLevel\n"], [1403, "          APPSYNC_API_URL:\n"], [1404, "            Ref: AppSyncApiUrl\n"], [1405, "          WORKING_BUCKET:\n"], [1406, "            Ref: WorkingBucket\n"], [1407, "      LoggingConfig:\n"], [1408, "        LogGroup:\n"], [1409, "          Ref: ProcessResultsFunctionLogGroup\n"], [1410, "      Policies:\n"], [1411, "      - AWSLambdaBasicExecutionRole\n"], [1412, "      - S3ReadPolicy:\n"], [1413, "          BucketName:\n"], [1414, "            Ref: InputBucket\n"], [1415, "      - S3CrudPolicy:\n"], [1416, "          BucketName:\n"], [1417, "            Ref: OutputBucket\n"], [1418, "      - S3CrudPolicy:\n"], [1419, "          BucketName:\n"], [1420, "            Ref: WorkingBucket\n"], [1421, "      - Statement:\n"], [1422, "        - Effect: Allow\n"], [1423, "          Action: cloudwatch:PutMetricData\n"], [1424, "          Resource: '*'\n"], [1425, "        - Effect: Allow\n"], [1426, "          Action:\n"], [1427, "          - kms:Encrypt\n"], [1428, "          - kms:Decrypt\n"], [1429, "          - kms:ReEncrypt*\n"], [1430, "          - kms:GenerateDataKey*\n"], [1431, "          - kms:DescribeKey\n"], [1432, "          Resource:\n"], [1433, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1434, "        - Effect: Allow\n"], [1435, "          Action:\n"], [1436, "          - appsync:GraphQL\n"], [1437, "          Resource:\n"], [1438, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1372, 1438], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1372, "  ProcessResultsFunction:\n"], [1373, "    Type: AWS::Serverless::Function\n"], [1374, "    Metadata:\n"], [1375, "      SamResourceId: ProcessResultsFunction\n"], [1376, "      cfn_nag:\n"], [1377, "        rules_to_suppress:\n"], [1378, "        - id: W11\n"], [1379, "          reason: Cloudwatch does not support resource-level permissions\n"], [1380, "        - id: W89\n"], [1381, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1382, "            with AWS services via AWS APIs\n"], [1383, "        - id: W92\n"], [1384, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1385, "            to scale based on demand\n"], [1386, "    Properties:\n"], [1387, "      PermissionsBoundary:\n"], [1388, "        Fn::If:\n"], [1389, "        - HasPermissionsBoundary\n"], [1390, "        - Ref: PermissionsBoundaryArn\n"], [1391, "        - Ref: AWS::NoValue\n"], [1392, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/e9539c47c95c711353a09b757b9b8dc7\n"], [1393, "      Handler: index.handler\n"], [1394, "      Runtime: python3.12\n"], [1395, "      Timeout: 900\n"], [1396, "      MemorySize: 4096\n"], [1397, "      Environment:\n"], [1398, "        Variables:\n"], [1399, "          METRIC_NAMESPACE:\n"], [1400, "            Ref: StackName\n"], [1401, "          LOG_LEVEL:\n"], [1402, "            Ref: LogLevel\n"], [1403, "          APPSYNC_API_URL:\n"], [1404, "            Ref: AppSyncApiUrl\n"], [1405, "          WORKING_BUCKET:\n"], [1406, "            Ref: WorkingBucket\n"], [1407, "      LoggingConfig:\n"], [1408, "        LogGroup:\n"], [1409, "          Ref: ProcessResultsFunctionLogGroup\n"], [1410, "      Policies:\n"], [1411, "      - AWSLambdaBasicExecutionRole\n"], [1412, "      - S3ReadPolicy:\n"], [1413, "          BucketName:\n"], [1414, "            Ref: InputBucket\n"], [1415, "      - S3CrudPolicy:\n"], [1416, "          BucketName:\n"], [1417, "            Ref: OutputBucket\n"], [1418, "      - S3CrudPolicy:\n"], [1419, "          BucketName:\n"], [1420, "            Ref: WorkingBucket\n"], [1421, "      - Statement:\n"], [1422, "        - Effect: Allow\n"], [1423, "          Action: cloudwatch:PutMetricData\n"], [1424, "          Resource: '*'\n"], [1425, "        - Effect: Allow\n"], [1426, "          Action:\n"], [1427, "          - kms:Encrypt\n"], [1428, "          - kms:Decrypt\n"], [1429, "          - kms:ReEncrypt*\n"], [1430, "          - kms:GenerateDataKey*\n"], [1431, "          - kms:DescribeKey\n"], [1432, "          Resource:\n"], [1433, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1434, "        - Effect: Allow\n"], [1435, "          Action:\n"], [1436, "          - appsync:GraphQL\n"], [1437, "          Resource:\n"], [1438, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1372, 1438], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1450, "  SummarizationFunction:\n"], [1451, "    Type: AWS::Serverless::Function\n"], [1452, "    Metadata:\n"], [1453, "      SamResourceId: SummarizationFunction\n"], [1454, "      cfn_nag:\n"], [1455, "        rules_to_suppress:\n"], [1456, "        - id: W11\n"], [1457, "          reason: Cloudwatch does not support resource-level permissions\n"], [1458, "        - id: W89\n"], [1459, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1460, "            with AWS services via AWS APIs\n"], [1461, "        - id: W92\n"], [1462, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1463, "            to scale based on demand\n"], [1464, "    Properties:\n"], [1465, "      PermissionsBoundary:\n"], [1466, "        Fn::If:\n"], [1467, "        - HasPermissionsBoundary\n"], [1468, "        - Ref: PermissionsBoundaryArn\n"], [1469, "        - Ref: AWS::NoValue\n"], [1470, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/13ef51396fcb64ff363076ef9bb385ee\n"], [1471, "      Handler: index.handler\n"], [1472, "      Runtime: python3.12\n"], [1473, "      Timeout: 900\n"], [1474, "      MemorySize: 4096\n"], [1475, "      Environment:\n"], [1476, "        Variables:\n"], [1477, "          METRIC_NAMESPACE:\n"], [1478, "            Ref: StackName\n"], [1479, "          CONFIGURATION_TABLE_NAME:\n"], [1480, "            Ref: ConfigurationTable\n"], [1481, "          GUARDRAIL_ID_AND_VERSION:\n"], [1482, "            Fn::If:\n"], [1483, "            - HasGuardrailConfig\n"], [1484, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1485, "            - ''\n"], [1486, "          LOG_LEVEL:\n"], [1487, "            Ref: LogLevel\n"], [1488, "          APPSYNC_API_URL:\n"], [1489, "            Ref: AppSyncApiUrl\n"], [1490, "          WORKING_BUCKET:\n"], [1491, "            Ref: WorkingBucket\n"], [1492, "      LoggingConfig:\n"], [1493, "        LogGroup:\n"], [1494, "          Ref: SummarizationFunctionLogGroup\n"], [1495, "      Policies:\n"], [1496, "      - AWSLambdaBasicExecutionRole\n"], [1497, "      - S3ReadPolicy:\n"], [1498, "          BucketName:\n"], [1499, "            Ref: InputBucket\n"], [1500, "      - S3CrudPolicy:\n"], [1501, "          BucketName:\n"], [1502, "            Ref: OutputBucket\n"], [1503, "      - S3CrudPolicy:\n"], [1504, "          BucketName:\n"], [1505, "            Ref: WorkingBucket\n"], [1506, "      - DynamoDBCrudPolicy:\n"], [1507, "          TableName:\n"], [1508, "            Ref: ConfigurationTable\n"], [1509, "      - Statement:\n"], [1510, "        - Effect: Allow\n"], [1511, "          Action: cloudwatch:PutMetricData\n"], [1512, "          Resource: '*'\n"], [1513, "        - Effect: Allow\n"], [1514, "          Action:\n"], [1515, "          - kms:Encrypt\n"], [1516, "          - kms:Decrypt\n"], [1517, "          - kms:ReEncrypt*\n"], [1518, "          - kms:GenerateDataKey*\n"], [1519, "          - kms:DescribeKey\n"], [1520, "          Resource:\n"], [1521, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1522, "        - Effect: Allow\n"], [1523, "          Action:\n"], [1524, "          - appsync:GraphQL\n"], [1525, "          Resource:\n"], [1526, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1527, "        - Effect: Allow\n"], [1528, "          Action: bedrock:InvokeModel\n"], [1529, "          Resource:\n"], [1530, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1531, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1532, "        - Fn::If:\n"], [1533, "          - HasGuardrailConfig\n"], [1534, "          - Effect: Allow\n"], [1535, "            Action: bedrock:ApplyGuardrail\n"], [1536, "            Resource:\n"], [1537, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1538, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1450, 1538], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1450, "  SummarizationFunction:\n"], [1451, "    Type: AWS::Serverless::Function\n"], [1452, "    Metadata:\n"], [1453, "      SamResourceId: SummarizationFunction\n"], [1454, "      cfn_nag:\n"], [1455, "        rules_to_suppress:\n"], [1456, "        - id: W11\n"], [1457, "          reason: Cloudwatch does not support resource-level permissions\n"], [1458, "        - id: W89\n"], [1459, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1460, "            with AWS services via AWS APIs\n"], [1461, "        - id: W92\n"], [1462, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1463, "            to scale based on demand\n"], [1464, "    Properties:\n"], [1465, "      PermissionsBoundary:\n"], [1466, "        Fn::If:\n"], [1467, "        - HasPermissionsBoundary\n"], [1468, "        - Ref: PermissionsBoundaryArn\n"], [1469, "        - Ref: AWS::NoValue\n"], [1470, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/13ef51396fcb64ff363076ef9bb385ee\n"], [1471, "      Handler: index.handler\n"], [1472, "      Runtime: python3.12\n"], [1473, "      Timeout: 900\n"], [1474, "      MemorySize: 4096\n"], [1475, "      Environment:\n"], [1476, "        Variables:\n"], [1477, "          METRIC_NAMESPACE:\n"], [1478, "            Ref: StackName\n"], [1479, "          CONFIGURATION_TABLE_NAME:\n"], [1480, "            Ref: ConfigurationTable\n"], [1481, "          GUARDRAIL_ID_AND_VERSION:\n"], [1482, "            Fn::If:\n"], [1483, "            - HasGuardrailConfig\n"], [1484, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1485, "            - ''\n"], [1486, "          LOG_LEVEL:\n"], [1487, "            Ref: LogLevel\n"], [1488, "          APPSYNC_API_URL:\n"], [1489, "            Ref: AppSyncApiUrl\n"], [1490, "          WORKING_BUCKET:\n"], [1491, "            Ref: WorkingBucket\n"], [1492, "      LoggingConfig:\n"], [1493, "        LogGroup:\n"], [1494, "          Ref: SummarizationFunctionLogGroup\n"], [1495, "      Policies:\n"], [1496, "      - AWSLambdaBasicExecutionRole\n"], [1497, "      - S3ReadPolicy:\n"], [1498, "          BucketName:\n"], [1499, "            Ref: InputBucket\n"], [1500, "      - S3CrudPolicy:\n"], [1501, "          BucketName:\n"], [1502, "            Ref: OutputBucket\n"], [1503, "      - S3CrudPolicy:\n"], [1504, "          BucketName:\n"], [1505, "            Ref: WorkingBucket\n"], [1506, "      - DynamoDBCrudPolicy:\n"], [1507, "          TableName:\n"], [1508, "            Ref: ConfigurationTable\n"], [1509, "      - Statement:\n"], [1510, "        - Effect: Allow\n"], [1511, "          Action: cloudwatch:PutMetricData\n"], [1512, "          Resource: '*'\n"], [1513, "        - Effect: Allow\n"], [1514, "          Action:\n"], [1515, "          - kms:Encrypt\n"], [1516, "          - kms:Decrypt\n"], [1517, "          - kms:ReEncrypt*\n"], [1518, "          - kms:GenerateDataKey*\n"], [1519, "          - kms:DescribeKey\n"], [1520, "          Resource:\n"], [1521, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1522, "        - Effect: Allow\n"], [1523, "          Action:\n"], [1524, "          - appsync:GraphQL\n"], [1525, "          Resource:\n"], [1526, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1527, "        - Effect: Allow\n"], [1528, "          Action: bedrock:InvokeModel\n"], [1529, "          Resource:\n"], [1530, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1531, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1532, "        - Fn::If:\n"], [1533, "          - HasGuardrailConfig\n"], [1534, "          - Effect: Allow\n"], [1535, "            Action: bedrock:ApplyGuardrail\n"], [1536, "            Resource:\n"], [1537, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1538, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1450, 1538], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1450, "  SummarizationFunction:\n"], [1451, "    Type: AWS::Serverless::Function\n"], [1452, "    Metadata:\n"], [1453, "      SamResourceId: SummarizationFunction\n"], [1454, "      cfn_nag:\n"], [1455, "        rules_to_suppress:\n"], [1456, "        - id: W11\n"], [1457, "          reason: Cloudwatch does not support resource-level permissions\n"], [1458, "        - id: W89\n"], [1459, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1460, "            with AWS services via AWS APIs\n"], [1461, "        - id: W92\n"], [1462, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1463, "            to scale based on demand\n"], [1464, "    Properties:\n"], [1465, "      PermissionsBoundary:\n"], [1466, "        Fn::If:\n"], [1467, "        - HasPermissionsBoundary\n"], [1468, "        - Ref: PermissionsBoundaryArn\n"], [1469, "        - Ref: AWS::NoValue\n"], [1470, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/13ef51396fcb64ff363076ef9bb385ee\n"], [1471, "      Handler: index.handler\n"], [1472, "      Runtime: python3.12\n"], [1473, "      Timeout: 900\n"], [1474, "      MemorySize: 4096\n"], [1475, "      Environment:\n"], [1476, "        Variables:\n"], [1477, "          METRIC_NAMESPACE:\n"], [1478, "            Ref: StackName\n"], [1479, "          CONFIGURATION_TABLE_NAME:\n"], [1480, "            Ref: ConfigurationTable\n"], [1481, "          GUARDRAIL_ID_AND_VERSION:\n"], [1482, "            Fn::If:\n"], [1483, "            - HasGuardrailConfig\n"], [1484, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1485, "            - ''\n"], [1486, "          LOG_LEVEL:\n"], [1487, "            Ref: LogLevel\n"], [1488, "          APPSYNC_API_URL:\n"], [1489, "            Ref: AppSyncApiUrl\n"], [1490, "          WORKING_BUCKET:\n"], [1491, "            Ref: WorkingBucket\n"], [1492, "      LoggingConfig:\n"], [1493, "        LogGroup:\n"], [1494, "          Ref: SummarizationFunctionLogGroup\n"], [1495, "      Policies:\n"], [1496, "      - AWSLambdaBasicExecutionRole\n"], [1497, "      - S3ReadPolicy:\n"], [1498, "          BucketName:\n"], [1499, "            Ref: InputBucket\n"], [1500, "      - S3CrudPolicy:\n"], [1501, "          BucketName:\n"], [1502, "            Ref: OutputBucket\n"], [1503, "      - S3CrudPolicy:\n"], [1504, "          BucketName:\n"], [1505, "            Ref: WorkingBucket\n"], [1506, "      - DynamoDBCrudPolicy:\n"], [1507, "          TableName:\n"], [1508, "            Ref: ConfigurationTable\n"], [1509, "      - Statement:\n"], [1510, "        - Effect: Allow\n"], [1511, "          Action: cloudwatch:PutMetricData\n"], [1512, "          Resource: '*'\n"], [1513, "        - Effect: Allow\n"], [1514, "          Action:\n"], [1515, "          - kms:Encrypt\n"], [1516, "          - kms:Decrypt\n"], [1517, "          - kms:ReEncrypt*\n"], [1518, "          - kms:GenerateDataKey*\n"], [1519, "          - kms:DescribeKey\n"], [1520, "          Resource:\n"], [1521, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1522, "        - Effect: Allow\n"], [1523, "          Action:\n"], [1524, "          - appsync:GraphQL\n"], [1525, "          Resource:\n"], [1526, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1527, "        - Effect: Allow\n"], [1528, "          Action: bedrock:InvokeModel\n"], [1529, "          Resource:\n"], [1530, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1531, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1532, "        - Fn::If:\n"], [1533, "          - HasGuardrailConfig\n"], [1534, "          - Effect: Allow\n"], [1535, "            Action: bedrock:ApplyGuardrail\n"], [1536, "            Resource:\n"], [1537, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1538, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1450, 1538], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1450, "  SummarizationFunction:\n"], [1451, "    Type: AWS::Serverless::Function\n"], [1452, "    Metadata:\n"], [1453, "      SamResourceId: SummarizationFunction\n"], [1454, "      cfn_nag:\n"], [1455, "        rules_to_suppress:\n"], [1456, "        - id: W11\n"], [1457, "          reason: Cloudwatch does not support resource-level permissions\n"], [1458, "        - id: W89\n"], [1459, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1460, "            with AWS services via AWS APIs\n"], [1461, "        - id: W92\n"], [1462, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1463, "            to scale based on demand\n"], [1464, "    Properties:\n"], [1465, "      PermissionsBoundary:\n"], [1466, "        Fn::If:\n"], [1467, "        - HasPermissionsBoundary\n"], [1468, "        - Ref: PermissionsBoundaryArn\n"], [1469, "        - Ref: AWS::NoValue\n"], [1470, "      CodeUri: s3://bobs-artifacts-us-west-2/idp-dev-private/0.3.12-wip/13ef51396fcb64ff363076ef9bb385ee\n"], [1471, "      Handler: index.handler\n"], [1472, "      Runtime: python3.12\n"], [1473, "      Timeout: 900\n"], [1474, "      MemorySize: 4096\n"], [1475, "      Environment:\n"], [1476, "        Variables:\n"], [1477, "          METRIC_NAMESPACE:\n"], [1478, "            Ref: StackName\n"], [1479, "          CONFIGURATION_TABLE_NAME:\n"], [1480, "            Ref: ConfigurationTable\n"], [1481, "          GUARDRAIL_ID_AND_VERSION:\n"], [1482, "            Fn::If:\n"], [1483, "            - HasGuardrailConfig\n"], [1484, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1485, "            - ''\n"], [1486, "          LOG_LEVEL:\n"], [1487, "            Ref: LogLevel\n"], [1488, "          APPSYNC_API_URL:\n"], [1489, "            Ref: AppSyncApiUrl\n"], [1490, "          WORKING_BUCKET:\n"], [1491, "            Ref: WorkingBucket\n"], [1492, "      LoggingConfig:\n"], [1493, "        LogGroup:\n"], [1494, "          Ref: SummarizationFunctionLogGroup\n"], [1495, "      Policies:\n"], [1496, "      - AWSLambdaBasicExecutionRole\n"], [1497, "      - S3ReadPolicy:\n"], [1498, "          BucketName:\n"], [1499, "            Ref: InputBucket\n"], [1500, "      - S3CrudPolicy:\n"], [1501, "          BucketName:\n"], [1502, "            Ref: OutputBucket\n"], [1503, "      - S3CrudPolicy:\n"], [1504, "          BucketName:\n"], [1505, "            Ref: WorkingBucket\n"], [1506, "      - DynamoDBCrudPolicy:\n"], [1507, "          TableName:\n"], [1508, "            Ref: ConfigurationTable\n"], [1509, "      - Statement:\n"], [1510, "        - Effect: Allow\n"], [1511, "          Action: cloudwatch:PutMetricData\n"], [1512, "          Resource: '*'\n"], [1513, "        - Effect: Allow\n"], [1514, "          Action:\n"], [1515, "          - kms:Encrypt\n"], [1516, "          - kms:Decrypt\n"], [1517, "          - kms:ReEncrypt*\n"], [1518, "          - kms:GenerateDataKey*\n"], [1519, "          - kms:DescribeKey\n"], [1520, "          Resource:\n"], [1521, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1522, "        - Effect: Allow\n"], [1523, "          Action:\n"], [1524, "          - appsync:GraphQL\n"], [1525, "          Resource:\n"], [1526, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1527, "        - Effect: Allow\n"], [1528, "          Action: bedrock:InvokeModel\n"], [1529, "          Resource:\n"], [1530, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1531, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1532, "        - Fn::If:\n"], [1533, "          - HasGuardrailConfig\n"], [1534, "          - Effect: Allow\n"], [1535, "            Action: bedrock:ApplyGuardrail\n"], [1536, "            Resource:\n"], [1537, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1538, "          - Ref: AWS::NoValue\n"]], "file_path": "/packaged.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "repo_file_path": "/packaged.yaml", "file_line_range": [1450, 1538], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-2/.aws-sam/packaged.yaml", "attribute_key": "Default"}]}}]}, "summary": {"passed": 26, "failed": 24, "skipped": 0, "parsing_errors": 0, "resource_count": 17, "checkov_version": "3.2.461"}}