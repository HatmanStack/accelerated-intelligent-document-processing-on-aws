# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-08-09  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **10** security threats. The analysis reveals **0** critical, **3** high, **6** medium, and **1** low severity findings.

## Priority Actions

### 1. Restrict IAM policies to only the specific resources needed. Where APIs don't support resource-level permissions, consider using IAM policy conditions to limit scope (e.g., by specifying allowed metric namespaces for CloudWatch).

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-002  
**Business Impact:** Potential unauthorized access to AWS resources, escalation of privileges, and ability to perform actions outside the intended scope of the function.

### 1. Implement bucket policies restricting access to authorized principals only. Enable S3 access logging and versioning. Configure default encryption for all objects. Consider implementing S3 Object Lock for immutable storage of processed documents.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-008  
**Business Impact:** Unauthorized access to sensitive documents, potential data loss or modification, and lack of audit trail for document access or changes.

### 2. Implement log filtering to prevent sensitive data from being logged. Add resource-based policies to the CloudWatch Log groups to restrict access to authorized personnel only. Consider implementing AWS CloudWatch Logs Filter Subscriptions to filter sensitive information.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-001  
**Business Impact:** Unauthorized access to sensitive document content, extraction results, or possibly credentials that might be logged during processing.

### 2. Deploy Lambda functions within a VPC with appropriate subnet configuration and security groups. Use VPC endpoints for AWS services to maintain private communications. Implement a NAT gateway only if external connectivity is required.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-004  
**Business Impact:** Increased risk of data exfiltration, unnecessary network exposure, and potential for compromised functions to communicate with unauthorized external endpoints.

### 2. Implement comprehensive input validation for all document inputs. Validate file formats, sizes, and content before processing. Consider adding content scanning for malicious patterns. Use safe parsing libraries that are resistant to common attacks.

**Effort:** High  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-005  
**Business Impact:** Potential code injection, application crashes, or unexpected behavior that could lead to data leakage or resource consumption attacks.

### 2. Ensure all configuration data is encrypted both at rest and in transit. Implement strict IAM permissions for configuration access. Consider storing sensitive configuration elements in AWS Secrets Manager instead of directly in CloudFormation.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-007  
**Business Impact:** Exposure of sensitive business rules, document classification patterns, or extraction logic that could be used to craft evasive documents or understand the organization's document handling procedures.

### 2. Implement robust prompt engineering practices with input sanitization. Use Bedrock guardrails (already partially implemented) more extensively. Add content filtering before sending to AI models. Monitor AI responses for anomalous patterns that might indicate prompt injection.

**Effort:** High  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-009  
**Business Impact:** Data leakage, inaccurate document classification or extraction, and potential exposure of system details or processing logic.

### 3. Implement additional logging focused on security-relevant events. Configure CloudTrail data events for relevant S3 buckets. Add explicit audit logging within Lambda functions for sensitive operations with details about who performed what action on which document.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-003  
**Business Impact:** Difficulty in forensic analysis after a security incident, challenges in compliance auditing, and inability to detect unauthorized document access patterns.

### 3. Configure appropriate reserved concurrency limits for each Lambda function. Implement request throttling at the API layer. Consider implementing a queue-based architecture to control the processing rate of documents.

**Effort:** Low  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-006  
**Business Impact:** Service disruption, increased costs, and potential impact on other applications sharing the same AWS account resources.

### 4. Add security-focused metrics and alarms to the dashboard. Configure CloudWatch Alarms for unusual activity patterns. Consider implementing GuardDuty or Security Hub integration. Add metrics specifically for authentication failures, access denials, and other security events.

**Effort:** Medium  
**Related Threats:** AWS-GENAI-IDP-ACCELERATOR-THREAT-010  
**Business Impact:** Delayed detection of security incidents, inability to identify unusual patterns of behavior that might indicate compromise, and lack of visibility into security-relevant events.



## Detailed Threat Analysis

## High Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-002: Overly permissive IAM policies with wildcard resources

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `OCRFunction, ClassificationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-272

#### Issue
Several Lambda functions have IAM policies with wildcard resources for Textract and CloudWatch PutMetricData APIs, granting broader access than necessary and violating the principle of least privilege.

#### Attack Vector
If the Lambda function is compromised, an attacker could exploit these broad permissions to access other resources or services beyond what's required for the function's operation.

#### Potential Impact
Potential unauthorized access to AWS resources, escalation of privileges, and ability to perform actions outside the intended scope of the function.

#### Remediation
Restrict IAM policies to only the specific resources needed. Where APIs don't support resource-level permissions, consider using IAM policy conditions to limit scope (e.g., by specifying allowed metric namespaces for CloudWatch).

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-007: Potential sensitive configuration data exposure

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UpdateSchemaConfig, UpdateDefaultConfig` (AWS::CloudFormation::CustomResource)  
**CWE ID:** CWE-200

#### Issue
The template uses custom resources to update schema and default configurations, potentially exposing sensitive configuration data if not properly secured. This configuration likely includes document processing rules that could reveal business logic or confidential information processing patterns.

#### Attack Vector
An attacker with access to the CloudFormation stack or configuration data could gather intelligence about document processing rules, potentially discovering ways to bypass security controls.

#### Potential Impact
Exposure of sensitive business rules, document classification patterns, or extraction logic that could be used to craft evasive documents or understand the organization's document handling procedures.

#### Remediation
Ensure all configuration data is encrypted both at rest and in transit. Implement strict IAM permissions for configuration access. Consider storing sensitive configuration elements in AWS Secrets Manager instead of directly in CloudFormation.

**References:**
- https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-008: Missing S3 bucket security configurations

**STRIDE Category:** Tampering  
**Affected Resource:** `InputBucket, OutputBucket, ConfigurationBucket, WorkingBucket` (AWS::S3::Bucket)  
**CWE ID:** CWE-284

#### Issue
The CloudFormation template references S3 buckets but doesn't define or enforce security configurations such as bucket policies, access logging, versioning, or object-level encryption requirements. This could leave documents vulnerable to unauthorized access or tampering.

#### Attack Vector
An attacker could potentially access or modify documents if bucket permissions are misconfigured. Without versioning, tampered or deleted documents couldn't be recovered.

#### Potential Impact
Unauthorized access to sensitive documents, potential data loss or modification, and lack of audit trail for document access or changes.

#### Remediation
Implement bucket policies restricting access to authorized principals only. Enable S3 access logging and versioning. Configure default encryption for all objects. Consider implementing S3 Object Lock for immutable storage of processed documents.

**References:**
- https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html

---

## Medium Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-001: Potential log data exposure through CloudWatch Logs

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-532

#### Issue
Lambda functions are configured to log to CloudWatch Logs, which may include sensitive document content, extraction results, or credentials if not properly filtered. These logs lack specific access restrictions beyond the default KMS encryption.

#### Attack Vector
An attacker with CloudWatch Logs access permissions could view potentially sensitive document data processed by the Lambda functions.

#### Potential Impact
Unauthorized access to sensitive document content, extraction results, or possibly credentials that might be logged during processing.

#### Remediation
Implement log filtering to prevent sensitive data from being logged. Add resource-based policies to the CloudWatch Log groups to restrict access to authorized personnel only. Consider implementing AWS CloudWatch Logs Filter Subscriptions to filter sensitive information.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-003: Potential for insufficient auditing of document processing

**STRIDE Category:** Repudiation  
**Affected Resource:** `DocumentProcessingStateMachine` (AWS::Serverless::StateMachine)  
**CWE ID:** CWE-778

#### Issue
While the state machine has logging enabled, there's no explicit configuration for capturing detailed execution data for specific sensitive operations or for monitoring specific transitions that may indicate security-relevant events.

#### Attack Vector
An insider or attacker with access to the system could perform unauthorized actions on documents without sufficient audit trail to identify the specific actor or actions taken.

#### Potential Impact
Difficulty in forensic analysis after a security incident, challenges in compliance auditing, and inability to detect unauthorized document access patterns.

#### Remediation
Implement additional logging focused on security-relevant events. Configure CloudTrail data events for relevant S3 buckets. Add explicit audit logging within Lambda functions for sensitive operations with details about who performed what action on which document.

**References:**
- https://docs.aws.amazon.com/step-functions/latest/dg/cloudwatch-logs.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-004: Lack of VPC isolation for Lambda functions

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-668

#### Issue
Lambda functions are not configured to run within a VPC, which could expose them to unnecessary network access and reduce isolation. Functions processing potentially sensitive documents would benefit from additional network isolation.

#### Attack Vector
Without VPC isolation, Lambda functions have direct internet access, increasing attack surface and potentially allowing data exfiltration if compromised.

#### Potential Impact
Increased risk of data exfiltration, unnecessary network exposure, and potential for compromised functions to communicate with unauthorized external endpoints.

#### Remediation
Deploy Lambda functions within a VPC with appropriate subnet configuration and security groups. Use VPC endpoints for AWS services to maintain private communications. Implement a NAT gateway only if external connectivity is required.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-005: No explicit input validation for document processing

**STRIDE Category:** Tampering  
**Affected Resource:** `All Lambda functions` (AWS::Serverless::Function)  
**CWE ID:** CWE-20

#### Issue
The CloudFormation template doesn't indicate implementation of robust input validation for documents being processed. Without proper validation, malicious documents could potentially trigger vulnerabilities in the processing pipeline.

#### Attack Vector
An attacker could submit specially crafted documents designed to exploit vulnerabilities in the processing libraries or to trigger unexpected behaviors in the Lambda functions.

#### Potential Impact
Potential code injection, application crashes, or unexpected behavior that could lead to data leakage or resource consumption attacks.

#### Remediation
Implement comprehensive input validation for all document inputs. Validate file formats, sizes, and content before processing. Consider adding content scanning for malicious patterns. Use safe parsing libraries that are resistant to common attacks.

**References:**
- https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-006: Missing concurrent execution limits on Lambda functions

**STRIDE Category:** Denial of Service  
**Affected Resource:** `All Lambda functions` (AWS::Serverless::Function)  
**CWE ID:** CWE-770

#### Issue
Lambda functions don't have concurrent execution limits defined, which could lead to resource exhaustion if many documents are processed simultaneously, either legitimately or as part of a DoS attack.

#### Attack Vector
An attacker could trigger many simultaneous document processing requests, potentially exhausting available Lambda concurrency or downstream resources like Bedrock or Textract.

#### Potential Impact
Service disruption, increased costs, and potential impact on other applications sharing the same AWS account resources.

#### Remediation
Configure appropriate reserved concurrency limits for each Lambda function. Implement request throttling at the API layer. Consider implementing a queue-based architecture to control the processing rate of documents.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

### AWS-GENAI-IDP-ACCELERATOR-THREAT-009: Potential prompt injection vulnerabilities

**STRIDE Category:** Spoofing  
**Affected Resource:** `ExtractionFunction, AssessmentFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-74

#### Issue
Functions that use AI models (Bedrock) are processing user-supplied content that could be vulnerable to prompt injection attacks, where carefully crafted document content could manipulate the AI model's behavior.

#### Attack Vector
An attacker could submit documents with specially crafted content designed to manipulate the AI model's behavior, potentially extracting unauthorized information or bypassing security controls.

#### Potential Impact
Data leakage, inaccurate document classification or extraction, and potential exposure of system details or processing logic.

#### Remediation
Implement robust prompt engineering practices with input sanitization. Use Bedrock guardrails (already partially implemented) more extensively. Add content filtering before sending to AI models. Monitor AI responses for anomalous patterns that might indicate prompt injection.

**References:**
- https://www.amazon.com/Guardrails-User-Guide/dp/B0CYS1JMXS

---

## Low Severity Threats

### AWS-GENAI-IDP-ACCELERATOR-THREAT-010: Insufficient security metrics and alerting

**STRIDE Category:** Repudiation  
**Affected Resource:** `Dashboard` (AWS::CloudWatch::Dashboard)  
**CWE ID:** CWE-223

#### Issue
The CloudWatch dashboard focuses primarily on performance metrics rather than security-related metrics, potentially missing important security events or patterns that could indicate compromise.

#### Attack Vector
An attacker exploiting the system might not trigger alerts if the monitoring is focused only on performance and not security-relevant events.

#### Potential Impact
Delayed detection of security incidents, inability to identify unusual patterns of behavior that might indicate compromise, and lack of visibility into security-relevant events.

#### Remediation
Add security-focused metrics and alarms to the dashboard. Configure CloudWatch Alarms for unusual activity patterns. Consider implementing GuardDuty or Security Hub integration. Add metrics specifically for authentication failures, access denials, and other security events.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards.html

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*