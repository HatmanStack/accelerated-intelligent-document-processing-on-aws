{"check_type": "cloudformation", "results": {"failed_checks": [{"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[854, "  OCRFunction:\n"], [855, "    Type: AWS::Serverless::Function\n"], [856, "    Metadata:\n"], [857, "      SamResourceId: OCRFunction\n"], [858, "      cfn_nag:\n"], [859, "        rules_to_suppress:\n"], [860, "        - id: W11\n"], [861, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [862, "            resource-level permissions\n"], [863, "        - id: W89\n"], [864, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [865, "            with AWS services via AWS APIs\n"], [866, "        - id: W92\n"], [867, "          reason: Function does not require concurrent execution limits as it is designed\n"], [868, "            to scale based on demand\n"], [869, "    Properties:\n"], [870, "      PermissionsBoundary:\n"], [871, "        Fn::If:\n"], [872, "        - HasPermissionsBoundary\n"], [873, "        - Ref: PermissionsBoundaryArn\n"], [874, "        - Ref: AWS::NoValue\n"], [875, "      CodeUri: OCRFunction\n"], [876, "      Handler: index.handler\n"], [877, "      Runtime: python3.12\n"], [878, "      Timeout: 900\n"], [879, "      MemorySize: 4096\n"], [880, "      Environment:\n"], [881, "        Variables:\n"], [882, "          METRIC_NAMESPACE:\n"], [883, "            Ref: StackName\n"], [884, "          MAX_WORKERS: 20\n"], [885, "          CONFIGURATION_TABLE_NAME:\n"], [886, "            Ref: ConfigurationTable\n"], [887, "          LOG_LEVEL:\n"], [888, "            Ref: LogLevel\n"], [889, "          APPSYNC_API_URL:\n"], [890, "            Ref: AppSyncApiUrl\n"], [891, "          WORKING_BUCKET:\n"], [892, "            Ref: WorkingBucket\n"], [893, "      LoggingConfig:\n"], [894, "        LogGroup:\n"], [895, "          Ref: OCRFunctionLogGroup\n"], [896, "      Policies:\n"], [897, "      - AWSLambdaBasicExecutionRole\n"], [898, "      - S3CrudPolicy:\n"], [899, "          BucketName:\n"], [900, "            Ref: OutputBucket\n"], [901, "      - S3CrudPolicy:\n"], [902, "          BucketName:\n"], [903, "            Ref: WorkingBucket\n"], [904, "      - S3ReadPolicy:\n"], [905, "          BucketName:\n"], [906, "            Ref: InputBucket\n"], [907, "      - DynamoDBCrudPolicy:\n"], [908, "          TableName:\n"], [909, "            Ref: ConfigurationTable\n"], [910, "      - Statement:\n"], [911, "        - Effect: Allow\n"], [912, "          Action: cloudwatch:PutMetricData\n"], [913, "          Resource: '*'\n"], [914, "        - Effect: Allow\n"], [915, "          Action:\n"], [916, "          - kms:Encrypt\n"], [917, "          - kms:Decrypt\n"], [918, "          - kms:ReEncrypt*\n"], [919, "          - kms:GenerateDataKey*\n"], [920, "          - kms:DescribeKey\n"], [921, "          Resource:\n"], [922, "            Ref: CustomerManagedEncryptionKeyArn\n"], [923, "        - Effect: Allow\n"], [924, "          Action:\n"], [925, "          - textract:DetectDocumentText\n"], [926, "          - textract:AnalyzeDocument\n"], [927, "          Resource: '*'\n"], [928, "        - Effect: Allow\n"], [929, "          Action:\n"], [930, "          - appsync:GraphQL\n"], [931, "          Resource:\n"], [932, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [854, 932], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[854, "  OCRFunction:\n"], [855, "    Type: AWS::Serverless::Function\n"], [856, "    Metadata:\n"], [857, "      SamResourceId: OCRFunction\n"], [858, "      cfn_nag:\n"], [859, "        rules_to_suppress:\n"], [860, "        - id: W11\n"], [861, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [862, "            resource-level permissions\n"], [863, "        - id: W89\n"], [864, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [865, "            with AWS services via AWS APIs\n"], [866, "        - id: W92\n"], [867, "          reason: Function does not require concurrent execution limits as it is designed\n"], [868, "            to scale based on demand\n"], [869, "    Properties:\n"], [870, "      PermissionsBoundary:\n"], [871, "        Fn::If:\n"], [872, "        - HasPermissionsBoundary\n"], [873, "        - Ref: PermissionsBoundaryArn\n"], [874, "        - Ref: AWS::NoValue\n"], [875, "      CodeUri: OCRFunction\n"], [876, "      Handler: index.handler\n"], [877, "      Runtime: python3.12\n"], [878, "      Timeout: 900\n"], [879, "      MemorySize: 4096\n"], [880, "      Environment:\n"], [881, "        Variables:\n"], [882, "          METRIC_NAMESPACE:\n"], [883, "            Ref: StackName\n"], [884, "          MAX_WORKERS: 20\n"], [885, "          CONFIGURATION_TABLE_NAME:\n"], [886, "            Ref: ConfigurationTable\n"], [887, "          LOG_LEVEL:\n"], [888, "            Ref: LogLevel\n"], [889, "          APPSYNC_API_URL:\n"], [890, "            Ref: AppSyncApiUrl\n"], [891, "          WORKING_BUCKET:\n"], [892, "            Ref: WorkingBucket\n"], [893, "      LoggingConfig:\n"], [894, "        LogGroup:\n"], [895, "          Ref: OCRFunctionLogGroup\n"], [896, "      Policies:\n"], [897, "      - AWSLambdaBasicExecutionRole\n"], [898, "      - S3CrudPolicy:\n"], [899, "          BucketName:\n"], [900, "            Ref: OutputBucket\n"], [901, "      - S3CrudPolicy:\n"], [902, "          BucketName:\n"], [903, "            Ref: WorkingBucket\n"], [904, "      - S3ReadPolicy:\n"], [905, "          BucketName:\n"], [906, "            Ref: InputBucket\n"], [907, "      - DynamoDBCrudPolicy:\n"], [908, "          TableName:\n"], [909, "            Ref: ConfigurationTable\n"], [910, "      - Statement:\n"], [911, "        - Effect: Allow\n"], [912, "          Action: cloudwatch:PutMetricData\n"], [913, "          Resource: '*'\n"], [914, "        - Effect: Allow\n"], [915, "          Action:\n"], [916, "          - kms:Encrypt\n"], [917, "          - kms:Decrypt\n"], [918, "          - kms:ReEncrypt*\n"], [919, "          - kms:GenerateDataKey*\n"], [920, "          - kms:DescribeKey\n"], [921, "          Resource:\n"], [922, "            Ref: CustomerManagedEncryptionKeyArn\n"], [923, "        - Effect: Allow\n"], [924, "          Action:\n"], [925, "          - textract:DetectDocumentText\n"], [926, "          - textract:AnalyzeDocument\n"], [927, "          Resource: '*'\n"], [928, "        - Effect: Allow\n"], [929, "          Action:\n"], [930, "          - appsync:GraphQL\n"], [931, "          Resource:\n"], [932, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [854, 932], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[854, "  OCRFunction:\n"], [855, "    Type: AWS::Serverless::Function\n"], [856, "    Metadata:\n"], [857, "      SamResourceId: OCRFunction\n"], [858, "      cfn_nag:\n"], [859, "        rules_to_suppress:\n"], [860, "        - id: W11\n"], [861, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [862, "            resource-level permissions\n"], [863, "        - id: W89\n"], [864, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [865, "            with AWS services via AWS APIs\n"], [866, "        - id: W92\n"], [867, "          reason: Function does not require concurrent execution limits as it is designed\n"], [868, "            to scale based on demand\n"], [869, "    Properties:\n"], [870, "      PermissionsBoundary:\n"], [871, "        Fn::If:\n"], [872, "        - HasPermissionsBoundary\n"], [873, "        - Ref: PermissionsBoundaryArn\n"], [874, "        - Ref: AWS::NoValue\n"], [875, "      CodeUri: OCRFunction\n"], [876, "      Handler: index.handler\n"], [877, "      Runtime: python3.12\n"], [878, "      Timeout: 900\n"], [879, "      MemorySize: 4096\n"], [880, "      Environment:\n"], [881, "        Variables:\n"], [882, "          METRIC_NAMESPACE:\n"], [883, "            Ref: StackName\n"], [884, "          MAX_WORKERS: 20\n"], [885, "          CONFIGURATION_TABLE_NAME:\n"], [886, "            Ref: ConfigurationTable\n"], [887, "          LOG_LEVEL:\n"], [888, "            Ref: LogLevel\n"], [889, "          APPSYNC_API_URL:\n"], [890, "            Ref: AppSyncApiUrl\n"], [891, "          WORKING_BUCKET:\n"], [892, "            Ref: WorkingBucket\n"], [893, "      LoggingConfig:\n"], [894, "        LogGroup:\n"], [895, "          Ref: OCRFunctionLogGroup\n"], [896, "      Policies:\n"], [897, "      - AWSLambdaBasicExecutionRole\n"], [898, "      - S3CrudPolicy:\n"], [899, "          BucketName:\n"], [900, "            Ref: OutputBucket\n"], [901, "      - S3CrudPolicy:\n"], [902, "          BucketName:\n"], [903, "            Ref: WorkingBucket\n"], [904, "      - S3ReadPolicy:\n"], [905, "          BucketName:\n"], [906, "            Ref: InputBucket\n"], [907, "      - DynamoDBCrudPolicy:\n"], [908, "          TableName:\n"], [909, "            Ref: ConfigurationTable\n"], [910, "      - Statement:\n"], [911, "        - Effect: Allow\n"], [912, "          Action: cloudwatch:PutMetricData\n"], [913, "          Resource: '*'\n"], [914, "        - Effect: Allow\n"], [915, "          Action:\n"], [916, "          - kms:Encrypt\n"], [917, "          - kms:Decrypt\n"], [918, "          - kms:ReEncrypt*\n"], [919, "          - kms:GenerateDataKey*\n"], [920, "          - kms:DescribeKey\n"], [921, "          Resource:\n"], [922, "            Ref: CustomerManagedEncryptionKeyArn\n"], [923, "        - Effect: Allow\n"], [924, "          Action:\n"], [925, "          - textract:DetectDocumentText\n"], [926, "          - textract:AnalyzeDocument\n"], [927, "          Resource: '*'\n"], [928, "        - Effect: Allow\n"], [929, "          Action:\n"], [930, "          - appsync:GraphQL\n"], [931, "          Resource:\n"], [932, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [854, 932], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[854, "  OCRFunction:\n"], [855, "    Type: AWS::Serverless::Function\n"], [856, "    Metadata:\n"], [857, "      SamResourceId: OCRFunction\n"], [858, "      cfn_nag:\n"], [859, "        rules_to_suppress:\n"], [860, "        - id: W11\n"], [861, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [862, "            resource-level permissions\n"], [863, "        - id: W89\n"], [864, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [865, "            with AWS services via AWS APIs\n"], [866, "        - id: W92\n"], [867, "          reason: Function does not require concurrent execution limits as it is designed\n"], [868, "            to scale based on demand\n"], [869, "    Properties:\n"], [870, "      PermissionsBoundary:\n"], [871, "        Fn::If:\n"], [872, "        - HasPermissionsBoundary\n"], [873, "        - Ref: PermissionsBoundaryArn\n"], [874, "        - Ref: AWS::NoValue\n"], [875, "      CodeUri: OCRFunction\n"], [876, "      Handler: index.handler\n"], [877, "      Runtime: python3.12\n"], [878, "      Timeout: 900\n"], [879, "      MemorySize: 4096\n"], [880, "      Environment:\n"], [881, "        Variables:\n"], [882, "          METRIC_NAMESPACE:\n"], [883, "            Ref: StackName\n"], [884, "          MAX_WORKERS: 20\n"], [885, "          CONFIGURATION_TABLE_NAME:\n"], [886, "            Ref: ConfigurationTable\n"], [887, "          LOG_LEVEL:\n"], [888, "            Ref: LogLevel\n"], [889, "          APPSYNC_API_URL:\n"], [890, "            Ref: AppSyncApiUrl\n"], [891, "          WORKING_BUCKET:\n"], [892, "            Ref: WorkingBucket\n"], [893, "      LoggingConfig:\n"], [894, "        LogGroup:\n"], [895, "          Ref: OCRFunctionLogGroup\n"], [896, "      Policies:\n"], [897, "      - AWSLambdaBasicExecutionRole\n"], [898, "      - S3CrudPolicy:\n"], [899, "          BucketName:\n"], [900, "            Ref: OutputBucket\n"], [901, "      - S3CrudPolicy:\n"], [902, "          BucketName:\n"], [903, "            Ref: WorkingBucket\n"], [904, "      - S3ReadPolicy:\n"], [905, "          BucketName:\n"], [906, "            Ref: InputBucket\n"], [907, "      - DynamoDBCrudPolicy:\n"], [908, "          TableName:\n"], [909, "            Ref: ConfigurationTable\n"], [910, "      - Statement:\n"], [911, "        - Effect: Allow\n"], [912, "          Action: cloudwatch:PutMetricData\n"], [913, "          Resource: '*'\n"], [914, "        - Effect: Allow\n"], [915, "          Action:\n"], [916, "          - kms:Encrypt\n"], [917, "          - kms:Decrypt\n"], [918, "          - kms:ReEncrypt*\n"], [919, "          - kms:GenerateDataKey*\n"], [920, "          - kms:DescribeKey\n"], [921, "          Resource:\n"], [922, "            Ref: CustomerManagedEncryptionKeyArn\n"], [923, "        - Effect: Allow\n"], [924, "          Action:\n"], [925, "          - textract:DetectDocumentText\n"], [926, "          - textract:AnalyzeDocument\n"], [927, "          Resource: '*'\n"], [928, "        - Effect: Allow\n"], [929, "          Action:\n"], [930, "          - appsync:GraphQL\n"], [931, "          Resource:\n"], [932, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [854, 932], "resource": "AWS::Serverless::Function.OCRFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[942, "  ClassificationFunction:\n"], [943, "    Type: AWS::Serverless::Function\n"], [944, "    Metadata:\n"], [945, "      SamResourceId: ClassificationFunction\n"], [946, "      cfn_nag:\n"], [947, "        rules_to_suppress:\n"], [948, "        - id: W11\n"], [949, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [950, "            resource-level permissions\n"], [951, "        - id: W89\n"], [952, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [953, "            with AWS services via AWS APIs\n"], [954, "        - id: W92\n"], [955, "          reason: Function does not require concurrent execution limits as it is designed\n"], [956, "            to scale based on demand\n"], [957, "    Properties:\n"], [958, "      PermissionsBoundary:\n"], [959, "        Fn::If:\n"], [960, "        - HasPermissionsBoundary\n"], [961, "        - Ref: PermissionsBoundaryArn\n"], [962, "        - Ref: AWS::NoValue\n"], [963, "      CodeUri: ClassificationFunction\n"], [964, "      Handler: index.handler\n"], [965, "      Runtime: python3.12\n"], [966, "      Timeout: 900\n"], [967, "      MemorySize: 4096\n"], [968, "      Environment:\n"], [969, "        Variables:\n"], [970, "          METRIC_NAMESPACE:\n"], [971, "            Ref: StackName\n"], [972, "          MAX_WORKERS: 20\n"], [973, "          TRACKING_TABLE:\n"], [974, "            Ref: TrackingTable\n"], [975, "          SAGEMAKER_ENDPOINT_NAME:\n"], [976, "            Fn::GetAtt:\n"], [977, "            - SAGEMAKERCLASSIFIERSTACK\n"], [978, "            - Outputs.EndpointName\n"], [979, "          CONFIGURATION_TABLE_NAME:\n"], [980, "            Ref: ConfigurationTable\n"], [981, "          APPSYNC_API_URL:\n"], [982, "            Ref: AppSyncApiUrl\n"], [983, "          GUARDRAIL_ID_AND_VERSION:\n"], [984, "            Fn::If:\n"], [985, "            - HasGuardrailConfig\n"], [986, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [987, "            - ''\n"], [988, "          LOG_LEVEL:\n"], [989, "            Ref: LogLevel\n"], [990, "          WORKING_BUCKET:\n"], [991, "            Ref: WorkingBucket\n"], [992, "      LoggingConfig:\n"], [993, "        LogGroup:\n"], [994, "          Ref: ClassificationFunctionLogGroup\n"], [995, "      Policies:\n"], [996, "      - AWSLambdaBasicExecutionRole\n"], [997, "      - S3CrudPolicy:\n"], [998, "          BucketName:\n"], [999, "            Ref: OutputBucket\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: WorkingBucket\n"], [1003, "      - S3ReadPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: InputBucket\n"], [1006, "      - DynamoDBCrudPolicy:\n"], [1007, "          TableName:\n"], [1008, "            Ref: TrackingTable\n"], [1009, "      - S3ReadPolicy:\n"], [1010, "          BucketName:\n"], [1011, "            Ref: ConfigurationBucket\n"], [1012, "      - DynamoDBCrudPolicy:\n"], [1013, "          TableName:\n"], [1014, "            Ref: ConfigurationTable\n"], [1015, "      - Statement:\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action: cloudwatch:PutMetricData\n"], [1018, "          Resource: '*'\n"], [1019, "        - Effect: Allow\n"], [1020, "          Action:\n"], [1021, "          - kms:Encrypt\n"], [1022, "          - kms:Decrypt\n"], [1023, "          - kms:ReEncrypt*\n"], [1024, "          - kms:GenerateDataKey*\n"], [1025, "          - kms:DescribeKey\n"], [1026, "          Resource:\n"], [1027, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1028, "        - Effect: Allow\n"], [1029, "          Action: sagemaker:InvokeEndpoint\n"], [1030, "          Resource:\n"], [1031, "            Fn::GetAtt:\n"], [1032, "            - SAGEMAKERCLASSIFIERSTACK\n"], [1033, "            - Outputs.EndpointArn\n"], [1034, "        - Effect: Allow\n"], [1035, "          Action:\n"], [1036, "          - appsync:GraphQL\n"], [1037, "          Resource:\n"], [1038, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1039, "        - Fn::If:\n"], [1040, "          - HasGuardrailConfig\n"], [1041, "          - Effect: Allow\n"], [1042, "            Action: bedrock:ApplyGuardrail\n"], [1043, "            Resource:\n"], [1044, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1045, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [942, 1045], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[942, "  ClassificationFunction:\n"], [943, "    Type: AWS::Serverless::Function\n"], [944, "    Metadata:\n"], [945, "      SamResourceId: ClassificationFunction\n"], [946, "      cfn_nag:\n"], [947, "        rules_to_suppress:\n"], [948, "        - id: W11\n"], [949, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [950, "            resource-level permissions\n"], [951, "        - id: W89\n"], [952, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [953, "            with AWS services via AWS APIs\n"], [954, "        - id: W92\n"], [955, "          reason: Function does not require concurrent execution limits as it is designed\n"], [956, "            to scale based on demand\n"], [957, "    Properties:\n"], [958, "      PermissionsBoundary:\n"], [959, "        Fn::If:\n"], [960, "        - HasPermissionsBoundary\n"], [961, "        - Ref: PermissionsBoundaryArn\n"], [962, "        - Ref: AWS::NoValue\n"], [963, "      CodeUri: ClassificationFunction\n"], [964, "      Handler: index.handler\n"], [965, "      Runtime: python3.12\n"], [966, "      Timeout: 900\n"], [967, "      MemorySize: 4096\n"], [968, "      Environment:\n"], [969, "        Variables:\n"], [970, "          METRIC_NAMESPACE:\n"], [971, "            Ref: StackName\n"], [972, "          MAX_WORKERS: 20\n"], [973, "          TRACKING_TABLE:\n"], [974, "            Ref: TrackingTable\n"], [975, "          SAGEMAKER_ENDPOINT_NAME:\n"], [976, "            Fn::GetAtt:\n"], [977, "            - SAGEMAKERCLASSIFIERSTACK\n"], [978, "            - Outputs.EndpointName\n"], [979, "          CONFIGURATION_TABLE_NAME:\n"], [980, "            Ref: ConfigurationTable\n"], [981, "          APPSYNC_API_URL:\n"], [982, "            Ref: AppSyncApiUrl\n"], [983, "          GUARDRAIL_ID_AND_VERSION:\n"], [984, "            Fn::If:\n"], [985, "            - HasGuardrailConfig\n"], [986, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [987, "            - ''\n"], [988, "          LOG_LEVEL:\n"], [989, "            Ref: LogLevel\n"], [990, "          WORKING_BUCKET:\n"], [991, "            Ref: WorkingBucket\n"], [992, "      LoggingConfig:\n"], [993, "        LogGroup:\n"], [994, "          Ref: ClassificationFunctionLogGroup\n"], [995, "      Policies:\n"], [996, "      - AWSLambdaBasicExecutionRole\n"], [997, "      - S3CrudPolicy:\n"], [998, "          BucketName:\n"], [999, "            Ref: OutputBucket\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: WorkingBucket\n"], [1003, "      - S3ReadPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: InputBucket\n"], [1006, "      - DynamoDBCrudPolicy:\n"], [1007, "          TableName:\n"], [1008, "            Ref: TrackingTable\n"], [1009, "      - S3ReadPolicy:\n"], [1010, "          BucketName:\n"], [1011, "            Ref: ConfigurationBucket\n"], [1012, "      - DynamoDBCrudPolicy:\n"], [1013, "          TableName:\n"], [1014, "            Ref: ConfigurationTable\n"], [1015, "      - Statement:\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action: cloudwatch:PutMetricData\n"], [1018, "          Resource: '*'\n"], [1019, "        - Effect: Allow\n"], [1020, "          Action:\n"], [1021, "          - kms:Encrypt\n"], [1022, "          - kms:Decrypt\n"], [1023, "          - kms:ReEncrypt*\n"], [1024, "          - kms:GenerateDataKey*\n"], [1025, "          - kms:DescribeKey\n"], [1026, "          Resource:\n"], [1027, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1028, "        - Effect: Allow\n"], [1029, "          Action: sagemaker:InvokeEndpoint\n"], [1030, "          Resource:\n"], [1031, "            Fn::GetAtt:\n"], [1032, "            - SAGEMAKERCLASSIFIERSTACK\n"], [1033, "            - Outputs.EndpointArn\n"], [1034, "        - Effect: Allow\n"], [1035, "          Action:\n"], [1036, "          - appsync:GraphQL\n"], [1037, "          Resource:\n"], [1038, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1039, "        - Fn::If:\n"], [1040, "          - HasGuardrailConfig\n"], [1041, "          - Effect: Allow\n"], [1042, "            Action: bedrock:ApplyGuardrail\n"], [1043, "            Resource:\n"], [1044, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1045, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [942, 1045], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[942, "  ClassificationFunction:\n"], [943, "    Type: AWS::Serverless::Function\n"], [944, "    Metadata:\n"], [945, "      SamResourceId: ClassificationFunction\n"], [946, "      cfn_nag:\n"], [947, "        rules_to_suppress:\n"], [948, "        - id: W11\n"], [949, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [950, "            resource-level permissions\n"], [951, "        - id: W89\n"], [952, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [953, "            with AWS services via AWS APIs\n"], [954, "        - id: W92\n"], [955, "          reason: Function does not require concurrent execution limits as it is designed\n"], [956, "            to scale based on demand\n"], [957, "    Properties:\n"], [958, "      PermissionsBoundary:\n"], [959, "        Fn::If:\n"], [960, "        - HasPermissionsBoundary\n"], [961, "        - Ref: PermissionsBoundaryArn\n"], [962, "        - Ref: AWS::NoValue\n"], [963, "      CodeUri: ClassificationFunction\n"], [964, "      Handler: index.handler\n"], [965, "      Runtime: python3.12\n"], [966, "      Timeout: 900\n"], [967, "      MemorySize: 4096\n"], [968, "      Environment:\n"], [969, "        Variables:\n"], [970, "          METRIC_NAMESPACE:\n"], [971, "            Ref: StackName\n"], [972, "          MAX_WORKERS: 20\n"], [973, "          TRACKING_TABLE:\n"], [974, "            Ref: TrackingTable\n"], [975, "          SAGEMAKER_ENDPOINT_NAME:\n"], [976, "            Fn::GetAtt:\n"], [977, "            - SAGEMAKERCLASSIFIERSTACK\n"], [978, "            - Outputs.EndpointName\n"], [979, "          CONFIGURATION_TABLE_NAME:\n"], [980, "            Ref: ConfigurationTable\n"], [981, "          APPSYNC_API_URL:\n"], [982, "            Ref: AppSyncApiUrl\n"], [983, "          GUARDRAIL_ID_AND_VERSION:\n"], [984, "            Fn::If:\n"], [985, "            - HasGuardrailConfig\n"], [986, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [987, "            - ''\n"], [988, "          LOG_LEVEL:\n"], [989, "            Ref: LogLevel\n"], [990, "          WORKING_BUCKET:\n"], [991, "            Ref: WorkingBucket\n"], [992, "      LoggingConfig:\n"], [993, "        LogGroup:\n"], [994, "          Ref: ClassificationFunctionLogGroup\n"], [995, "      Policies:\n"], [996, "      - AWSLambdaBasicExecutionRole\n"], [997, "      - S3CrudPolicy:\n"], [998, "          BucketName:\n"], [999, "            Ref: OutputBucket\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: WorkingBucket\n"], [1003, "      - S3ReadPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: InputBucket\n"], [1006, "      - DynamoDBCrudPolicy:\n"], [1007, "          TableName:\n"], [1008, "            Ref: TrackingTable\n"], [1009, "      - S3ReadPolicy:\n"], [1010, "          BucketName:\n"], [1011, "            Ref: ConfigurationBucket\n"], [1012, "      - DynamoDBCrudPolicy:\n"], [1013, "          TableName:\n"], [1014, "            Ref: ConfigurationTable\n"], [1015, "      - Statement:\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action: cloudwatch:PutMetricData\n"], [1018, "          Resource: '*'\n"], [1019, "        - Effect: Allow\n"], [1020, "          Action:\n"], [1021, "          - kms:Encrypt\n"], [1022, "          - kms:Decrypt\n"], [1023, "          - kms:ReEncrypt*\n"], [1024, "          - kms:GenerateDataKey*\n"], [1025, "          - kms:DescribeKey\n"], [1026, "          Resource:\n"], [1027, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1028, "        - Effect: Allow\n"], [1029, "          Action: sagemaker:InvokeEndpoint\n"], [1030, "          Resource:\n"], [1031, "            Fn::GetAtt:\n"], [1032, "            - SAGEMAKERCLASSIFIERSTACK\n"], [1033, "            - Outputs.EndpointArn\n"], [1034, "        - Effect: Allow\n"], [1035, "          Action:\n"], [1036, "          - appsync:GraphQL\n"], [1037, "          Resource:\n"], [1038, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1039, "        - Fn::If:\n"], [1040, "          - HasGuardrailConfig\n"], [1041, "          - Effect: Allow\n"], [1042, "            Action: bedrock:ApplyGuardrail\n"], [1043, "            Resource:\n"], [1044, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1045, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [942, 1045], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[942, "  ClassificationFunction:\n"], [943, "    Type: AWS::Serverless::Function\n"], [944, "    Metadata:\n"], [945, "      SamResourceId: ClassificationFunction\n"], [946, "      cfn_nag:\n"], [947, "        rules_to_suppress:\n"], [948, "        - id: W11\n"], [949, "          reason: Textract DetectDocumentText API and CloudWatch APIs do not support\n"], [950, "            resource-level permissions\n"], [951, "        - id: W89\n"], [952, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [953, "            with AWS services via AWS APIs\n"], [954, "        - id: W92\n"], [955, "          reason: Function does not require concurrent execution limits as it is designed\n"], [956, "            to scale based on demand\n"], [957, "    Properties:\n"], [958, "      PermissionsBoundary:\n"], [959, "        Fn::If:\n"], [960, "        - HasPermissionsBoundary\n"], [961, "        - Ref: PermissionsBoundaryArn\n"], [962, "        - Ref: AWS::NoValue\n"], [963, "      CodeUri: ClassificationFunction\n"], [964, "      Handler: index.handler\n"], [965, "      Runtime: python3.12\n"], [966, "      Timeout: 900\n"], [967, "      MemorySize: 4096\n"], [968, "      Environment:\n"], [969, "        Variables:\n"], [970, "          METRIC_NAMESPACE:\n"], [971, "            Ref: StackName\n"], [972, "          MAX_WORKERS: 20\n"], [973, "          TRACKING_TABLE:\n"], [974, "            Ref: TrackingTable\n"], [975, "          SAGEMAKER_ENDPOINT_NAME:\n"], [976, "            Fn::GetAtt:\n"], [977, "            - SAGEMAKERCLASSIFIERSTACK\n"], [978, "            - Outputs.EndpointName\n"], [979, "          CONFIGURATION_TABLE_NAME:\n"], [980, "            Ref: ConfigurationTable\n"], [981, "          APPSYNC_API_URL:\n"], [982, "            Ref: AppSyncApiUrl\n"], [983, "          GUARDRAIL_ID_AND_VERSION:\n"], [984, "            Fn::If:\n"], [985, "            - HasGuardrailConfig\n"], [986, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [987, "            - ''\n"], [988, "          LOG_LEVEL:\n"], [989, "            Ref: LogLevel\n"], [990, "          WORKING_BUCKET:\n"], [991, "            Ref: WorkingBucket\n"], [992, "      LoggingConfig:\n"], [993, "        LogGroup:\n"], [994, "          Ref: ClassificationFunctionLogGroup\n"], [995, "      Policies:\n"], [996, "      - AWSLambdaBasicExecutionRole\n"], [997, "      - S3CrudPolicy:\n"], [998, "          BucketName:\n"], [999, "            Ref: OutputBucket\n"], [1000, "      - S3CrudPolicy:\n"], [1001, "          BucketName:\n"], [1002, "            Ref: WorkingBucket\n"], [1003, "      - S3ReadPolicy:\n"], [1004, "          BucketName:\n"], [1005, "            Ref: InputBucket\n"], [1006, "      - DynamoDBCrudPolicy:\n"], [1007, "          TableName:\n"], [1008, "            Ref: TrackingTable\n"], [1009, "      - S3ReadPolicy:\n"], [1010, "          BucketName:\n"], [1011, "            Ref: ConfigurationBucket\n"], [1012, "      - DynamoDBCrudPolicy:\n"], [1013, "          TableName:\n"], [1014, "            Ref: ConfigurationTable\n"], [1015, "      - Statement:\n"], [1016, "        - Effect: Allow\n"], [1017, "          Action: cloudwatch:PutMetricData\n"], [1018, "          Resource: '*'\n"], [1019, "        - Effect: Allow\n"], [1020, "          Action:\n"], [1021, "          - kms:Encrypt\n"], [1022, "          - kms:Decrypt\n"], [1023, "          - kms:ReEncrypt*\n"], [1024, "          - kms:GenerateDataKey*\n"], [1025, "          - kms:DescribeKey\n"], [1026, "          Resource:\n"], [1027, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1028, "        - Effect: Allow\n"], [1029, "          Action: sagemaker:InvokeEndpoint\n"], [1030, "          Resource:\n"], [1031, "            Fn::GetAtt:\n"], [1032, "            - SAGEMAKERCLASSIFIERSTACK\n"], [1033, "            - Outputs.EndpointArn\n"], [1034, "        - Effect: Allow\n"], [1035, "          Action:\n"], [1036, "          - appsync:GraphQL\n"], [1037, "          Resource:\n"], [1038, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1039, "        - Fn::If:\n"], [1040, "          - HasGuardrailConfig\n"], [1041, "          - Effect: Allow\n"], [1042, "            Action: bedrock:ApplyGuardrail\n"], [1043, "            Resource:\n"], [1044, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1045, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [942, 1045], "resource": "AWS::Serverless::Function.ClassificationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1055, "  ExtractionFunction:\n"], [1056, "    Type: AWS::Serverless::Function\n"], [1057, "    Metadata:\n"], [1058, "      SamResourceId: ExtractionFunction\n"], [1059, "      cfn_nag:\n"], [1060, "        rules_to_suppress:\n"], [1061, "        - id: W11\n"], [1062, "          reason: Cloudwatch does not support resource-level permissions\n"], [1063, "        - id: W89\n"], [1064, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1065, "            with AWS services via AWS APIs\n"], [1066, "        - id: W92\n"], [1067, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1068, "            to scale based on demand\n"], [1069, "    Properties:\n"], [1070, "      PermissionsBoundary:\n"], [1071, "        Fn::If:\n"], [1072, "        - HasPermissionsBoundary\n"], [1073, "        - Ref: PermissionsBoundaryArn\n"], [1074, "        - Ref: AWS::NoValue\n"], [1075, "      CodeUri: ExtractionFunction\n"], [1076, "      Handler: index.handler\n"], [1077, "      Runtime: python3.12\n"], [1078, "      Timeout: 900\n"], [1079, "      MemorySize: 512\n"], [1080, "      Environment:\n"], [1081, "        Variables:\n"], [1082, "          METRIC_NAMESPACE:\n"], [1083, "            Ref: StackName\n"], [1084, "          CONFIGURATION_TABLE_NAME:\n"], [1085, "            Ref: ConfigurationTable\n"], [1086, "          GUARDRAIL_ID_AND_VERSION:\n"], [1087, "            Fn::If:\n"], [1088, "            - HasGuardrailConfig\n"], [1089, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1090, "            - ''\n"], [1091, "          LOG_LEVEL:\n"], [1092, "            Ref: LogLevel\n"], [1093, "          APPSYNC_API_URL:\n"], [1094, "            Ref: AppSyncApiUrl\n"], [1095, "          WORKING_BUCKET:\n"], [1096, "            Ref: WorkingBucket\n"], [1097, "      LoggingConfig:\n"], [1098, "        LogGroup:\n"], [1099, "          Ref: ExtractionFunctionLogGroup\n"], [1100, "      Policies:\n"], [1101, "      - AWSLambdaBasicExecutionRole\n"], [1102, "      - S3CrudPolicy:\n"], [1103, "          BucketName:\n"], [1104, "            Ref: OutputBucket\n"], [1105, "      - S3CrudPolicy:\n"], [1106, "          BucketName:\n"], [1107, "            Ref: WorkingBucket\n"], [1108, "      - S3ReadPolicy:\n"], [1109, "          BucketName:\n"], [1110, "            Ref: InputBucket\n"], [1111, "      - S3ReadPolicy:\n"], [1112, "          BucketName:\n"], [1113, "            Ref: ConfigurationBucket\n"], [1114, "      - DynamoDBCrudPolicy:\n"], [1115, "          TableName:\n"], [1116, "            Ref: ConfigurationTable\n"], [1117, "      - Statement:\n"], [1118, "        - Effect: Allow\n"], [1119, "          Action: cloudwatch:PutMetricData\n"], [1120, "          Resource: '*'\n"], [1121, "        - Effect: Allow\n"], [1122, "          Action:\n"], [1123, "          - kms:Encrypt\n"], [1124, "          - kms:Decrypt\n"], [1125, "          - kms:ReEncrypt*\n"], [1126, "          - kms:GenerateDataKey*\n"], [1127, "          - kms:DescribeKey\n"], [1128, "          Resource:\n"], [1129, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1130, "        - Effect: Allow\n"], [1131, "          Action: bedrock:InvokeModel\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1134, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1135, "        - Effect: Allow\n"], [1136, "          Action:\n"], [1137, "          - appsync:GraphQL\n"], [1138, "          Resource:\n"], [1139, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1140, "        - Fn::If:\n"], [1141, "          - HasGuardrailConfig\n"], [1142, "          - Effect: Allow\n"], [1143, "            Action: bedrock:ApplyGuardrail\n"], [1144, "            Resource:\n"], [1145, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1146, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1055, 1146], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1055, "  ExtractionFunction:\n"], [1056, "    Type: AWS::Serverless::Function\n"], [1057, "    Metadata:\n"], [1058, "      SamResourceId: ExtractionFunction\n"], [1059, "      cfn_nag:\n"], [1060, "        rules_to_suppress:\n"], [1061, "        - id: W11\n"], [1062, "          reason: Cloudwatch does not support resource-level permissions\n"], [1063, "        - id: W89\n"], [1064, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1065, "            with AWS services via AWS APIs\n"], [1066, "        - id: W92\n"], [1067, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1068, "            to scale based on demand\n"], [1069, "    Properties:\n"], [1070, "      PermissionsBoundary:\n"], [1071, "        Fn::If:\n"], [1072, "        - HasPermissionsBoundary\n"], [1073, "        - Ref: PermissionsBoundaryArn\n"], [1074, "        - Ref: AWS::NoValue\n"], [1075, "      CodeUri: ExtractionFunction\n"], [1076, "      Handler: index.handler\n"], [1077, "      Runtime: python3.12\n"], [1078, "      Timeout: 900\n"], [1079, "      MemorySize: 512\n"], [1080, "      Environment:\n"], [1081, "        Variables:\n"], [1082, "          METRIC_NAMESPACE:\n"], [1083, "            Ref: StackName\n"], [1084, "          CONFIGURATION_TABLE_NAME:\n"], [1085, "            Ref: ConfigurationTable\n"], [1086, "          GUARDRAIL_ID_AND_VERSION:\n"], [1087, "            Fn::If:\n"], [1088, "            - HasGuardrailConfig\n"], [1089, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1090, "            - ''\n"], [1091, "          LOG_LEVEL:\n"], [1092, "            Ref: LogLevel\n"], [1093, "          APPSYNC_API_URL:\n"], [1094, "            Ref: AppSyncApiUrl\n"], [1095, "          WORKING_BUCKET:\n"], [1096, "            Ref: WorkingBucket\n"], [1097, "      LoggingConfig:\n"], [1098, "        LogGroup:\n"], [1099, "          Ref: ExtractionFunctionLogGroup\n"], [1100, "      Policies:\n"], [1101, "      - AWSLambdaBasicExecutionRole\n"], [1102, "      - S3CrudPolicy:\n"], [1103, "          BucketName:\n"], [1104, "            Ref: OutputBucket\n"], [1105, "      - S3CrudPolicy:\n"], [1106, "          BucketName:\n"], [1107, "            Ref: WorkingBucket\n"], [1108, "      - S3ReadPolicy:\n"], [1109, "          BucketName:\n"], [1110, "            Ref: InputBucket\n"], [1111, "      - S3ReadPolicy:\n"], [1112, "          BucketName:\n"], [1113, "            Ref: ConfigurationBucket\n"], [1114, "      - DynamoDBCrudPolicy:\n"], [1115, "          TableName:\n"], [1116, "            Ref: ConfigurationTable\n"], [1117, "      - Statement:\n"], [1118, "        - Effect: Allow\n"], [1119, "          Action: cloudwatch:PutMetricData\n"], [1120, "          Resource: '*'\n"], [1121, "        - Effect: Allow\n"], [1122, "          Action:\n"], [1123, "          - kms:Encrypt\n"], [1124, "          - kms:Decrypt\n"], [1125, "          - kms:ReEncrypt*\n"], [1126, "          - kms:GenerateDataKey*\n"], [1127, "          - kms:DescribeKey\n"], [1128, "          Resource:\n"], [1129, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1130, "        - Effect: Allow\n"], [1131, "          Action: bedrock:InvokeModel\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1134, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1135, "        - Effect: Allow\n"], [1136, "          Action:\n"], [1137, "          - appsync:GraphQL\n"], [1138, "          Resource:\n"], [1139, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1140, "        - Fn::If:\n"], [1141, "          - HasGuardrailConfig\n"], [1142, "          - Effect: Allow\n"], [1143, "            Action: bedrock:ApplyGuardrail\n"], [1144, "            Resource:\n"], [1145, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1146, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1055, 1146], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1055, "  ExtractionFunction:\n"], [1056, "    Type: AWS::Serverless::Function\n"], [1057, "    Metadata:\n"], [1058, "      SamResourceId: ExtractionFunction\n"], [1059, "      cfn_nag:\n"], [1060, "        rules_to_suppress:\n"], [1061, "        - id: W11\n"], [1062, "          reason: Cloudwatch does not support resource-level permissions\n"], [1063, "        - id: W89\n"], [1064, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1065, "            with AWS services via AWS APIs\n"], [1066, "        - id: W92\n"], [1067, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1068, "            to scale based on demand\n"], [1069, "    Properties:\n"], [1070, "      PermissionsBoundary:\n"], [1071, "        Fn::If:\n"], [1072, "        - HasPermissionsBoundary\n"], [1073, "        - Ref: PermissionsBoundaryArn\n"], [1074, "        - Ref: AWS::NoValue\n"], [1075, "      CodeUri: ExtractionFunction\n"], [1076, "      Handler: index.handler\n"], [1077, "      Runtime: python3.12\n"], [1078, "      Timeout: 900\n"], [1079, "      MemorySize: 512\n"], [1080, "      Environment:\n"], [1081, "        Variables:\n"], [1082, "          METRIC_NAMESPACE:\n"], [1083, "            Ref: StackName\n"], [1084, "          CONFIGURATION_TABLE_NAME:\n"], [1085, "            Ref: ConfigurationTable\n"], [1086, "          GUARDRAIL_ID_AND_VERSION:\n"], [1087, "            Fn::If:\n"], [1088, "            - HasGuardrailConfig\n"], [1089, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1090, "            - ''\n"], [1091, "          LOG_LEVEL:\n"], [1092, "            Ref: LogLevel\n"], [1093, "          APPSYNC_API_URL:\n"], [1094, "            Ref: AppSyncApiUrl\n"], [1095, "          WORKING_BUCKET:\n"], [1096, "            Ref: WorkingBucket\n"], [1097, "      LoggingConfig:\n"], [1098, "        LogGroup:\n"], [1099, "          Ref: ExtractionFunctionLogGroup\n"], [1100, "      Policies:\n"], [1101, "      - AWSLambdaBasicExecutionRole\n"], [1102, "      - S3CrudPolicy:\n"], [1103, "          BucketName:\n"], [1104, "            Ref: OutputBucket\n"], [1105, "      - S3CrudPolicy:\n"], [1106, "          BucketName:\n"], [1107, "            Ref: WorkingBucket\n"], [1108, "      - S3ReadPolicy:\n"], [1109, "          BucketName:\n"], [1110, "            Ref: InputBucket\n"], [1111, "      - S3ReadPolicy:\n"], [1112, "          BucketName:\n"], [1113, "            Ref: ConfigurationBucket\n"], [1114, "      - DynamoDBCrudPolicy:\n"], [1115, "          TableName:\n"], [1116, "            Ref: ConfigurationTable\n"], [1117, "      - Statement:\n"], [1118, "        - Effect: Allow\n"], [1119, "          Action: cloudwatch:PutMetricData\n"], [1120, "          Resource: '*'\n"], [1121, "        - Effect: Allow\n"], [1122, "          Action:\n"], [1123, "          - kms:Encrypt\n"], [1124, "          - kms:Decrypt\n"], [1125, "          - kms:ReEncrypt*\n"], [1126, "          - kms:GenerateDataKey*\n"], [1127, "          - kms:DescribeKey\n"], [1128, "          Resource:\n"], [1129, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1130, "        - Effect: Allow\n"], [1131, "          Action: bedrock:InvokeModel\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1134, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1135, "        - Effect: Allow\n"], [1136, "          Action:\n"], [1137, "          - appsync:GraphQL\n"], [1138, "          Resource:\n"], [1139, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1140, "        - Fn::If:\n"], [1141, "          - HasGuardrailConfig\n"], [1142, "          - Effect: Allow\n"], [1143, "            Action: bedrock:ApplyGuardrail\n"], [1144, "            Resource:\n"], [1145, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1146, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1055, 1146], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1055, "  ExtractionFunction:\n"], [1056, "    Type: AWS::Serverless::Function\n"], [1057, "    Metadata:\n"], [1058, "      SamResourceId: ExtractionFunction\n"], [1059, "      cfn_nag:\n"], [1060, "        rules_to_suppress:\n"], [1061, "        - id: W11\n"], [1062, "          reason: Cloudwatch does not support resource-level permissions\n"], [1063, "        - id: W89\n"], [1064, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1065, "            with AWS services via AWS APIs\n"], [1066, "        - id: W92\n"], [1067, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1068, "            to scale based on demand\n"], [1069, "    Properties:\n"], [1070, "      PermissionsBoundary:\n"], [1071, "        Fn::If:\n"], [1072, "        - HasPermissionsBoundary\n"], [1073, "        - Ref: PermissionsBoundaryArn\n"], [1074, "        - Ref: AWS::NoValue\n"], [1075, "      CodeUri: ExtractionFunction\n"], [1076, "      Handler: index.handler\n"], [1077, "      Runtime: python3.12\n"], [1078, "      Timeout: 900\n"], [1079, "      MemorySize: 512\n"], [1080, "      Environment:\n"], [1081, "        Variables:\n"], [1082, "          METRIC_NAMESPACE:\n"], [1083, "            Ref: StackName\n"], [1084, "          CONFIGURATION_TABLE_NAME:\n"], [1085, "            Ref: ConfigurationTable\n"], [1086, "          GUARDRAIL_ID_AND_VERSION:\n"], [1087, "            Fn::If:\n"], [1088, "            - HasGuardrailConfig\n"], [1089, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1090, "            - ''\n"], [1091, "          LOG_LEVEL:\n"], [1092, "            Ref: LogLevel\n"], [1093, "          APPSYNC_API_URL:\n"], [1094, "            Ref: AppSyncApiUrl\n"], [1095, "          WORKING_BUCKET:\n"], [1096, "            Ref: WorkingBucket\n"], [1097, "      LoggingConfig:\n"], [1098, "        LogGroup:\n"], [1099, "          Ref: ExtractionFunctionLogGroup\n"], [1100, "      Policies:\n"], [1101, "      - AWSLambdaBasicExecutionRole\n"], [1102, "      - S3CrudPolicy:\n"], [1103, "          BucketName:\n"], [1104, "            Ref: OutputBucket\n"], [1105, "      - S3CrudPolicy:\n"], [1106, "          BucketName:\n"], [1107, "            Ref: WorkingBucket\n"], [1108, "      - S3ReadPolicy:\n"], [1109, "          BucketName:\n"], [1110, "            Ref: InputBucket\n"], [1111, "      - S3ReadPolicy:\n"], [1112, "          BucketName:\n"], [1113, "            Ref: ConfigurationBucket\n"], [1114, "      - DynamoDBCrudPolicy:\n"], [1115, "          TableName:\n"], [1116, "            Ref: ConfigurationTable\n"], [1117, "      - Statement:\n"], [1118, "        - Effect: Allow\n"], [1119, "          Action: cloudwatch:PutMetricData\n"], [1120, "          Resource: '*'\n"], [1121, "        - Effect: Allow\n"], [1122, "          Action:\n"], [1123, "          - kms:Encrypt\n"], [1124, "          - kms:Decrypt\n"], [1125, "          - kms:ReEncrypt*\n"], [1126, "          - kms:GenerateDataKey*\n"], [1127, "          - kms:DescribeKey\n"], [1128, "          Resource:\n"], [1129, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1130, "        - Effect: Allow\n"], [1131, "          Action: bedrock:InvokeModel\n"], [1132, "          Resource:\n"], [1133, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1134, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1135, "        - Effect: Allow\n"], [1136, "          Action:\n"], [1137, "          - appsync:GraphQL\n"], [1138, "          Resource:\n"], [1139, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1140, "        - Fn::If:\n"], [1141, "          - HasGuardrailConfig\n"], [1142, "          - Effect: Allow\n"], [1143, "            Action: bedrock:ApplyGuardrail\n"], [1144, "            Resource:\n"], [1145, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1146, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1055, 1146], "resource": "AWS::Serverless::Function.ExtractionFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1156, "  AssessmentFunction:\n"], [1157, "    Type: AWS::Serverless::Function\n"], [1158, "    Metadata:\n"], [1159, "      SamResourceId: AssessmentFunction\n"], [1160, "      cfn_nag:\n"], [1161, "        rules_to_suppress:\n"], [1162, "        - id: W89\n"], [1163, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1164, "            with AWS services via AWS APIs\n"], [1165, "        - id: W92\n"], [1166, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1167, "            to scale based on demand\n"], [1168, "        - id: W11\n"], [1169, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1170, "            should support any enabled Bedrock model_id or inference profile\n"], [1171, "    Properties:\n"], [1172, "      PermissionsBoundary:\n"], [1173, "        Fn::If:\n"], [1174, "        - HasPermissionsBoundary\n"], [1175, "        - Ref: PermissionsBoundaryArn\n"], [1176, "        - Ref: AWS::NoValue\n"], [1177, "      CodeUri: AssessmentFunction\n"], [1178, "      Handler: index.handler\n"], [1179, "      Runtime: python3.12\n"], [1180, "      Timeout: 900\n"], [1181, "      MemorySize: 512\n"], [1182, "      Environment:\n"], [1183, "        Variables:\n"], [1184, "          METRIC_NAMESPACE:\n"], [1185, "            Ref: StackName\n"], [1186, "          CONFIGURATION_BUCKET:\n"], [1187, "            Ref: ConfigurationBucket\n"], [1188, "          CONFIGURATION_TABLE_NAME:\n"], [1189, "            Ref: ConfigurationTable\n"], [1190, "          LOG_LEVEL:\n"], [1191, "            Ref: LogLevel\n"], [1192, "          APPSYNC_API_URL:\n"], [1193, "            Ref: AppSyncApiUrl\n"], [1194, "          WORKING_BUCKET:\n"], [1195, "            Ref: WorkingBucket\n"], [1196, "      LoggingConfig:\n"], [1197, "        LogGroup:\n"], [1198, "          Ref: AssessmentFunctionLogGroup\n"], [1199, "      Policies:\n"], [1200, "      - AWSLambdaBasicExecutionRole\n"], [1201, "      - S3CrudPolicy:\n"], [1202, "          BucketName:\n"], [1203, "            Ref: OutputBucket\n"], [1204, "      - S3CrudPolicy:\n"], [1205, "          BucketName:\n"], [1206, "            Ref: WorkingBucket\n"], [1207, "      - S3ReadPolicy:\n"], [1208, "          BucketName:\n"], [1209, "            Ref: InputBucket\n"], [1210, "      - S3ReadPolicy:\n"], [1211, "          BucketName:\n"], [1212, "            Ref: ConfigurationBucket\n"], [1213, "      - DynamoDBCrudPolicy:\n"], [1214, "          TableName:\n"], [1215, "            Ref: ConfigurationTable\n"], [1216, "      - Statement:\n"], [1217, "        - Effect: Allow\n"], [1218, "          Action: cloudwatch:PutMetricData\n"], [1219, "          Resource: '*'\n"], [1220, "        - Effect: Allow\n"], [1221, "          Action:\n"], [1222, "          - kms:Encrypt\n"], [1223, "          - kms:Decrypt\n"], [1224, "          - kms:ReEncrypt*\n"], [1225, "          - kms:GenerateDataKey*\n"], [1226, "          - kms:DescribeKey\n"], [1227, "          Resource:\n"], [1228, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1229, "        - Effect: Allow\n"], [1230, "          Action:\n"], [1231, "          - appsync:GraphQL\n"], [1232, "          Resource:\n"], [1233, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1234, "        - Effect: Allow\n"], [1235, "          Action: bedrock:InvokeModel\n"], [1236, "          Resource:\n"], [1237, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1238, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1239, "        - Fn::If:\n"], [1240, "          - HasGuardrailConfig\n"], [1241, "          - Effect: Allow\n"], [1242, "            Action: bedrock:ApplyGuardrail\n"], [1243, "            Resource:\n"], [1244, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1245, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1156, 1245], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1156, "  AssessmentFunction:\n"], [1157, "    Type: AWS::Serverless::Function\n"], [1158, "    Metadata:\n"], [1159, "      SamResourceId: AssessmentFunction\n"], [1160, "      cfn_nag:\n"], [1161, "        rules_to_suppress:\n"], [1162, "        - id: W89\n"], [1163, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1164, "            with AWS services via AWS APIs\n"], [1165, "        - id: W92\n"], [1166, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1167, "            to scale based on demand\n"], [1168, "        - id: W11\n"], [1169, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1170, "            should support any enabled Bedrock model_id or inference profile\n"], [1171, "    Properties:\n"], [1172, "      PermissionsBoundary:\n"], [1173, "        Fn::If:\n"], [1174, "        - HasPermissionsBoundary\n"], [1175, "        - Ref: PermissionsBoundaryArn\n"], [1176, "        - Ref: AWS::NoValue\n"], [1177, "      CodeUri: AssessmentFunction\n"], [1178, "      Handler: index.handler\n"], [1179, "      Runtime: python3.12\n"], [1180, "      Timeout: 900\n"], [1181, "      MemorySize: 512\n"], [1182, "      Environment:\n"], [1183, "        Variables:\n"], [1184, "          METRIC_NAMESPACE:\n"], [1185, "            Ref: StackName\n"], [1186, "          CONFIGURATION_BUCKET:\n"], [1187, "            Ref: ConfigurationBucket\n"], [1188, "          CONFIGURATION_TABLE_NAME:\n"], [1189, "            Ref: ConfigurationTable\n"], [1190, "          LOG_LEVEL:\n"], [1191, "            Ref: LogLevel\n"], [1192, "          APPSYNC_API_URL:\n"], [1193, "            Ref: AppSyncApiUrl\n"], [1194, "          WORKING_BUCKET:\n"], [1195, "            Ref: WorkingBucket\n"], [1196, "      LoggingConfig:\n"], [1197, "        LogGroup:\n"], [1198, "          Ref: AssessmentFunctionLogGroup\n"], [1199, "      Policies:\n"], [1200, "      - AWSLambdaBasicExecutionRole\n"], [1201, "      - S3CrudPolicy:\n"], [1202, "          BucketName:\n"], [1203, "            Ref: OutputBucket\n"], [1204, "      - S3CrudPolicy:\n"], [1205, "          BucketName:\n"], [1206, "            Ref: WorkingBucket\n"], [1207, "      - S3ReadPolicy:\n"], [1208, "          BucketName:\n"], [1209, "            Ref: InputBucket\n"], [1210, "      - S3ReadPolicy:\n"], [1211, "          BucketName:\n"], [1212, "            Ref: ConfigurationBucket\n"], [1213, "      - DynamoDBCrudPolicy:\n"], [1214, "          TableName:\n"], [1215, "            Ref: ConfigurationTable\n"], [1216, "      - Statement:\n"], [1217, "        - Effect: Allow\n"], [1218, "          Action: cloudwatch:PutMetricData\n"], [1219, "          Resource: '*'\n"], [1220, "        - Effect: Allow\n"], [1221, "          Action:\n"], [1222, "          - kms:Encrypt\n"], [1223, "          - kms:Decrypt\n"], [1224, "          - kms:ReEncrypt*\n"], [1225, "          - kms:GenerateDataKey*\n"], [1226, "          - kms:DescribeKey\n"], [1227, "          Resource:\n"], [1228, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1229, "        - Effect: Allow\n"], [1230, "          Action:\n"], [1231, "          - appsync:GraphQL\n"], [1232, "          Resource:\n"], [1233, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1234, "        - Effect: Allow\n"], [1235, "          Action: bedrock:InvokeModel\n"], [1236, "          Resource:\n"], [1237, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1238, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1239, "        - Fn::If:\n"], [1240, "          - HasGuardrailConfig\n"], [1241, "          - Effect: Allow\n"], [1242, "            Action: bedrock:ApplyGuardrail\n"], [1243, "            Resource:\n"], [1244, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1245, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1156, 1245], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1156, "  AssessmentFunction:\n"], [1157, "    Type: AWS::Serverless::Function\n"], [1158, "    Metadata:\n"], [1159, "      SamResourceId: AssessmentFunction\n"], [1160, "      cfn_nag:\n"], [1161, "        rules_to_suppress:\n"], [1162, "        - id: W89\n"], [1163, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1164, "            with AWS services via AWS APIs\n"], [1165, "        - id: W92\n"], [1166, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1167, "            to scale based on demand\n"], [1168, "        - id: W11\n"], [1169, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1170, "            should support any enabled Bedrock model_id or inference profile\n"], [1171, "    Properties:\n"], [1172, "      PermissionsBoundary:\n"], [1173, "        Fn::If:\n"], [1174, "        - HasPermissionsBoundary\n"], [1175, "        - Ref: PermissionsBoundaryArn\n"], [1176, "        - Ref: AWS::NoValue\n"], [1177, "      CodeUri: AssessmentFunction\n"], [1178, "      Handler: index.handler\n"], [1179, "      Runtime: python3.12\n"], [1180, "      Timeout: 900\n"], [1181, "      MemorySize: 512\n"], [1182, "      Environment:\n"], [1183, "        Variables:\n"], [1184, "          METRIC_NAMESPACE:\n"], [1185, "            Ref: StackName\n"], [1186, "          CONFIGURATION_BUCKET:\n"], [1187, "            Ref: ConfigurationBucket\n"], [1188, "          CONFIGURATION_TABLE_NAME:\n"], [1189, "            Ref: ConfigurationTable\n"], [1190, "          LOG_LEVEL:\n"], [1191, "            Ref: LogLevel\n"], [1192, "          APPSYNC_API_URL:\n"], [1193, "            Ref: AppSyncApiUrl\n"], [1194, "          WORKING_BUCKET:\n"], [1195, "            Ref: WorkingBucket\n"], [1196, "      LoggingConfig:\n"], [1197, "        LogGroup:\n"], [1198, "          Ref: AssessmentFunctionLogGroup\n"], [1199, "      Policies:\n"], [1200, "      - AWSLambdaBasicExecutionRole\n"], [1201, "      - S3CrudPolicy:\n"], [1202, "          BucketName:\n"], [1203, "            Ref: OutputBucket\n"], [1204, "      - S3CrudPolicy:\n"], [1205, "          BucketName:\n"], [1206, "            Ref: WorkingBucket\n"], [1207, "      - S3ReadPolicy:\n"], [1208, "          BucketName:\n"], [1209, "            Ref: InputBucket\n"], [1210, "      - S3ReadPolicy:\n"], [1211, "          BucketName:\n"], [1212, "            Ref: ConfigurationBucket\n"], [1213, "      - DynamoDBCrudPolicy:\n"], [1214, "          TableName:\n"], [1215, "            Ref: ConfigurationTable\n"], [1216, "      - Statement:\n"], [1217, "        - Effect: Allow\n"], [1218, "          Action: cloudwatch:PutMetricData\n"], [1219, "          Resource: '*'\n"], [1220, "        - Effect: Allow\n"], [1221, "          Action:\n"], [1222, "          - kms:Encrypt\n"], [1223, "          - kms:Decrypt\n"], [1224, "          - kms:ReEncrypt*\n"], [1225, "          - kms:GenerateDataKey*\n"], [1226, "          - kms:DescribeKey\n"], [1227, "          Resource:\n"], [1228, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1229, "        - Effect: Allow\n"], [1230, "          Action:\n"], [1231, "          - appsync:GraphQL\n"], [1232, "          Resource:\n"], [1233, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1234, "        - Effect: Allow\n"], [1235, "          Action: bedrock:InvokeModel\n"], [1236, "          Resource:\n"], [1237, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1238, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1239, "        - Fn::If:\n"], [1240, "          - HasGuardrailConfig\n"], [1241, "          - Effect: Allow\n"], [1242, "            Action: bedrock:ApplyGuardrail\n"], [1243, "            Resource:\n"], [1244, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1245, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1156, 1245], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1156, "  AssessmentFunction:\n"], [1157, "    Type: AWS::Serverless::Function\n"], [1158, "    Metadata:\n"], [1159, "      SamResourceId: AssessmentFunction\n"], [1160, "      cfn_nag:\n"], [1161, "        rules_to_suppress:\n"], [1162, "        - id: W89\n"], [1163, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1164, "            with AWS services via AWS APIs\n"], [1165, "        - id: W92\n"], [1166, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1167, "            to scale based on demand\n"], [1168, "        - id: W11\n"], [1169, "          reason: Cloudwatch does not support resource-level permissions, and Bedrock\n"], [1170, "            should support any enabled Bedrock model_id or inference profile\n"], [1171, "    Properties:\n"], [1172, "      PermissionsBoundary:\n"], [1173, "        Fn::If:\n"], [1174, "        - HasPermissionsBoundary\n"], [1175, "        - Ref: PermissionsBoundaryArn\n"], [1176, "        - Ref: AWS::NoValue\n"], [1177, "      CodeUri: AssessmentFunction\n"], [1178, "      Handler: index.handler\n"], [1179, "      Runtime: python3.12\n"], [1180, "      Timeout: 900\n"], [1181, "      MemorySize: 512\n"], [1182, "      Environment:\n"], [1183, "        Variables:\n"], [1184, "          METRIC_NAMESPACE:\n"], [1185, "            Ref: StackName\n"], [1186, "          CONFIGURATION_BUCKET:\n"], [1187, "            Ref: ConfigurationBucket\n"], [1188, "          CONFIGURATION_TABLE_NAME:\n"], [1189, "            Ref: ConfigurationTable\n"], [1190, "          LOG_LEVEL:\n"], [1191, "            Ref: LogLevel\n"], [1192, "          APPSYNC_API_URL:\n"], [1193, "            Ref: AppSyncApiUrl\n"], [1194, "          WORKING_BUCKET:\n"], [1195, "            Ref: WorkingBucket\n"], [1196, "      LoggingConfig:\n"], [1197, "        LogGroup:\n"], [1198, "          Ref: AssessmentFunctionLogGroup\n"], [1199, "      Policies:\n"], [1200, "      - AWSLambdaBasicExecutionRole\n"], [1201, "      - S3CrudPolicy:\n"], [1202, "          BucketName:\n"], [1203, "            Ref: OutputBucket\n"], [1204, "      - S3CrudPolicy:\n"], [1205, "          BucketName:\n"], [1206, "            Ref: WorkingBucket\n"], [1207, "      - S3ReadPolicy:\n"], [1208, "          BucketName:\n"], [1209, "            Ref: InputBucket\n"], [1210, "      - S3ReadPolicy:\n"], [1211, "          BucketName:\n"], [1212, "            Ref: ConfigurationBucket\n"], [1213, "      - DynamoDBCrudPolicy:\n"], [1214, "          TableName:\n"], [1215, "            Ref: ConfigurationTable\n"], [1216, "      - Statement:\n"], [1217, "        - Effect: Allow\n"], [1218, "          Action: cloudwatch:PutMetricData\n"], [1219, "          Resource: '*'\n"], [1220, "        - Effect: Allow\n"], [1221, "          Action:\n"], [1222, "          - kms:Encrypt\n"], [1223, "          - kms:Decrypt\n"], [1224, "          - kms:ReEncrypt*\n"], [1225, "          - kms:GenerateDataKey*\n"], [1226, "          - kms:DescribeKey\n"], [1227, "          Resource:\n"], [1228, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1229, "        - Effect: Allow\n"], [1230, "          Action:\n"], [1231, "          - appsync:GraphQL\n"], [1232, "          Resource:\n"], [1233, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1234, "        - Effect: Allow\n"], [1235, "          Action: bedrock:InvokeModel\n"], [1236, "          Resource:\n"], [1237, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1238, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1239, "        - Fn::If:\n"], [1240, "          - HasGuardrailConfig\n"], [1241, "          - Effect: Allow\n"], [1242, "            Action: bedrock:ApplyGuardrail\n"], [1243, "            Resource:\n"], [1244, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1245, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1156, 1245], "resource": "AWS::Serverless::Function.AssessmentFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1255, "  ProcessResultsFunction:\n"], [1256, "    Type: AWS::Serverless::Function\n"], [1257, "    Metadata:\n"], [1258, "      SamResourceId: ProcessResultsFunction\n"], [1259, "      cfn_nag:\n"], [1260, "        rules_to_suppress:\n"], [1261, "        - id: W11\n"], [1262, "          reason: Cloudwatch does not support resource-level permissions\n"], [1263, "        - id: W89\n"], [1264, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1265, "            with AWS services via AWS APIs\n"], [1266, "        - id: W92\n"], [1267, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1268, "            to scale based on demand\n"], [1269, "    Properties:\n"], [1270, "      PermissionsBoundary:\n"], [1271, "        Fn::If:\n"], [1272, "        - HasPermissionsBoundary\n"], [1273, "        - Ref: PermissionsBoundaryArn\n"], [1274, "        - Ref: AWS::NoValue\n"], [1275, "      CodeUri: ProcessResultsFunction\n"], [1276, "      Handler: index.handler\n"], [1277, "      Runtime: python3.12\n"], [1278, "      Timeout: 900\n"], [1279, "      MemorySize: 4096\n"], [1280, "      Environment:\n"], [1281, "        Variables:\n"], [1282, "          METRIC_NAMESPACE:\n"], [1283, "            Ref: StackName\n"], [1284, "          LOG_LEVEL:\n"], [1285, "            Ref: LogLevel\n"], [1286, "          APPSYNC_API_URL:\n"], [1287, "            Ref: AppSyncApiUrl\n"], [1288, "          WORKING_BUCKET:\n"], [1289, "            Ref: WorkingBucket\n"], [1290, "      LoggingConfig:\n"], [1291, "        LogGroup:\n"], [1292, "          Ref: ProcessResultsFunctionLogGroup\n"], [1293, "      Policies:\n"], [1294, "      - AWSLambdaBasicExecutionRole\n"], [1295, "      - S3ReadPolicy:\n"], [1296, "          BucketName:\n"], [1297, "            Ref: InputBucket\n"], [1298, "      - S3CrudPolicy:\n"], [1299, "          BucketName:\n"], [1300, "            Ref: OutputBucket\n"], [1301, "      - S3CrudPolicy:\n"], [1302, "          BucketName:\n"], [1303, "            Ref: WorkingBucket\n"], [1304, "      - Statement:\n"], [1305, "        - Effect: Allow\n"], [1306, "          Action: cloudwatch:PutMetricData\n"], [1307, "          Resource: '*'\n"], [1308, "        - Effect: Allow\n"], [1309, "          Action:\n"], [1310, "          - kms:Encrypt\n"], [1311, "          - kms:Decrypt\n"], [1312, "          - kms:ReEncrypt*\n"], [1313, "          - kms:GenerateDataKey*\n"], [1314, "          - kms:DescribeKey\n"], [1315, "          Resource:\n"], [1316, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1317, "        - Effect: Allow\n"], [1318, "          Action:\n"], [1319, "          - appsync:GraphQL\n"], [1320, "          Resource:\n"], [1321, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1255, 1321], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1255, "  ProcessResultsFunction:\n"], [1256, "    Type: AWS::Serverless::Function\n"], [1257, "    Metadata:\n"], [1258, "      SamResourceId: ProcessResultsFunction\n"], [1259, "      cfn_nag:\n"], [1260, "        rules_to_suppress:\n"], [1261, "        - id: W11\n"], [1262, "          reason: Cloudwatch does not support resource-level permissions\n"], [1263, "        - id: W89\n"], [1264, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1265, "            with AWS services via AWS APIs\n"], [1266, "        - id: W92\n"], [1267, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1268, "            to scale based on demand\n"], [1269, "    Properties:\n"], [1270, "      PermissionsBoundary:\n"], [1271, "        Fn::If:\n"], [1272, "        - HasPermissionsBoundary\n"], [1273, "        - Ref: PermissionsBoundaryArn\n"], [1274, "        - Ref: AWS::NoValue\n"], [1275, "      CodeUri: ProcessResultsFunction\n"], [1276, "      Handler: index.handler\n"], [1277, "      Runtime: python3.12\n"], [1278, "      Timeout: 900\n"], [1279, "      MemorySize: 4096\n"], [1280, "      Environment:\n"], [1281, "        Variables:\n"], [1282, "          METRIC_NAMESPACE:\n"], [1283, "            Ref: StackName\n"], [1284, "          LOG_LEVEL:\n"], [1285, "            Ref: LogLevel\n"], [1286, "          APPSYNC_API_URL:\n"], [1287, "            Ref: AppSyncApiUrl\n"], [1288, "          WORKING_BUCKET:\n"], [1289, "            Ref: WorkingBucket\n"], [1290, "      LoggingConfig:\n"], [1291, "        LogGroup:\n"], [1292, "          Ref: ProcessResultsFunctionLogGroup\n"], [1293, "      Policies:\n"], [1294, "      - AWSLambdaBasicExecutionRole\n"], [1295, "      - S3ReadPolicy:\n"], [1296, "          BucketName:\n"], [1297, "            Ref: InputBucket\n"], [1298, "      - S3CrudPolicy:\n"], [1299, "          BucketName:\n"], [1300, "            Ref: OutputBucket\n"], [1301, "      - S3CrudPolicy:\n"], [1302, "          BucketName:\n"], [1303, "            Ref: WorkingBucket\n"], [1304, "      - Statement:\n"], [1305, "        - Effect: Allow\n"], [1306, "          Action: cloudwatch:PutMetricData\n"], [1307, "          Resource: '*'\n"], [1308, "        - Effect: Allow\n"], [1309, "          Action:\n"], [1310, "          - kms:Encrypt\n"], [1311, "          - kms:Decrypt\n"], [1312, "          - kms:ReEncrypt*\n"], [1313, "          - kms:GenerateDataKey*\n"], [1314, "          - kms:DescribeKey\n"], [1315, "          Resource:\n"], [1316, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1317, "        - Effect: Allow\n"], [1318, "          Action:\n"], [1319, "          - appsync:GraphQL\n"], [1320, "          Resource:\n"], [1321, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1255, 1321], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1255, "  ProcessResultsFunction:\n"], [1256, "    Type: AWS::Serverless::Function\n"], [1257, "    Metadata:\n"], [1258, "      SamResourceId: ProcessResultsFunction\n"], [1259, "      cfn_nag:\n"], [1260, "        rules_to_suppress:\n"], [1261, "        - id: W11\n"], [1262, "          reason: Cloudwatch does not support resource-level permissions\n"], [1263, "        - id: W89\n"], [1264, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1265, "            with AWS services via AWS APIs\n"], [1266, "        - id: W92\n"], [1267, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1268, "            to scale based on demand\n"], [1269, "    Properties:\n"], [1270, "      PermissionsBoundary:\n"], [1271, "        Fn::If:\n"], [1272, "        - HasPermissionsBoundary\n"], [1273, "        - Ref: PermissionsBoundaryArn\n"], [1274, "        - Ref: AWS::NoValue\n"], [1275, "      CodeUri: ProcessResultsFunction\n"], [1276, "      Handler: index.handler\n"], [1277, "      Runtime: python3.12\n"], [1278, "      Timeout: 900\n"], [1279, "      MemorySize: 4096\n"], [1280, "      Environment:\n"], [1281, "        Variables:\n"], [1282, "          METRIC_NAMESPACE:\n"], [1283, "            Ref: StackName\n"], [1284, "          LOG_LEVEL:\n"], [1285, "            Ref: LogLevel\n"], [1286, "          APPSYNC_API_URL:\n"], [1287, "            Ref: AppSyncApiUrl\n"], [1288, "          WORKING_BUCKET:\n"], [1289, "            Ref: WorkingBucket\n"], [1290, "      LoggingConfig:\n"], [1291, "        LogGroup:\n"], [1292, "          Ref: ProcessResultsFunctionLogGroup\n"], [1293, "      Policies:\n"], [1294, "      - AWSLambdaBasicExecutionRole\n"], [1295, "      - S3ReadPolicy:\n"], [1296, "          BucketName:\n"], [1297, "            Ref: InputBucket\n"], [1298, "      - S3CrudPolicy:\n"], [1299, "          BucketName:\n"], [1300, "            Ref: OutputBucket\n"], [1301, "      - S3CrudPolicy:\n"], [1302, "          BucketName:\n"], [1303, "            Ref: WorkingBucket\n"], [1304, "      - Statement:\n"], [1305, "        - Effect: Allow\n"], [1306, "          Action: cloudwatch:PutMetricData\n"], [1307, "          Resource: '*'\n"], [1308, "        - Effect: Allow\n"], [1309, "          Action:\n"], [1310, "          - kms:Encrypt\n"], [1311, "          - kms:Decrypt\n"], [1312, "          - kms:ReEncrypt*\n"], [1313, "          - kms:GenerateDataKey*\n"], [1314, "          - kms:DescribeKey\n"], [1315, "          Resource:\n"], [1316, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1317, "        - Effect: Allow\n"], [1318, "          Action:\n"], [1319, "          - appsync:GraphQL\n"], [1320, "          Resource:\n"], [1321, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1255, 1321], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1255, "  ProcessResultsFunction:\n"], [1256, "    Type: AWS::Serverless::Function\n"], [1257, "    Metadata:\n"], [1258, "      SamResourceId: ProcessResultsFunction\n"], [1259, "      cfn_nag:\n"], [1260, "        rules_to_suppress:\n"], [1261, "        - id: W11\n"], [1262, "          reason: Cloudwatch does not support resource-level permissions\n"], [1263, "        - id: W89\n"], [1264, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1265, "            with AWS services via AWS APIs\n"], [1266, "        - id: W92\n"], [1267, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1268, "            to scale based on demand\n"], [1269, "    Properties:\n"], [1270, "      PermissionsBoundary:\n"], [1271, "        Fn::If:\n"], [1272, "        - HasPermissionsBoundary\n"], [1273, "        - Ref: PermissionsBoundaryArn\n"], [1274, "        - Ref: AWS::NoValue\n"], [1275, "      CodeUri: ProcessResultsFunction\n"], [1276, "      Handler: index.handler\n"], [1277, "      Runtime: python3.12\n"], [1278, "      Timeout: 900\n"], [1279, "      MemorySize: 4096\n"], [1280, "      Environment:\n"], [1281, "        Variables:\n"], [1282, "          METRIC_NAMESPACE:\n"], [1283, "            Ref: StackName\n"], [1284, "          LOG_LEVEL:\n"], [1285, "            Ref: LogLevel\n"], [1286, "          APPSYNC_API_URL:\n"], [1287, "            Ref: AppSyncApiUrl\n"], [1288, "          WORKING_BUCKET:\n"], [1289, "            Ref: WorkingBucket\n"], [1290, "      LoggingConfig:\n"], [1291, "        LogGroup:\n"], [1292, "          Ref: ProcessResultsFunctionLogGroup\n"], [1293, "      Policies:\n"], [1294, "      - AWSLambdaBasicExecutionRole\n"], [1295, "      - S3ReadPolicy:\n"], [1296, "          BucketName:\n"], [1297, "            Ref: InputBucket\n"], [1298, "      - S3CrudPolicy:\n"], [1299, "          BucketName:\n"], [1300, "            Ref: OutputBucket\n"], [1301, "      - S3CrudPolicy:\n"], [1302, "          BucketName:\n"], [1303, "            Ref: WorkingBucket\n"], [1304, "      - Statement:\n"], [1305, "        - Effect: Allow\n"], [1306, "          Action: cloudwatch:PutMetricData\n"], [1307, "          Resource: '*'\n"], [1308, "        - Effect: Allow\n"], [1309, "          Action:\n"], [1310, "          - kms:Encrypt\n"], [1311, "          - kms:Decrypt\n"], [1312, "          - kms:ReEncrypt*\n"], [1313, "          - kms:GenerateDataKey*\n"], [1314, "          - kms:DescribeKey\n"], [1315, "          Resource:\n"], [1316, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1317, "        - Effect: Allow\n"], [1318, "          Action:\n"], [1319, "          - appsync:GraphQL\n"], [1320, "          Resource:\n"], [1321, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1255, 1321], "resource": "AWS::Serverless::Function.ProcessResultsFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/DeadLetterQueue/TargetArn"]}, "code_block": [[1331, "  SummarizationFunction:\n"], [1332, "    Type: AWS::Serverless::Function\n"], [1333, "    Metadata:\n"], [1334, "      SamResourceId: SummarizationFunction\n"], [1335, "      cfn_nag:\n"], [1336, "        rules_to_suppress:\n"], [1337, "        - id: W11\n"], [1338, "          reason: Cloudwatch does not support resource-level permissions\n"], [1339, "        - id: W89\n"], [1340, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1341, "            with AWS services via AWS APIs\n"], [1342, "        - id: W92\n"], [1343, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1344, "            to scale based on demand\n"], [1345, "    Properties:\n"], [1346, "      PermissionsBoundary:\n"], [1347, "        Fn::If:\n"], [1348, "        - HasPermissionsBoundary\n"], [1349, "        - Ref: PermissionsBoundaryArn\n"], [1350, "        - Ref: AWS::NoValue\n"], [1351, "      CodeUri: SummarizationFunction\n"], [1352, "      Handler: index.handler\n"], [1353, "      Runtime: python3.12\n"], [1354, "      Timeout: 900\n"], [1355, "      MemorySize: 4096\n"], [1356, "      Environment:\n"], [1357, "        Variables:\n"], [1358, "          METRIC_NAMESPACE:\n"], [1359, "            Ref: StackName\n"], [1360, "          CONFIGURATION_TABLE_NAME:\n"], [1361, "            Ref: ConfigurationTable\n"], [1362, "          GUARDRAIL_ID_AND_VERSION:\n"], [1363, "            Fn::If:\n"], [1364, "            - HasGuardrailConfig\n"], [1365, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1366, "            - ''\n"], [1367, "          LOG_LEVEL:\n"], [1368, "            Ref: LogLevel\n"], [1369, "          APPSYNC_API_URL:\n"], [1370, "            Ref: AppSyncApiUrl\n"], [1371, "          WORKING_BUCKET:\n"], [1372, "            Ref: WorkingBucket\n"], [1373, "      LoggingConfig:\n"], [1374, "        LogGroup:\n"], [1375, "          Ref: SummarizationFunctionLogGroup\n"], [1376, "      Policies:\n"], [1377, "      - AWSLambdaBasicExecutionRole\n"], [1378, "      - S3ReadPolicy:\n"], [1379, "          BucketName:\n"], [1380, "            Ref: InputBucket\n"], [1381, "      - S3CrudPolicy:\n"], [1382, "          BucketName:\n"], [1383, "            Ref: OutputBucket\n"], [1384, "      - S3CrudPolicy:\n"], [1385, "          BucketName:\n"], [1386, "            Ref: WorkingBucket\n"], [1387, "      - DynamoDBCrudPolicy:\n"], [1388, "          TableName:\n"], [1389, "            Ref: ConfigurationTable\n"], [1390, "      - Statement:\n"], [1391, "        - Effect: Allow\n"], [1392, "          Action: cloudwatch:PutMetricData\n"], [1393, "          Resource: '*'\n"], [1394, "        - Effect: Allow\n"], [1395, "          Action:\n"], [1396, "          - kms:Encrypt\n"], [1397, "          - kms:Decrypt\n"], [1398, "          - kms:ReEncrypt*\n"], [1399, "          - kms:GenerateDataKey*\n"], [1400, "          - kms:DescribeKey\n"], [1401, "          Resource:\n"], [1402, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1403, "        - Effect: Allow\n"], [1404, "          Action: bedrock:InvokeModel\n"], [1405, "          Resource:\n"], [1406, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1407, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1408, "        - Effect: Allow\n"], [1409, "          Action:\n"], [1410, "          - appsync:GraphQL\n"], [1411, "          Resource:\n"], [1412, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1413, "        - Fn::If:\n"], [1414, "          - HasGuardrailConfig\n"], [1415, "          - Effect: Allow\n"], [1416, "            Action: bedrock:ApplyGuardrail\n"], [1417, "            Resource:\n"], [1418, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1419, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1331, 1419], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_173", "bc_check_id": "BC_AWS_SERVERLESS_5", "check_name": "Check encryption settings for Lambda environment variable", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/KmsKeyArn"]}, "code_block": [[1331, "  SummarizationFunction:\n"], [1332, "    Type: AWS::Serverless::Function\n"], [1333, "    Metadata:\n"], [1334, "      SamResourceId: SummarizationFunction\n"], [1335, "      cfn_nag:\n"], [1336, "        rules_to_suppress:\n"], [1337, "        - id: W11\n"], [1338, "          reason: Cloudwatch does not support resource-level permissions\n"], [1339, "        - id: W89\n"], [1340, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1341, "            with AWS services via AWS APIs\n"], [1342, "        - id: W92\n"], [1343, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1344, "            to scale based on demand\n"], [1345, "    Properties:\n"], [1346, "      PermissionsBoundary:\n"], [1347, "        Fn::If:\n"], [1348, "        - HasPermissionsBoundary\n"], [1349, "        - Ref: PermissionsBoundaryArn\n"], [1350, "        - Ref: AWS::NoValue\n"], [1351, "      CodeUri: SummarizationFunction\n"], [1352, "      Handler: index.handler\n"], [1353, "      Runtime: python3.12\n"], [1354, "      Timeout: 900\n"], [1355, "      MemorySize: 4096\n"], [1356, "      Environment:\n"], [1357, "        Variables:\n"], [1358, "          METRIC_NAMESPACE:\n"], [1359, "            Ref: StackName\n"], [1360, "          CONFIGURATION_TABLE_NAME:\n"], [1361, "            Ref: ConfigurationTable\n"], [1362, "          GUARDRAIL_ID_AND_VERSION:\n"], [1363, "            Fn::If:\n"], [1364, "            - HasGuardrailConfig\n"], [1365, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1366, "            - ''\n"], [1367, "          LOG_LEVEL:\n"], [1368, "            Ref: LogLevel\n"], [1369, "          APPSYNC_API_URL:\n"], [1370, "            Ref: AppSyncApiUrl\n"], [1371, "          WORKING_BUCKET:\n"], [1372, "            Ref: WorkingBucket\n"], [1373, "      LoggingConfig:\n"], [1374, "        LogGroup:\n"], [1375, "          Ref: SummarizationFunctionLogGroup\n"], [1376, "      Policies:\n"], [1377, "      - AWSLambdaBasicExecutionRole\n"], [1378, "      - S3ReadPolicy:\n"], [1379, "          BucketName:\n"], [1380, "            Ref: InputBucket\n"], [1381, "      - S3CrudPolicy:\n"], [1382, "          BucketName:\n"], [1383, "            Ref: OutputBucket\n"], [1384, "      - S3CrudPolicy:\n"], [1385, "          BucketName:\n"], [1386, "            Ref: WorkingBucket\n"], [1387, "      - DynamoDBCrudPolicy:\n"], [1388, "          TableName:\n"], [1389, "            Ref: ConfigurationTable\n"], [1390, "      - Statement:\n"], [1391, "        - Effect: Allow\n"], [1392, "          Action: cloudwatch:PutMetricData\n"], [1393, "          Resource: '*'\n"], [1394, "        - Effect: Allow\n"], [1395, "          Action:\n"], [1396, "          - kms:Encrypt\n"], [1397, "          - kms:Decrypt\n"], [1398, "          - kms:ReEncrypt*\n"], [1399, "          - kms:GenerateDataKey*\n"], [1400, "          - kms:DescribeKey\n"], [1401, "          Resource:\n"], [1402, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1403, "        - Effect: Allow\n"], [1404, "          Action: bedrock:InvokeModel\n"], [1405, "          Resource:\n"], [1406, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1407, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1408, "        - Effect: Allow\n"], [1409, "          Action:\n"], [1410, "          - appsync:GraphQL\n"], [1411, "          Resource:\n"], [1412, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1413, "        - Fn::If:\n"], [1414, "          - HasGuardrailConfig\n"], [1415, "          - Effect: Allow\n"], [1416, "            Action: bedrock:ApplyGuardrail\n"], [1417, "            Resource:\n"], [1418, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1419, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1331, 1419], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaEnvironmentEncryptionSettings", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-5", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/ReservedConcurrentExecutions"]}, "code_block": [[1331, "  SummarizationFunction:\n"], [1332, "    Type: AWS::Serverless::Function\n"], [1333, "    Metadata:\n"], [1334, "      SamResourceId: SummarizationFunction\n"], [1335, "      cfn_nag:\n"], [1336, "        rules_to_suppress:\n"], [1337, "        - id: W11\n"], [1338, "          reason: Cloudwatch does not support resource-level permissions\n"], [1339, "        - id: W89\n"], [1340, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1341, "            with AWS services via AWS APIs\n"], [1342, "        - id: W92\n"], [1343, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1344, "            to scale based on demand\n"], [1345, "    Properties:\n"], [1346, "      PermissionsBoundary:\n"], [1347, "        Fn::If:\n"], [1348, "        - HasPermissionsBoundary\n"], [1349, "        - Ref: PermissionsBoundaryArn\n"], [1350, "        - Ref: AWS::NoValue\n"], [1351, "      CodeUri: SummarizationFunction\n"], [1352, "      Handler: index.handler\n"], [1353, "      Runtime: python3.12\n"], [1354, "      Timeout: 900\n"], [1355, "      MemorySize: 4096\n"], [1356, "      Environment:\n"], [1357, "        Variables:\n"], [1358, "          METRIC_NAMESPACE:\n"], [1359, "            Ref: StackName\n"], [1360, "          CONFIGURATION_TABLE_NAME:\n"], [1361, "            Ref: ConfigurationTable\n"], [1362, "          GUARDRAIL_ID_AND_VERSION:\n"], [1363, "            Fn::If:\n"], [1364, "            - HasGuardrailConfig\n"], [1365, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1366, "            - ''\n"], [1367, "          LOG_LEVEL:\n"], [1368, "            Ref: LogLevel\n"], [1369, "          APPSYNC_API_URL:\n"], [1370, "            Ref: AppSyncApiUrl\n"], [1371, "          WORKING_BUCKET:\n"], [1372, "            Ref: WorkingBucket\n"], [1373, "      LoggingConfig:\n"], [1374, "        LogGroup:\n"], [1375, "          Ref: SummarizationFunctionLogGroup\n"], [1376, "      Policies:\n"], [1377, "      - AWSLambdaBasicExecutionRole\n"], [1378, "      - S3ReadPolicy:\n"], [1379, "          BucketName:\n"], [1380, "            Ref: InputBucket\n"], [1381, "      - S3CrudPolicy:\n"], [1382, "          BucketName:\n"], [1383, "            Ref: OutputBucket\n"], [1384, "      - S3CrudPolicy:\n"], [1385, "          BucketName:\n"], [1386, "            Ref: WorkingBucket\n"], [1387, "      - DynamoDBCrudPolicy:\n"], [1388, "          TableName:\n"], [1389, "            Ref: ConfigurationTable\n"], [1390, "      - Statement:\n"], [1391, "        - Effect: Allow\n"], [1392, "          Action: cloudwatch:PutMetricData\n"], [1393, "          Resource: '*'\n"], [1394, "        - Effect: Allow\n"], [1395, "          Action:\n"], [1396, "          - kms:Encrypt\n"], [1397, "          - kms:Decrypt\n"], [1398, "          - kms:ReEncrypt*\n"], [1399, "          - kms:GenerateDataKey*\n"], [1400, "          - kms:DescribeKey\n"], [1401, "          Resource:\n"], [1402, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1403, "        - Effect: Allow\n"], [1404, "          Action: bedrock:InvokeModel\n"], [1405, "          Resource:\n"], [1406, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1407, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1408, "        - Effect: Allow\n"], [1409, "          Action:\n"], [1410, "          - appsync:GraphQL\n"], [1411, "          Resource:\n"], [1412, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1413, "        - Fn::If:\n"], [1414, "          - HasGuardrailConfig\n"], [1415, "          - Effect: Allow\n"], [1416, "            Action: bedrock:ApplyGuardrail\n"], [1417, "            Resource:\n"], [1418, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1419, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1331, 1419], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["Properties/VpcConfig"]}, "code_block": [[1331, "  SummarizationFunction:\n"], [1332, "    Type: AWS::Serverless::Function\n"], [1333, "    Metadata:\n"], [1334, "      SamResourceId: SummarizationFunction\n"], [1335, "      cfn_nag:\n"], [1336, "        rules_to_suppress:\n"], [1337, "        - id: W11\n"], [1338, "          reason: Cloudwatch does not support resource-level permissions\n"], [1339, "        - id: W89\n"], [1340, "          reason: This Lambda function does not require VPC access as it only interacts\n"], [1341, "            with AWS services via AWS APIs\n"], [1342, "        - id: W92\n"], [1343, "          reason: Function does not require concurrent execution limits as it is designed\n"], [1344, "            to scale based on demand\n"], [1345, "    Properties:\n"], [1346, "      PermissionsBoundary:\n"], [1347, "        Fn::If:\n"], [1348, "        - HasPermissionsBoundary\n"], [1349, "        - Ref: PermissionsBoundaryArn\n"], [1350, "        - Ref: AWS::NoValue\n"], [1351, "      CodeUri: SummarizationFunction\n"], [1352, "      Handler: index.handler\n"], [1353, "      Runtime: python3.12\n"], [1354, "      Timeout: 900\n"], [1355, "      MemorySize: 4096\n"], [1356, "      Environment:\n"], [1357, "        Variables:\n"], [1358, "          METRIC_NAMESPACE:\n"], [1359, "            Ref: StackName\n"], [1360, "          CONFIGURATION_TABLE_NAME:\n"], [1361, "            Ref: ConfigurationTable\n"], [1362, "          GUARDRAIL_ID_AND_VERSION:\n"], [1363, "            Fn::If:\n"], [1364, "            - HasGuardrailConfig\n"], [1365, "            - Fn::Sub: ${BedrockGuardrailId}:${BedrockGuardrailVersion}\n"], [1366, "            - ''\n"], [1367, "          LOG_LEVEL:\n"], [1368, "            Ref: LogLevel\n"], [1369, "          APPSYNC_API_URL:\n"], [1370, "            Ref: AppSyncApiUrl\n"], [1371, "          WORKING_BUCKET:\n"], [1372, "            Ref: WorkingBucket\n"], [1373, "      LoggingConfig:\n"], [1374, "        LogGroup:\n"], [1375, "          Ref: SummarizationFunctionLogGroup\n"], [1376, "      Policies:\n"], [1377, "      - AWSLambdaBasicExecutionRole\n"], [1378, "      - S3ReadPolicy:\n"], [1379, "          BucketName:\n"], [1380, "            Ref: InputBucket\n"], [1381, "      - S3CrudPolicy:\n"], [1382, "          BucketName:\n"], [1383, "            Ref: OutputBucket\n"], [1384, "      - S3CrudPolicy:\n"], [1385, "          BucketName:\n"], [1386, "            Ref: WorkingBucket\n"], [1387, "      - DynamoDBCrudPolicy:\n"], [1388, "          TableName:\n"], [1389, "            Ref: ConfigurationTable\n"], [1390, "      - Statement:\n"], [1391, "        - Effect: Allow\n"], [1392, "          Action: cloudwatch:PutMetricData\n"], [1393, "          Resource: '*'\n"], [1394, "        - Effect: Allow\n"], [1395, "          Action:\n"], [1396, "          - kms:Encrypt\n"], [1397, "          - kms:Decrypt\n"], [1398, "          - kms:ReEncrypt*\n"], [1399, "          - kms:GenerateDataKey*\n"], [1400, "          - kms:DescribeKey\n"], [1401, "          Resource:\n"], [1402, "            Ref: CustomerManagedEncryptionKeyArn\n"], [1403, "        - Effect: Allow\n"], [1404, "          Action: bedrock:InvokeModel\n"], [1405, "          Resource:\n"], [1406, "          - Fn::Sub: arn:aws:bedrock:*::foundation-model/*\n"], [1407, "          - Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:inference-profile/*\n"], [1408, "        - Effect: Allow\n"], [1409, "          Action:\n"], [1410, "          - appsync:GraphQL\n"], [1411, "          Resource:\n"], [1412, "          - Fn::Sub: ${AppSyncApiArn}/types/Mutation/*\n"], [1413, "        - Fn::If:\n"], [1414, "          - HasGuardrailConfig\n"], [1415, "          - Effect: Allow\n"], [1416, "            Action: bedrock:ApplyGuardrail\n"], [1417, "            Resource:\n"], [1418, "              Fn::Sub: arn:aws:bedrock:${AWS::Region}:${AWS::AccountId}:guardrail/${BedrockGuardrailId}\n"], [1419, "          - Ref: AWS::NoValue\n"]], "file_path": "/template.yaml", "file_abs_path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "repo_file_path": "/template.yaml", "file_line_range": [1331, 1419], "resource": "AWS::Serverless::Function.SummarizationFunction", "evaluations": {}, "check_class": "checkov.cloudformation.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": null, "breadcrumbs": {"Environment.Variables.LOG_LEVEL": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}], "Environment.Variables": [{"type": "parameters", "name": "LogLevel", "path": "/home/ec2-user/projects/genaiic-idp-accelerator-2/patterns/pattern-3/.aws-sam/build/template.yaml", "attribute_key": "Default"}]}}]}, "summary": {"passed": 26, "failed": 24, "skipped": 0, "parsing_errors": 0, "resource_count": 18, "checkov_version": "3.2.461"}}