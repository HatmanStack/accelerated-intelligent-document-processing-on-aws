# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-08-10  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **8** security threats. The analysis reveals **0** critical, **0** high, **3** medium, and **5** low severity findings.

## Priority Actions

### 2. Restrict Textract permissions to only the specific operations needed. While Textract doesn't support resource-level permissions currently, consider implementing detective controls like CloudTrail monitoring for unusual Textract usage patterns.

**Effort:** Low  
**Related Threats:** PATTERN3-THREAT-001  
**Business Impact:** Unauthorized access to documents processed through Textract, potentially leading to data leakage of sensitive information from documents outside the intended scope.

### 2. Restrict Bedrock invocation permissions to only the specific models required for the application's functionality, rather than allowing access to all foundation models.

**Effort:** Low  
**Related Threats:** PATTERN3-THREAT-002  
**Business Impact:** Unauthorized access to Bedrock models beyond what's required for the application, potentially leading to cost escalation or misuse of AI capabilities.

### 2. Implement log scrubbing mechanisms to redact sensitive information before logging. Configure appropriate log levels to minimize detailed content logging in production. Implement strict access controls on CloudWatch Log groups and consider using log filters to mask potentially sensitive information.

**Effort:** Medium  
**Related Threats:** PATTERN3-THREAT-008  
**Business Impact:** Unintended disclosure of sensitive information, personally identifiable information (PII), or confidential business data that might be present in the processed documents.

### 3. Set a minimum acceptable value for LogRetentionDays parameter with a constraint in the template to ensure logs are kept long enough for security investigations and compliance requirements (typically 90+ days).

**Effort:** Low  
**Related Threats:** PATTERN3-THREAT-003  
**Business Impact:** Reduced ability to investigate security incidents or compliance violations if logs are retained for an insufficient period.

### 3. Set 'IncludeExecutionData: false' unless there is a specific requirement to log execution data. If execution data logging is necessary, ensure appropriate access controls on the log group and consider implementing log filters to redact sensitive information.

**Effort:** Low  
**Related Threats:** PATTERN3-THREAT-004  
**Business Impact:** Potential exposure of sensitive information that might be included in state machine execution data.

### 3. Configure appropriate reserved and/or provisioned concurrency limits for each Lambda function based on expected usage patterns. This helps ensure the functions have the resources they need while preventing them from consuming all available account concurrency.

**Effort:** Medium  
**Related Threats:** PATTERN3-THREAT-005  
**Business Impact:** Potential denial of service for other applications in the same AWS account if Lambda concurrency is exhausted.

### 3. Ensure the Lambda functions behind these custom resources implement comprehensive logging for all configuration changes, including the identity of the requester, the specific changes made, and timestamps.

**Effort:** Medium  
**Related Threats:** PATTERN3-THREAT-007  
**Business Impact:** Difficulty tracking who made configuration changes and what specific changes were made, potentially impacting compliance and incident investigation capabilities.

### 4. Implement strict IAM permissions for accessing the CloudWatch Dashboard. Consider creating separate dashboards with different levels of detail for different user roles, restricting sensitive metrics to those with operational needs.

**Effort:** Low  
**Related Threats:** PATTERN3-THREAT-006  
**Business Impact:** Potential disclosure of operational patterns and metrics that could aid in planning more targeted attacks or reveal business-sensitive information about processing volumes.



## Detailed Threat Analysis

## Medium Severity Threats

### PATTERN3-THREAT-001: Overly permissive Textract permissions

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `OCRFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-250

#### Issue
The OCRFunction has permissions to call textract:DetectDocumentText and textract:AnalyzeDocument on all resources ('*'). This grants broader access than necessary and violates the principle of least privilege.

#### Attack Vector
If the Lambda function is compromised, an attacker could use these permissions to access and analyze documents that should be out of scope for this application.

#### Potential Impact
Unauthorized access to documents processed through Textract, potentially leading to data leakage of sensitive information from documents outside the intended scope.

#### Remediation
Restrict Textract permissions to only the specific operations needed. While Textract doesn't support resource-level permissions currently, consider implementing detective controls like CloudTrail monitoring for unusual Textract usage patterns.

**References:**
- https://docs.aws.amazon.com/textract/latest/dg/security_iam_service-with-iam.html

---

### PATTERN3-THREAT-002: Broad Bedrock model invocation permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `ExtractionFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-250

#### Issue
The ExtractionFunction has permissions to invoke any foundation model ('arn:aws:bedrock:*::foundation-model/*') and inference profile. This grants broader access than necessary and violates the principle of least privilege.

#### Attack Vector
If the Lambda function is compromised, an attacker could use these permissions to access and invoke any Bedrock model, potentially circumventing intended usage patterns or incurring unexpected costs.

#### Potential Impact
Unauthorized access to Bedrock models beyond what's required for the application, potentially leading to cost escalation or misuse of AI capabilities.

#### Remediation
Restrict Bedrock invocation permissions to only the specific models required for the application's functionality, rather than allowing access to all foundation models.

**References:**
- https://docs.aws.amazon.com/bedrock/latest/userguide/security_iam_service-with-iam.html

---

### PATTERN3-THREAT-008: Potential exposure of sensitive information in logs

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `AssessmentFunction, ExtractionFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-532

#### Issue
Functions handling document content, extraction, and summarization might log sensitive information contained in the processed documents, potentially exposing PII or confidential data in CloudWatch Logs.

#### Attack Vector
Anyone with access to CloudWatch Logs could potentially view sensitive document contents that might be included in log messages for debugging purposes.

#### Potential Impact
Unintended disclosure of sensitive information, personally identifiable information (PII), or confidential business data that might be present in the processed documents.

#### Remediation
Implement log scrubbing mechanisms to redact sensitive information before logging. Configure appropriate log levels to minimize detailed content logging in production. Implement strict access controls on CloudWatch Log groups and consider using log filters to mask potentially sensitive information.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/mask-sensitive-log-data.html

---

## Low Severity Threats

### PATTERN3-THREAT-003: Log retention policy could be improved

**STRIDE Category:** Repudiation  
**Affected Resource:** `StateMachineLogGroup` (AWS::Logs::LogGroup)  
**CWE ID:** CWE-778

#### Issue
While the template includes log retention configuration for all log groups, the retention period is parameterized without enforcing minimum secure values. Short retention periods could impact investigation capabilities.

#### Attack Vector
Attackers who gain unauthorized access might attempt to cover their tracks, and with short log retention periods, their actions might be automatically deleted before detection.

#### Potential Impact
Reduced ability to investigate security incidents or compliance violations if logs are retained for an insufficient period.

#### Remediation
Set a minimum acceptable value for LogRetentionDays parameter with a constraint in the template to ensure logs are kept long enough for security investigations and compliance requirements (typically 90+ days).

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html

---

### PATTERN3-THREAT-004: State machine execution history potentially visible to other users

**STRIDE Category:** Tampering  
**Affected Resource:** `DocumentProcessingStateMachine` (AWS::Serverless::StateMachine)  
**CWE ID:** CWE-532

#### Issue
The state machine is configured with 'IncludeExecutionData: true' which means execution data is included in the execution history and potentially visible to users with access to the log group.

#### Attack Vector
Users with access to CloudWatch Logs could potentially view sensitive information processed by the state machine if it handles confidential data.

#### Potential Impact
Potential exposure of sensitive information that might be included in state machine execution data.

#### Remediation
Set 'IncludeExecutionData: false' unless there is a specific requirement to log execution data. If execution data logging is necessary, ensure appropriate access controls on the log group and consider implementing log filters to redact sensitive information.

**References:**
- https://docs.aws.amazon.com/step-functions/latest/dg/cloudwatch-log-level.html

---

### PATTERN3-THREAT-005: No concurrency limits configured for Lambda functions

**STRIDE Category:** Denial of Service  
**Affected Resource:** `OCRFunction, ClassificationFunction, ExtractionFunction, AssessmentFunction, ProcessResultsFunction, SummarizationFunction` (AWS::Serverless::Function)  
**CWE ID:** CWE-400

#### Issue
Lambda functions in the template don't have concurrency limits configured, potentially allowing them to consume all available account concurrency during high load or in case of recursive invocation bugs.

#### Attack Vector
An attacker might trigger multiple simultaneous invocations of these functions, potentially causing resource exhaustion for other Lambda functions in the same AWS account.

#### Potential Impact
Potential denial of service for other applications in the same AWS account if Lambda concurrency is exhausted.

#### Remediation
Configure appropriate reserved and/or provisioned concurrency limits for each Lambda function based on expected usage patterns. This helps ensure the functions have the resources they need while preventing them from consuming all available account concurrency.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

### PATTERN3-THREAT-006: CloudWatch Dashboard may expose sensitive operational metrics

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `Dashboard` (AWS::CloudWatch::Dashboard)  
**CWE ID:** CWE-200

#### Issue
The CloudWatch Dashboard could potentially expose sensitive operational data about the application, including processing rates, error patterns, and resource utilization, to anyone with dashboard access permissions.

#### Attack Vector
Users with dashboard access could gain insights into application behavior, processing volumes, and potential weaknesses without having direct access to the application itself.

#### Potential Impact
Potential disclosure of operational patterns and metrics that could aid in planning more targeted attacks or reveal business-sensitive information about processing volumes.

#### Remediation
Implement strict IAM permissions for accessing the CloudWatch Dashboard. Consider creating separate dashboards with different levels of detail for different user roles, restricting sensitive metrics to those with operational needs.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Dashboard-Access-Control.html

---

### PATTERN3-THREAT-007: Custom resources might lack proper logging for configuration changes

**STRIDE Category:** Repudiation  
**Affected Resource:** `UpdateSchemaConfig, UpdateDefaultConfig` (AWS::CloudFormation::CustomResource)  
**CWE ID:** CWE-778

#### Issue
The template uses custom resources for configuration updates but doesn't explicitly define logging for these operations. This could lead to a lack of audit trail for configuration changes.

#### Attack Vector
An attacker with sufficient permissions could modify configurations through these custom resources without leaving adequate logs of their actions.

#### Potential Impact
Difficulty tracking who made configuration changes and what specific changes were made, potentially impacting compliance and incident investigation capabilities.

#### Remediation
Ensure the Lambda functions behind these custom resources implement comprehensive logging for all configuration changes, including the identity of the requester, the specific changes made, and timestamps.

**References:**
- https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-custom-resources.html

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*