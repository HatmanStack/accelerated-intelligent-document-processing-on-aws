# CloudFormation Threat Model Report

**Template:** `threat-model.md`  
**Analysis Date:** 2025-08-19_17-08-28  
**Generated By:** CloudFormation Threat Modeling Tool  

## Executive Summary

This threat model analysis identified **15** security threats. The analysis reveals **0** critical, **4** high, **9** medium, and **2** low severity findings.

## Priority Actions

### 1. Refine IAM policies to limit permissions to only the specific actions required by each service integration, and scope resource ARNs more narrowly where possible.

**Effort:** Medium  
**Related Threats:** GENAI-IDP-THREAT-002  
**Business Impact:** Violation of least privilege principle could lead to unauthorized access across multiple services in the account.

### 1. Refine IAM policies to scope permissions to specific resources where possible, and limit actions to only what is required.

**Effort:** Medium  
**Related Threats:** GENAI-IDP-THREAT-015  
**Business Impact:** Potential unauthorized access to resources within the AWS account.

### 2. Modify the WebUIBucket to use the same CustomerManagedEncryptionKey as other buckets in the stack by changing the SSEAlgorithm from AES256 to aws:kms and adding the KMSMasterKeyID.

**Effort:** Low  
**Related Threats:** GENAI-IDP-THREAT-001  
**Business Impact:** Lower security posture for web UI assets, potential compliance violations for organizations requiring customer-managed keys for all storage.

### 2. Set a minimum value for LogRetentionDays parameter that meets organizational compliance requirements (typically 90 days minimum) and ensure this is communicated in parameter descriptions.

**Effort:** Low  
**Related Threats:** GENAI-IDP-THREAT-003  
**Business Impact:** Limited ability to investigate security incidents, potential compliance violations for organizations with specific log retention requirements.

### 2. Enable MFA for the Cognito User Pool, preferably using TOTP or SMS verification as a second factor.

**Effort:** Low  
**Related Threats:** GENAI-IDP-THREAT-006  
**Business Impact:** Higher risk of unauthorized access to sensitive data processing capabilities, potentially leading to data breaches or misuse of AI services.

### 2. Scope down the permissions to specific resources where possible, limiting the role to only the specific Cognito User Pool and SageMaker workteams that need to be accessed.

**Effort:** Low  
**Related Threats:** GENAI-IDP-THREAT-007  
**Business Impact:** Potential unauthorized access to user authentication mechanisms or machine learning resources.

### 2. Add security-specific CloudWatch metrics and alerts, such as monitoring for unauthorized API calls, permission changes, or unusual access patterns. Consider integrating with AWS Security Hub or GuardDuty for enhanced security monitoring.

**Effort:** Medium  
**Related Threats:** GENAI-IDP-THREAT-008  
**Business Impact:** Delayed detection of security incidents, potential for unauthorized activities to continue for longer periods.

### 2. Change the DefaultAction to DENY and use more granular authorization patterns such as @auth directives in the GraphQL schema to explicitly grant access to specific types and fields based on user groups or claims.

**Effort:** Medium  
**Related Threats:** GENAI-IDP-THREAT-010  
**Business Impact:** Potential unauthorized access to data or operations within the GraphQL API.

### 3. Use a custom SSL certificate with AWS Certificate Manager for the CloudFront distribution to provide a domain name that matches organizational branding.

**Effort:** Medium  
**Related Threats:** GENAI-IDP-THREAT-004  
**Business Impact:** Users might not trust the site, potential for successful phishing attacks against users.

### 3. Consider switching to PROVISIONED capacity mode with auto-scaling for critical tables or implementing application-level throttling and retry mechanisms.

**Effort:** Medium  
**Related Threats:** GENAI-IDP-THREAT-005  
**Business Impact:** Service disruption under high load, unpredictable costs, degraded user experience.



## Detailed Threat Analysis

## High Severity Threats

### GENAI-IDP-THREAT-001: Missing encryption for web UI S3 bucket

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `WebUIBucket` (AWS::S3::Bucket)  
**CWE ID:** CWE-311

#### Issue
The WebUIBucket uses AES256 server-side encryption instead of AWS KMS which is used for other buckets in the stack. This inconsistent approach to encryption could lead to data protection gaps.

#### Attack Vector
Attackers who gain access to the S3 bucket data through other means (e.g., misconfigured permissions) would have access to unencrypted data or data encrypted with AWS-managed keys rather than customer-managed keys.

#### Potential Impact
Lower security posture for web UI assets, potential compliance violations for organizations requiring customer-managed keys for all storage.

#### Remediation
Modify the WebUIBucket to use the same CustomerManagedEncryptionKey as other buckets in the stack by changing the SSEAlgorithm from AES256 to aws:kms and adding the KMSMasterKeyID.

**References:**
- https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html

---

### GENAI-IDP-THREAT-002: Overly permissive IAM role policies

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `AppSyncServiceRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The AppSyncServiceRole has access to multiple Lambda functions and other services without scoping permissions to specific actions or resources where possible.

#### Attack Vector
If the AppSync service is compromised, an attacker could leverage the role to access multiple Lambda functions and potentially pivot to other services.

#### Potential Impact
Violation of least privilege principle could lead to unauthorized access across multiple services in the account.

#### Remediation
Refine IAM policies to limit permissions to only the specific actions required by each service integration, and scope resource ARNs more narrowly where possible.

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### GENAI-IDP-THREAT-007: IAM role with broad permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `CognitoClientUpdaterRole` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
The CognitoClientUpdaterRole has a policy with resource: '*' for several Cognito and SageMaker actions, which violates the principle of least privilege.

#### Attack Vector
If the associated Lambda function is compromised, an attacker could use these broad permissions to access or modify Cognito and SageMaker resources beyond the intended scope.

#### Potential Impact
Potential unauthorized access to user authentication mechanisms or machine learning resources.

#### Remediation
Scope down the permissions to specific resources where possible, limiting the role to only the specific Cognito User Pool and SageMaker workteams that need to be accessed.

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

### GENAI-IDP-THREAT-015: IAM roles with wildcard resource permissions

**STRIDE Category:** Elevation of Privilege  
**Affected Resource:** `A2IHumanTaskUILambdaRole, DashboardMergerFunction` (AWS::IAM::Role)  
**CWE ID:** CWE-272

#### Issue
Several IAM roles in the template use wildcard (*) resource permissions for various AWS services, which violates the principle of least privilege.

#### Attack Vector
If a Lambda function using these roles is compromised, an attacker could access or modify resources beyond the intended scope.

#### Potential Impact
Potential unauthorized access to resources within the AWS account.

#### Remediation
Refine IAM policies to scope permissions to specific resources where possible, and limit actions to only what is required.

**References:**
- https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege

---

## Medium Severity Threats

### GENAI-IDP-THREAT-003: Variable log retention periods

**STRIDE Category:** Repudiation  
**Affected Resource:** `Multiple Log Groups` (AWS::Logs::LogGroup)  
**CWE ID:** CWE-778

#### Issue
While log groups have encryption enabled with KMS, the retention period is parameterized and could be set too low (as little as 1 day) which might not meet compliance requirements for log retention.

#### Attack Vector
Attackers' activities might not be discoverable if logs are purged too quickly, preventing proper forensic analysis after a security incident.

#### Potential Impact
Limited ability to investigate security incidents, potential compliance violations for organizations with specific log retention requirements.

#### Remediation
Set a minimum value for LogRetentionDays parameter that meets organizational compliance requirements (typically 90 days minimum) and ensure this is communicated in parameter descriptions.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html

---

### GENAI-IDP-THREAT-004: CloudFront using default certificate

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `CloudFrontDistribution` (AWS::CloudFront::Distribution)  
**CWE ID:** CWE-295

#### Issue
The CloudFront distribution is using the default CloudFront certificate rather than a custom certificate, which could make it harder for users to verify the authenticity of the website.

#### Attack Vector
Phishing attacks could be mounted by creating similar-looking distributions that users might not easily distinguish from the legitimate application.

#### Potential Impact
Users might not trust the site, potential for successful phishing attacks against users.

#### Remediation
Use a custom SSL certificate with AWS Certificate Manager for the CloudFront distribution to provide a domain name that matches organizational branding.

**References:**
- https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-alternate-domain-names.html

---

### GENAI-IDP-THREAT-005: No read/write capacity units specified

**STRIDE Category:** Denial of Service  
**Affected Resource:** `TrackingTable, ConfigurationTable, AnalyticsTable` (AWS::DynamoDB::Table)  
**CWE ID:** CWE-400

#### Issue
DynamoDB tables are configured with PAY_PER_REQUEST billing mode without any capacity planning, which could lead to throttling during high load and potential DoS.

#### Attack Vector
If an attacker generates a large volume of requests, they could cause the application to be throttled by DynamoDB, affecting legitimate users.

#### Potential Impact
Service disruption under high load, unpredictable costs, degraded user experience.

#### Remediation
Consider switching to PROVISIONED capacity mode with auto-scaling for critical tables or implementing application-level throttling and retry mechanisms.

**References:**
- https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.ReadWriteCapacityMode.html

---

### GENAI-IDP-THREAT-006: No MFA required for Cognito User Pool

**STRIDE Category:** Tampering  
**Affected Resource:** `UserPool` (AWS::Cognito::UserPool)  
**CWE ID:** CWE-308

#### Issue
The Cognito User Pool does not require MFA, which increases the risk of unauthorized access if user credentials are compromised.

#### Attack Vector
Attackers who obtain user credentials through phishing or other means could directly access the application without an additional authentication factor.

#### Potential Impact
Higher risk of unauthorized access to sensitive data processing capabilities, potentially leading to data breaches or misuse of AI services.

#### Remediation
Enable MFA for the Cognito User Pool, preferably using TOTP or SMS verification as a second factor.

**References:**
- https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html

---

### GENAI-IDP-THREAT-008: Insufficient security metrics and alerting

**STRIDE Category:** Repudiation  
**Affected Resource:** `MainTemplateSubsetDashboard, MergedDashboard` (AWS::CloudWatch::Dashboard)  
**CWE ID:** CWE-778

#### Issue
While there are metrics for workflow errors and execution time, there are insufficient security-specific metrics and alerts for potential security incidents (such as unusual access patterns, permission changes, or configuration modifications).

#### Attack Vector
Attackers could perform actions that don't trigger the existing alerts but still compromise security, and these actions might go undetected.

#### Potential Impact
Delayed detection of security incidents, potential for unauthorized activities to continue for longer periods.

#### Remediation
Add security-specific CloudWatch metrics and alerts, such as monitoring for unauthorized API calls, permission changes, or unusual access patterns. Consider integrating with AWS Security Hub or GuardDuty for enhanced security monitoring.

**References:**
- https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards.html

---

### GENAI-IDP-THREAT-009: Long-lived refresh tokens in Cognito User Pool Client

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UserPoolClient` (AWS::Cognito::UserPoolClient)  
**CWE ID:** CWE-613

#### Issue
The UserPoolClient has a RefreshTokenValidity of 30 days, which means compromised refresh tokens could be used for up to a month.

#### Attack Vector
If a refresh token is stolen, an attacker could continue to generate new access tokens for up to 30 days without needing the original user credentials.

#### Potential Impact
Extended window of unauthorized access if refresh tokens are compromised.

#### Remediation
Reduce the RefreshTokenValidity to a shorter period (e.g., 1-7 days) based on the application's security requirements, and implement proper token revocation mechanisms.

**References:**
- https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-with-identity-providers.html

---

### GENAI-IDP-THREAT-010: Default ALLOW action in AppSync API authorization

**STRIDE Category:** Tampering  
**Affected Resource:** `GraphQLApi` (AWS::AppSync::GraphQLApi)  
**CWE ID:** CWE-284

#### Issue
The GraphQL API is configured with DefaultAction: ALLOW for Cognito user pools, which means all authenticated users can access any GraphQL operation by default unless explicitly denied.

#### Attack Vector
Authenticated users could potentially access GraphQL operations that they shouldn't have permission for if proper fine-grained access controls aren't implemented.

#### Potential Impact
Potential unauthorized access to data or operations within the GraphQL API.

#### Remediation
Change the DefaultAction to DENY and use more granular authorization patterns such as @auth directives in the GraphQL schema to explicitly grant access to specific types and fields based on user groups or claims.

**References:**
- https://docs.aws.amazon.com/appsync/latest/devguide/security-authz.html

---

### GENAI-IDP-THREAT-012: No reserved concurrency for critical Lambda functions

**STRIDE Category:** Denial of Service  
**Affected Resource:** `Multiple Lambda Functions` (AWS::Lambda::Function)  
**CWE ID:** CWE-400

#### Issue
Critical Lambda functions like QueueProcessor, WorkflowTracker, and AnalyticsProcessorFunction don't have reserved concurrency configured, which could lead to resource exhaustion during high load.

#### Attack Vector
An attacker could trigger many simultaneous Lambda invocations, potentially consuming the account's Lambda concurrency limit and affecting other functions.

#### Potential Impact
Potential service degradation or unavailability during high traffic periods or DoS attacks.

#### Remediation
Configure reserved concurrency for critical Lambda functions to ensure they always have resources available, and set provisioned concurrency for functions that need consistent performance.

**References:**
- https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html

---

### GENAI-IDP-THREAT-013: No advanced security features for Cognito User Pool

**STRIDE Category:** Spoofing  
**Affected Resource:** `UserPool` (AWS::Cognito::UserPool)  
**CWE ID:** CWE-307

#### Issue
The Cognito User Pool does not have advanced security features enabled, such as risk-based adaptive authentication or compromised credentials checking.

#### Attack Vector
Attackers could use credential stuffing or brute force attacks without triggering additional security measures beyond basic password policies.

#### Potential Impact
Higher risk of unauthorized access through compromised credentials or automated attacks.

#### Remediation
Enable Cognito Advanced Security features, including risk-based authentication and compromised credentials checking.

**References:**
- https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-advanced-security.html

---

## Low Severity Threats

### GENAI-IDP-THREAT-011: Sensitive settings stored in SSM Parameter Store with default encryption

**STRIDE Category:** Information Disclosure  
**Affected Resource:** `UpdateSettingsValues` (AWS::CloudFormation::CustomResource)  
**CWE ID:** CWE-311

#### Issue
The template stores settings in SSM Parameter Store, but doesn't explicitly configure the parameter with a customer-managed KMS key for encryption.

#### Attack Vector
If an attacker gains access to SSM parameters, they might be able to access sensitive configuration information protected only by AWS-managed keys.

#### Potential Impact
Potential exposure of configuration information that could aid in further attacks.

#### Remediation
Modify the SSM Parameter Store resource to use the CustomerManagedEncryptionKey for parameter encryption.

**References:**
- https://docs.aws.amazon.com/systems-manager/latest/userguide/parameter-store-advanced-parameters.html

---

### GENAI-IDP-THREAT-014: Nested stacks pass sensitive parameters

**STRIDE Category:** Tampering  
**Affected Resource:** `PATTERN1STACK, PATTERN2STACK, PATTERN3STACK` (AWS::CloudFormation::Stack)  
**CWE ID:** CWE-312

#### Issue
Sensitive parameters like KMS key ARNs, bucket names, and role ARNs are passed to nested stacks as plaintext parameters, which could expose this information in CloudFormation events and logs.

#### Attack Vector
Attackers with access to CloudFormation event logs or deployment history could access sensitive configuration details.

#### Potential Impact
Exposure of internal resource identifiers that could aid in planning further attacks.

#### Remediation
Consider using AWS Secrets Manager or SSM Parameter Store for passing sensitive values to nested stacks, or implement NoEcho properties on sensitive parameters.

**References:**
- https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html#parameters-section-structure-properties

---



---

*This report was generated automatically using STRIDE threat modeling methodology.*